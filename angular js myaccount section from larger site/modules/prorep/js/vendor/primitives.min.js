/*
 Basic Primitives orgDiagram v2.0.18
 Copyright (c) 2013 - 2015 Basic Primitives Inc

 Non-commercial - Free
 http://creativecommons.org/licenses/by-nc/3.0/

 Commercial and government licenses:
 http://www.basicprimitives.com/pdf/license.pdf

 */
(function () {
    var a = function (a) {
        var a = a.split("."), c = window, d;
        for (d = 0; d < a.length; d += 1)c = c[a[d]] = c[a[d]] || {};
        return c
    };
    a("primitives.common");
    a("primitives.orgdiagram");
    a("primitives.famdiagram");
    a("primitives.text");
    a("primitives.callout");
    a("primitives.connector");
    a("primitives.shape")
})();
primitives.common.isNullOrEmpty = function (a) {
    var b = !0;
    void 0 !== a && null !== a && (a = a.toString(), 0 < a.length && (b = !1));
    return b
};
primitives.common.isEmptyObject = function (a) {
    var b = !0, c;
    for (c in a)if (a.hasOwnProperty(c)) {
        b = !1;
        break
    }
    return b
};
primitives.common.hashCode = function (a) {
    var b = 0, c, d;
    if (0 < a.length)for (d = 0; d < a.length; d += 1)c = a.charCodeAt(d), b = (b << 5) - b + c, b &= b;
    return b
};
primitives.common.attr = function (a, b) {
    var c, d;
    if (a.hasOwnProperty("attrHash"))for (c in b)b.hasOwnProperty(c) && (d = b[c], a.attrHash[c] != d && (a.attrHash[c] = d, a.attr(c, d))); else a.attr(b), a.attrHash = b
};
primitives.common.css = function (a, b) {
    var c, d;
    if (a.hasOwnProperty("cssHash"))for (c in b)b.hasOwnProperty(c) && (d = b[c], a.cssHash[c] != d && (a.cssHash[c] = d, a.css(c, d))); else a.css(b), a.cssHash = b
};
primitives.common.stopPropagation = function (a) {
    void 0 !== a.stopPropagation ? a.stopPropagation() : void 0 !== a.cancelBubble ? a.cancelBubble = !0 : void 0 !== a.preventDefault && a.preventDefault()
};
primitives.common.indexOf = function (a, b, c) {
    var d, e;
    for (d = 0; d < a.length; d += 1)if (e = a[d], null != c ? c(e, b) : e === b)return d;
    return -1
};
primitives.common._supportsSVG = null;
primitives.common.supportsSVG = function () {
    null === primitives.common._supportsSVG && (primitives.common._supportsSVG = document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure", "1.1") || document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Shape", "1.0"));
    return primitives.common._supportsSVG
};
primitives.common._supportsVML = null;
primitives.common.supportsVML = function () {
    var a, b;
    null === primitives.common._supportsVML && (primitives.common._supportsVML = !1, jQuery.support.opacity || (a = document.createElement("div"), a = document.body.appendChild(a), a.innerHTML = '<v:shape adj="1" />', b = a.firstChild, b.style.behavior = "url(#default#VML)", primitives.common._supportsVML = b ? "object" === typeof b.adj : !1, a.parentNode.removeChild(a)));
    return primitives.common._supportsVML
};
primitives.common._supportsCanvas = null;
primitives.common.supportsCanvas = function () {
    null === primitives.common._supportsCanvas && (primitives.common._supportsCanvas = !!window.HTMLCanvasElement);
    return primitives.common._supportsCanvas
};
primitives.common.createGraphics = function (a, b) {
    var c = null, d, e;
    d = [a];
    for (e in primitives.common.GraphicsType)primitives.common.GraphicsType.hasOwnProperty(e) && d.push(primitives.common.GraphicsType[e]);
    for (e = 0; null === c && e < d.length; e += 1)switch (d[e]) {
        case 2:
            primitives.common.supportsVML() && (c = new primitives.common.VmlGraphics(b));
            break;
        case 0:
            primitives.common.supportsSVG() && (c = new primitives.common.SvgGraphics(b));
            break;
        case 1:
            primitives.common.supportsCanvas() && (c = new primitives.common.CanvasGraphics(b))
    }
    return c
};
primitives.common.getColorHexValue = function (a) {
    var b, c, d;
    if ("#" === a.substr(0, 1))return a;
    b = /(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(a);
    if (null !== b && 0 < b.length)return a = parseInt(b[2], 10), c = parseInt(b[3], 10), d = parseInt(b[4], 10), a = (a << 16 | c << 8 | d).toString(16), b[1] + "000000".substr(0, 6 - a.length) + a;
    if (void 0 === primitives.common.ColorHexs)for (c in primitives.common.ColorHexs = {}, primitives.common.Colors)primitives.common.Colors.hasOwnProperty(c) && (primitives.common.ColorHexs[c.toUpperCase()] = primitives.common.Colors[c]);
    return primitives.common.ColorHexs[a.toUpperCase()]
};
primitives.common.getColorName = function (a) {
    var b, a = primitives.common.getColorHexValue(a);
    if (void 0 === primitives.common.ColorNames)for (b in primitives.common.ColorNames = {}, primitives.common.Colors)primitives.common.Colors.hasOwnProperty(b) && (primitives.common.ColorNames[primitives.common.Colors[b]] = b);
    return primitives.common.ColorNames[a]
};
primitives.common.getRed = function (a) {
    return "#" === a.substr(0, 1) && 7 === a.length ? parseInt(a.substr(1, 2), 16) : null
};
primitives.common.getGreen = function (a) {
    return "#" === a.substr(0, 1) && 7 === a.length ? parseInt(a.substr(3, 2), 16) : null
};
primitives.common.getBlue = function (a) {
    return "#" === a.substr(0, 1) && 7 === a.length ? parseInt(a.substr(5, 2), 16) : null
};
primitives.common.beforeOpacity = function (a, b) {
    var c = primitives.common, d, e, a = c.getColorHexValue(a);
    d = Math.ceil((c.getRed(a) - 255 * (1 - b)) / b);
    e = Math.ceil((c.getGreen(a) - 255 * (1 - b)) / b);
    c = Math.ceil((c.getBlue(a) - 255 * (1 - b)) / b);
    d = (d << 16 | e << 8 | c).toString(16);
    return "#" + "000000".substr(0, 6 - d.length) + d
};
primitives.common.highestContrast = function (a, b, c) {
    var d = b, e = primitives.common, f = a + "," + b + "," + c;
    void 0 === e.highestContrasts && (e.highestContrasts = {});
    e.highestContrasts.hasOwnProperty(f) ? d = e.highestContrasts[f] : (e.luminosity(b, a) < e.luminosity(c, a) && (d = c), e.highestContrasts[f] = d);
    return d
};
primitives.common.luminosity = function (a, b) {
    var c = primitives.common, d = c.getColorHexValue(a), e = c.getColorHexValue(b), d = 0.2126 * Math.pow(c.getRed(d) / 255, 2.2) + 0.7152 * Math.pow(c.getRed(d) / 255, 2.2) + 0.0722 * Math.pow(c.getRed(d) / 255, 2.2), c = 0.2126 * Math.pow(c.getRed(e) / 255, 2.2) + 0.7152 * Math.pow(c.getRed(e) / 255, 2.2) + 0.0722 * Math.pow(c.getRed(e) / 255, 2.2);
    return d > c ? (d + 0.05) / (c + 0.05) : (c + 0.05) / (d + 0.05)
};
primitives.common.compareArrays = function (a, b, c) {
    var d = !0, e, f, g, h;
    if (a.length != b.length)d = !1; else {
        h = {};
        e = 0;
        for (f = a.length; e < f; e += 1)g = null != c ? c(a[e]) : a[e], h[g] = h.hasOwnProperty(g) ? h[g] + 1 : 1;
        e = 0;
        for (f = b.length; e < f; e += 1)if (g = null != c ? c(b[e]) : b[e], h.hasOwnProperty(g)) {
            if (h[g] -= 1, 0 > h[g]) {
                d = !1;
                break
            }
        } else {
            d = !1;
            break
        }
    }
    return d
};
var mouseHandled2 = !1;
jQuery(document).mouseup(function () {
    mouseHandled2 = !1
});
jQuery.widget("ui.mouse2", {
    version: "1.10.1",
    options: {cancel: "input,textarea,button,select,option", distance: 1, delay: 0},
    _mouseInit: function (a) {
        var b = this;
        this.element2 = a;
        this.element2.bind("mousedown." + this.widgetName, function (a) {
            return b._mouseDown(a)
        }).bind("click." + this.widgetName, function (a) {
            if (!0 === jQuery.data(a.target, b.widgetName + ".preventClickEvent"))return jQuery.removeData(a.target, b.widgetName + ".preventClickEvent"), a.stopImmediatePropagation(), !1
        });
        this.started = !1
    },
    _mouseDestroy: function () {
        this.element2.unbind("." +
        this.widgetName);
        this._mouseMoveDelegate && jQuery(document).unbind("mousemove." + this.widgetName, this._mouseMoveDelegate).unbind("mouseup." + this.widgetName, this._mouseUpDelegate)
    },
    _mouseDown: function (a) {
        if (!mouseHandled2) {
            this._mouseStarted && this._mouseUp(a);
            this._mouseDownEvent = a;
            var b = this, c = 1 === a.which, d = "string" === typeof this.options.cancel && a.target.nodeName ? jQuery(a.target).closest(this.options.cancel).length : !1;
            if (!c || d || !this._mouseCapture(a))return !0;
            this.mouseDelayMet = !this.options.delay;
            this.mouseDelayMet || (this._mouseDelayTimer = setTimeout(function () {
                b.mouseDelayMet = !0
            }, this.options.delay));
            if (this._mouseDistanceMet(a) && this._mouseDelayMet(a) && (this._mouseStarted = !1 !== this._mouseStart(a), !this._mouseStarted))return a.preventDefault(), !0;
            !0 === jQuery.data(a.target, this.widgetName + ".preventClickEvent") && jQuery.removeData(a.target, this.widgetName + ".preventClickEvent");
            this._mouseMoveDelegate = function (a) {
                return b._mouseMove(a)
            };
            this._mouseUpDelegate = function (a) {
                return b._mouseUp(a)
            };
            jQuery(document).bind("mousemove." + this.widgetName, this._mouseMoveDelegate).bind("mouseup." + this.widgetName, this._mouseUpDelegate);
            a.preventDefault();
            return mouseHandled2 = !0
        }
    },
    _mouseMove: function (a) {
        if (jQuery.ui.ie && (!document.documentMode || 9 > document.documentMode) && !a.button)return this._mouseUp(a);
        if (this._mouseStarted)return this._mouseDrag(a), a.preventDefault();
        this._mouseDistanceMet(a) && this._mouseDelayMet(a) && ((this._mouseStarted = !1 !== this._mouseStart(this._mouseDownEvent, a)) ? this._mouseDrag(a) :
            this._mouseUp(a));
        return !this._mouseStarted
    },
    _mouseUp: function (a) {
        jQuery(document).unbind("mousemove." + this.widgetName, this._mouseMoveDelegate).unbind("mouseup." + this.widgetName, this._mouseUpDelegate);
        this._mouseStarted && (this._mouseStarted = !1, a.target === this._mouseDownEvent.target && jQuery.data(a.target, this.widgetName + ".preventClickEvent", !0), this._mouseStop(a));
        return !1
    },
    _mouseDistanceMet: function (a) {
        return Math.max(Math.abs(this._mouseDownEvent.pageX - a.pageX), Math.abs(this._mouseDownEvent.pageY -
            a.pageY)) >= this.options.distance
    },
    _mouseDelayMet: function () {
        return this.mouseDelayMet
    },
    _mouseStart: function () {
    },
    _mouseDrag: function () {
    },
    _mouseStop: function () {
    },
    _mouseCapture: function () {
        return !0
    }
});
primitives.common.AdviserPlacementType = {Auto: 0, Left: 2, Right: 3};
primitives.orgdiagram.AdviserPlacementType = primitives.common.AdviserPlacementType;
primitives.common.VerticalAlignmentType = {Top: 0, Middle: 1, Bottom: 2};
primitives.common.UpdateMode = {Recreate: 0, Refresh: 1, PositonHighlight: 2};
primitives.orgdiagram.UpdateMode = primitives.common.UpdateMode;
primitives.text.TextOrientationType = {Horizontal: 0, RotateLeft: 1, RotateRight: 2, Auto: 3};
primitives.common.SideFlag = {Top: 1, Right: 2, Bottom: 4, Left: 8};
primitives.common.ShapeType = {Rectangle: 0, Oval: 1, Triangle: 2, CrossOut: 3, Circle: 4, Rhombus: 5, None: 6};
primitives.common.SelectionPathMode = {None: 0, FullStack: 1};
primitives.orgdiagram.SelectionPathMode = primitives.common.SelectionPathMode;
primitives.common.SegmentType = {Line: 0, Move: 1, QuadraticArc: 2, CubicArc: 3, Dot: 4};
primitives.common.RenderingMode = {Create: 0, Update: 1};
primitives.common.PlacementType = {
    Auto: 0,
    TopLeft: 8,
    Top: 1,
    TopRight: 2,
    RightTop: 11,
    Right: 3,
    RightBottom: 12,
    BottomRight: 4,
    Bottom: 5,
    BottomLeft: 6,
    LeftBottom: 10,
    Left: 7,
    LeftTop: 9
};
primitives.common.PageFitMode = {None: 0, PageWidth: 1, PageHeight: 2, FitToPage: 3, PrintPreview: 4};
primitives.orgdiagram.PageFitMode = primitives.common.PageFitMode;
primitives.common.OrientationType = {Top: 0, Bottom: 1, Left: 2, Right: 3};
primitives.orgdiagram.OrientationType = primitives.common.OrientationType;
primitives.common.LineType = {Solid: 0, Dotted: 1, Dashed: 2};
primitives.common.Layers = {
    BackgroundAnnotations: 1,
    Connector: 2,
    Highlight: 3,
    Marker: 4,
    Label: 5,
    Cursor: 6,
    Item: 7,
    ForegroundAnnotations: 8,
    Annotation: 9,
    Controls: 10
};
primitives.common.LabelType = {Regular: 0, Dummy: 1, Fixed: 2};
primitives.orgdiagram.ItemType = {
    Regular: 0,
    Assistant: 1,
    Adviser: 2,
    SubAssistant: 4,
    SubAdviser: 5,
    GeneralPartner: 6,
    LimitedPartner: 7,
    AdviserPartner: 8
};
primitives.common.HorizontalAlignmentType = {Center: 0, Left: 1, Right: 2};
primitives.common.GroupByType = {None: 0, Parents: 1, Children: 2};
primitives.common.GraphicsType = {SVG: 0, Canvas: 1, VML: 2};
primitives.common.Enabled = {Auto: 0, True: 1, False: 2};
primitives.common.ElbowType = {None: 0, Dot: 1, Bevel: 2, Round: 3};
primitives.common.ConnectorType = {Squared: 0, Angular: 1, Curved: 2};
primitives.orgdiagram.ConnectorType = primitives.common.ConnectorType;
primitives.common.ConnectorStyleType = {Extra: 0, Regular: 1, Highlight: 2};
primitives.common.ConnectorShapeType = {OneWay: 0, TwoWay: 1};
primitives.common.ConnectorLabelPlacementType = {From: 0, Between: 1, To: 2};
primitives.common.Colors = {
    AliceBlue: "#f0f8ff",
    AntiqueWhite: "#faebd7",
    Aqua: "#00ffff",
    Aquamarine: "#7fffd4",
    Azure: "#f0ffff",
    Beige: "#f5f5dc",
    Bisque: "#ffe4c4",
    Black: "#000000",
    BlanchedAlmond: "#ffebcd",
    Blue: "#0000ff",
    BlueViolet: "#8a2be2",
    Brown: "#a52a2a",
    BurlyWood: "#deb887",
    Bronze: "#cd7f32",
    CadetBlue: "#5f9ea0",
    ChartReuse: "#7fff00",
    Chocolate: "#d2691e",
    Coral: "#ff7f50",
    CornflowerBlue: "#6495ed",
    Cornsilk: "#fff8dc",
    Crimson: "#dc143c",
    Cyan: "#00ffff",
    DarkBlue: "#00008b",
    DarkCyan: "#008b8b",
    DarkGoldenrod: "#b8860b",
    DarkGray: "#a9a9a9",
    DarkGreen: "#006400",
    DarkKhaki: "#bdb76b",
    DarkMagenta: "#8b008b",
    DarkOliveGreen: "#556b2f",
    Darkorange: "#ff8c00",
    DarkOrchid: "#9932cc",
    DarkRed: "#8b0000",
    DarkSalmon: "#e9967a",
    DarkSeaGreen: "#8fbc8f",
    DarkSlateBlue: "#483d8b",
    DarkSlateGray: "#2f4f4f",
    DarkTurquoise: "#00ced1",
    DarkViolet: "#9400d3",
    DeepPink: "#ff1493",
    DeepSkyBlue: "#00bfff",
    DimGray: "#696969",
    DodgerBlue: "#1e90ff",
    FireBrick: "#b22222",
    FloralWhite: "#fffaf0",
    ForestGreen: "#228b22",
    Fuchsia: "#ff00ff",
    Gainsboro: "#dcdcdc",
    GhostWhite: "#f8f8ff",
    Gold: "#ffd700",
    Goldenrod: "#daa520",
    Gray: "#808080",
    Green: "#008000",
    GreenYellow: "#adff2f",
    Honeydew: "#f0fff0",
    Hotpink: "#ff69b4",
    IndianRed: "#cd5c5c",
    Indigo: "#4b0082",
    Ivory: "#fffff0",
    Khaki: "#f0e68c",
    Lavender: "#e6e6fa",
    LavenderBlush: "#fff0f5",
    Lawngreen: "#7cfc00",
    Lemonchiffon: "#fffacd",
    LightBlue: "#add8e6",
    LightCoral: "#f08080",
    LightCyan: "#e0ffff",
    LightGoldenrodYellow: "#fafad2",
    LightGray: "#d3d3d3",
    LightGreen: "#90ee90",
    LightPink: "#ffb6c1",
    LightSalmon: "#ffa07a",
    LightSeaGreen: "#20b2aa",
    LightSkyBlue: "#87cefa",
    LightSlateGray: "#778899",
    LightSteelBlue: "#b0c4de",
    LightYellow: "#ffffe0",
    Lime: "#00ff00",
    Limegreen: "#32cd32",
    Linen: "#faf0e6",
    Magenta: "#ff00ff",
    Maroon: "#800000",
    MediumAquamarine: "#66cdaa",
    MediumBlue: "#0000cd",
    MediumOrchid: "#ba55d3",
    MediumPurple: "#9370d8",
    MediumSeaGreen: "#3cb371",
    MediumSlateBlue: "#7b68ee",
    MediumSpringGreen: "#00fa9a",
    MediumTurquoise: "#48d1cc",
    MediumVioletRed: "#c71585",
    MidnightBlue: "#191970",
    MintCream: "#f5fffa",
    MistyRose: "#ffe4e1",
    Moccasin: "#ffe4b5",
    NavajoWhite: "#ffdead",
    Navy: "#000080",
    Oldlace: "#fdf5e6",
    Olive: "#808000",
    Olivedrab: "#6b8e23",
    Orange: "#ffa500",
    OrangeRed: "#ff4500",
    Orchid: "#da70d6",
    PaleGoldenRod: "#eee8aa",
    PaleGreen: "#98fb98",
    PaleTurquoise: "#afeeee",
    PaleVioletRed: "#d87093",
    Papayawhip: "#ffefd5",
    Peachpuff: "#ffdab9",
    Peru: "#cd853f",
    Pink: "#ffc0cb",
    Plum: "#dda0dd",
    PowderBlue: "#b0e0e6",
    Purple: "#800080",
    Red: "#ff0000",
    RosyBrown: "#bc8f8f",
    RoyalBlue: "#4169e1",
    SaddleBrown: "#8b4513",
    Salmon: "#fa8072",
    SandyBrown: "#f4a460",
    SeaGreen: "#2e8b57",
    Seashell: "#fff5ee",
    Sienna: "#a0522d",
    Silver: "#c0c0c0",
    SkyBlue: "#87ceeb",
    SlateBlue: "#6a5acd",
    SlateGray: "#708090",
    Snow: "#fffafa",
    SpringGreen: "#00ff7f",
    SteelBlue: "#4682b4",
    Tan: "#d2b48c",
    Teal: "#008080",
    Thistle: "#d8bfd8",
    Tomato: "#ff6347",
    Turquoise: "#40e0d0",
    Violet: "#ee82ee",
    Wheat: "#f5deb3",
    White: "#ffffff",
    WhiteSmoke: "#f5f5f5",
    Yellow: "#ffff00",
    YellowGreen: "#9acd32"
};
primitives.common.ChildrenPlacementType = {Auto: 0, Vertical: 1, Horizontal: 2, Matrix: 3};
primitives.orgdiagram.ChildrenPlacementType = primitives.common.ChildrenPlacementType;
primitives.common.AnnotationType = {Connector: 0, Shape: 1, HighlightPath: 2, Label: 3};
primitives.common.Visibility = {Auto: 0, Normal: 1, Dot: 2, Line: 3, Invisible: 4};
primitives.common.ZOrderType = {Auto: 0, Background: 1, Foreground: 2};
primitives.common.RenderEventArgs = function () {
    this.renderingMode = this.templateName = this.context = this.element = null;
    this.isSelected = this.isCursor = !1
};
primitives.common.BaseShape = function () {
};
primitives.common.BaseShape.prototype._getLabelPosition = function (a, b, c, d, e, f, g, h) {
    var j = null;
    switch (h) {
        case 1:
            j = new primitives.common.Rect(a + c / 2 - e / 2, b - g - f, e, f);
            break;
        case 2:
            j = new primitives.common.Rect(a + c - e, b - g - f, e, f);
            break;
        case 8:
            j = new primitives.common.Rect(a, b - g - f, e, f);
            break;
        case 3:
            j = new primitives.common.Rect(a + c + g, b + d / 2 - f / 2, e, f);
            break;
        case 11:
            j = new primitives.common.Rect(a + c + g, b, e, f);
            break;
        case 12:
            j = new primitives.common.Rect(a + c + g, b + d - f, e, f);
            break;
        case 4:
            j = new primitives.common.Rect(a + c - e,
                b + d + g, e, f);
            break;
        case 6:
            j = new primitives.common.Rect(a, b + d + g, e, f);
            break;
        case 7:
            j = new primitives.common.Rect(a - e - g, b + d / 2 - f / 2, e, f);
            break;
        case 9:
            j = new primitives.common.Rect(a - e - g, b, e, f);
            break;
        case 10:
            j = new primitives.common.Rect(a - e - g, b + d - f, e, f);
            break;
        default:
            j = new primitives.common.Rect(a + c / 2 - e / 2, b + d + g, e, f)
    }
    return j
};
primitives.common.BaseShape.prototype._getArrow = function (a, b, c, d, e) {
    for (var f = [], g, h, j, i = [new primitives.common.Point(c, -d / 2), new primitives.common.Point(0, 0), new primitives.common.Point(c, d / 2), new primitives.common.Point(3 * (c / 4), 0)], c = 0, d = i.length; c < d; c += 1)g = i[c], h = g.x * Math.cos(e) - g.y * Math.sin(e), j = g.x * Math.sin(e) + g.y * Math.cos(e), g.x = h + a, g.y = j + b;
    f.push(new primitives.common.MoveSegment(i[0].x, i[0].y));
    f.push(new primitives.common.LineSegment(i[1].x, i[1].y));
    f.push(new primitives.common.LineSegment(i[2].x,
        i[2].y));
    f.push(new primitives.common.QuadraticArcSegment(i[3].x, i[3].y, i[0].x, i[0].y));
    return f
};
primitives.common.BaseShape.prototype._quadraticBezierPoint = function (a, b, c, d) {
    return new primitives.common.Point((1 - d) * (1 - d) * a.x + 2 * (1 - d) * d * b.x + d * d * c.x, (1 - d) * (1 - d) * a.y + 2 * (1 - d) * d * b.y + d * d * c.y)
};
primitives.common.BaseShape.prototype._betweenPoint = function (a, b) {
    return new primitives.common.Point((a.x + b.x) / 2, (a.y + b.y) / 2)
};
primitives.common.BaseShape.prototype._offsetPoint = function (a, b, c) {
    var d = null, d = a.distanceTo(b);
    return d = 0 == d || 0 == c ? new primitives.common.Point(a) : new primitives.common.Point(a.x + (b.x - a.x) / d * c, a.y + (b.y - a.y) / d * c)
};
primitives.common.Callout = function (a) {
    this.m_graphics = a;
    this.pointerPlacement = 0;
    this.cornerRadius = "10%";
    this.offset = 0;
    this.lineWidth = this.opacity = 1;
    this.pointerWidth = "10%";
    this.borderColor = "#000000";
    this.lineType = 0;
    this.fillColor = "#d3d3d3";
    this.m_map = [[8, 7, 6], [1, null, 5], [2, 3, 4]]
};
primitives.common.Callout.prototype = new primitives.common.BaseShape;
primitives.common.Callout.prototype.draw = function (a, b) {
    var b = (new primitives.common.Rect(b)).offset(this.offset), c = new primitives.common.Point(b.x, b.y), d = new primitives.common.Point(b.right(), b.y), e = new primitives.common.Point(b.right(), b.bottom()), f = new primitives.common.Point(b.left(), b.bottom()), g = [null, null, null, null, null, null, null, null], f = [c, d, e, f], d = this.m_graphics.getPxSize(this.cornerRadius, Math.min(c.distanceTo(d), d.distanceTo(e))), h;
    null !== a && (c = 0 === this.pointerPlacement ? this._getPlacement(a,
        c, e) : this.pointerPlacement, null !== c && (g[c] = a));
    c = [];
    for (h = 0; h < f.length; h += 1)this._drawSegment(c, f[0], f[1], f[2], this.pointerWidth, d, g[1], g[2]), e = f.shift(), f.push(e), e = g.shift(), g.push(e), e = g.shift(), g.push(e);
    g = {};
    null !== this.fillColor && (g.fillColor = this.fillColor, g.opacity = this.opacity);
    null !== this.borderColor && (g.borderColor = this.borderColor);
    g.lineWidth = this.lineWidth;
    g.lineType = this.lineType;
    this.m_graphics.polyline(c, g)
};
primitives.common.Callout.prototype._getPlacement = function (a, b, c) {
    var d = null, e = null, d = a.x < b.x ? 0 : a.x > c.x ? 2 : 1, e = a.y < b.y ? 0 : a.y > c.y ? 2 : 1;
    return this.m_map[d][e]
};
primitives.common.Callout.prototype._drawSegment = function (a, b, c, d, e, f, g, h) {
    var j = this._offsetPoint(b, c, f), i = this._offsetPoint(c, b, f), d = this._offsetPoint(c, d, f), e = this.m_graphics.getPxSize(e, b.distanceTo(c) / 2);
    0 === a.length && a.push(new primitives.common.MoveSegment(j));
    null !== g && (j = this._betweenPoint(b, c), b = this._offsetPoint(j, b, e), e = this._offsetPoint(j, c, e), a.push(new primitives.common.LineSegment(b)), a.push(new primitives.common.LineSegment(g)), a.push(new primitives.common.LineSegment(e)));
    a.push(new primitives.common.LineSegment(i));
    null !== h ? (a.push(new primitives.common.LineSegment(h)), a.push(new primitives.common.LineSegment(d))) : a.push(new primitives.common.QuadraticArcSegment(c, d))
};
primitives.common.Connector = function (a) {
    this.m_graphics = a;
    this.transform = null;
    this.orientationType = 0;
    this.panelSize = null;
    this.connectorShapeType = 1;
    this.offset = 0;
    this.lineWidth = 1;
    this.labelOffset = 4;
    this.labelSize = new primitives.common.Size(60, 30);
    this.lineType = 0;
    this.labelPlacementType = primitives.common.ConnectorLabelPlacementType.Between;
    this.color = "#000000";
    this.hasLabel = !1;
    this.labelTemplateHashCode = this.labelTemplate = null
};
primitives.common.Connector.prototype = new primitives.common.BaseShape;
primitives.common.Connector.prototype.draw = function (a, b, c) {
    var d, e, f, g = [], h = [], j, i, k, l, m, n, p, q;
    j = 6 * this.lineWidth;
    var r = 4 * this.lineWidth;
    q = 1.5 * r;
    var s, t, v = 0, w = 0, u, a = (new primitives.common.Rect(a)).offset(this.offset), b = (new primitives.common.Rect(b)).offset(this.offset);
    l = [];
    switch (this.connectorShapeType) {
        case 1:
            l = [-q / 2, q / 2];
            break;
        case 0:
            l = [0]
    }
    this.transform = new primitives.common.Transform;
    this.transform.size = this.panelSize;
    this.transform.setOrientation(this.orientationType);
    this.transform.transformRect(a.x,
        a.y, a.width, a.height, !1, this, function (b, c, d, e) {
            a = new primitives.common.Rect(b, c, d, e)
        });
    this.transform.transformRect(b.x, b.y, b.width, b.height, !1, this, function (a, c, d, e) {
        b = new primitives.common.Rect(a, c, d, e)
    });
    this.transform.transformRect(0, 0, this.labelSize.width, this.labelSize.height, !1, this, function (a, b, c, d) {
        s = new primitives.common.Size(c, d)
    });
    this.transform.transformRect(0, 0, this.panelSize.width, this.panelSize.height, !1, this, function (a, b, c, d) {
        u = new primitives.common.Size(c, d)
    });
    v = Math.max(this.hasLabel ?
        s.width : 0, 5 * j);
    if (a.right() + v < b.left() || a.left() > b.right() + v)if (a.left() > b.right() ? (d = new primitives.common.Point(a.left(), a.verticalCenter()), e = new primitives.common.Point(b.right(), b.verticalCenter()), v = 7, w = 3) : (d = new primitives.common.Point(a.right(), a.verticalCenter()), e = new primitives.common.Point(b.left(), b.verticalCenter()), v = 3, w = 7), f = new primitives.common.Rect(d, e), p = d.y <= e.y, n = d.x < e.x, f.height < f.width) {
        f.height < 2 * j && f.offset(0, p ? 2 * j : 0, 0, p ? 0 : 2 * j);
        i = 0;
        for (k = l.length; i < k; i += 1)m = l[i], g.push(new primitives.common.MoveSegment(d.x,
            d.y + m)), g.push(new primitives.common.QuadraticArcSegment(f.horizontalCenter(), (p ? f.top() : f.bottom()) + m, e.x, e.y + m));
        l = s.width < 2 * (f.width / 5) ? this._quadraticBezierPoint(d, new primitives.common.Point(f.horizontalCenter(), p ? f.top() : f.bottom()), e, 0.5) : new primitives.common.Point(d.x, p ? f.top() : f.bottom());
        t = new primitives.common.Rect(l.x + (n ? q : -s.width - q), p ? l.y - s.height - j : l.y + j, s.width, s.height)
    } else {
        i = 0;
        for (k = l.length; i < k; i += 1)m = l[i], g.push(new primitives.common.MoveSegment(d.x, d.y + m)), g.push(new primitives.common.QuadraticArcSegment(f.horizontalCenter() +
        m * (p != n ? 1 : -1), (p ? f.top() : f.bottom()) + m, f.horizontalCenter() + m * (p != n ? 1 : -1), f.verticalCenter() + m)), g.push(new primitives.common.QuadraticArcSegment(f.horizontalCenter() + m * (p != n ? 1 : -1), (p ? f.bottom() : f.top()) + m, e.x, e.y + m));
        t = new primitives.common.Rect(f.horizontalCenter() + (p != n ? q : -(q + s.width)), f.verticalCenter() - s.height / 2, s.width, s.height)
    } else if (a.verticalCenter() < b.top() || a.verticalCenter() > b.bottom()) {
        n = a.x < u.width / 2;
        d = new primitives.common.Point(n ? a.right() : a.left(), a.verticalCenter());
        e = new primitives.common.Point(n ?
            b.right() : b.left(), b.verticalCenter());
        w = v = n ? 3 : 7;
        f = new primitives.common.Rect(d, e);
        f.offset(10 * j, 0, 10 * j, 0);
        p = d.y <= e.y;
        i = 0;
        for (k = l.length; i < k; i += 1)m = l[i], g.push(new primitives.common.MoveSegment(d.x, d.y + m)), g.push(new primitives.common.QuadraticArcSegment(n ? f.right() + m * (p ? -1 : 1) : f.left() - m * (p ? -1 : 1), f.verticalCenter(), n ? b.right() : b.left(), b.verticalCenter() - m));
        l = this._quadraticBezierPoint(d, new primitives.common.Point(n ? f.right() : f.left(), f.verticalCenter()), e, 0.5);
        t = new primitives.common.Rect(l.x +
        (n ? q / 2 : -q / 2 - s.width), l.y - s.height / 2, s.width, s.height)
    } else {
        d = new primitives.common.Point(a.horizontalCenter(), a.top());
        e = new primitives.common.Point(b.horizontalCenter(), b.top());
        w = v = 1;
        f = new primitives.common.Rect(d, e);
        f.offset(0, 7 * j, 0, 0);
        n = d.x < e.x;
        i = 0;
        for (k = l.length; i < k; i += 1)m = l[i], g.push(new primitives.common.MoveSegment(d.x + m, d.y)), g.push(new primitives.common.QuadraticArcSegment(f.horizontalCenter(), f.top() - m * (n ? -1 : 1), b.horizontalCenter() - m, b.top()));
        l = this._quadraticBezierPoint(d, new primitives.common.Point(f.horizontalCenter(),
            f.top()), e, 0.5);
        t = new primitives.common.Rect(l.x - s.width / 2, l.y - (this.labelOffset + s.height), s.width, s.height)
    }
    if (0 < g.length) {
        this.transform.transformSegments(g, !0);
        switch (this.connectorShapeType) {
            case 1:
                l = g[g.length / 2 - 1];
                n = Math.atan2(l.cpY - l.y, l.cpX - l.x);
                h = h.concat(this._getArrow(l.x, l.y, j, r, n));
                n = this._offsetPoint(new primitives.common.Point(l.x, l.y), new primitives.common.Point(l.cpX, l.cpY), r);
                l.x = n.x;
                l.y = n.y;
                q = g[g.length / 2];
                l = g[g.length / 2 + 1];
                n = Math.atan2(l.cpY - q.y, l.cpX - q.x);
                h = h.concat(this._getArrow(q.x,
                    q.y, j, r, n));
                n = this._offsetPoint(new primitives.common.Point(q.x, q.y), new primitives.common.Point(l.cpX, l.cpY), r);
                q.x = n.x;
                q.y = n.y;
                break;
            case 0:
                l = g[g.length - 1], n = Math.atan2(l.cpY - l.y, l.cpX - l.x), h = h.concat(this._getArrow(l.x, l.y, j, r, n)), n = this._offsetPoint(new primitives.common.Point(l.x, l.y), new primitives.common.Point(l.cpX, l.cpY), r), l.x = n.x, l.y = n.y
        }
        j = {};
        null !== this.borderColor && (j.borderColor = this.color);
        j.lineWidth = this.lineWidth;
        j.lineType = this.lineType;
        this.m_graphics.polyline(g, j);
        g = {opacity: 1};
        null !== this.fillColor && (g.fillColor = this.color);
        null !== this.borderColor && (g.borderColor = this.color);
        g.lineWidth = 0;
        this.m_graphics.polyline(h, g);
        if (this.hasLabel) {
            switch (this.labelPlacementType) {
                case primitives.common.ConnectorLabelPlacementType.From:
                    t = this._getLabelPosition(a.x, a.y, a.width, a.height, t.width, t.height, this.labelOffset, v);
                    break;
                case primitives.common.ConnectorLabelPlacementType.To:
                    t = this._getLabelPosition(b.x, b.y, b.width, b.height, t.width, t.height, this.labelOffset, w)
            }
            this.transform.transformRect(t.x,
                t.y, t.width, t.height, !0, this, function (a, b, c, d) {
                    t = new primitives.common.Rect(a, b, c, d)
                });
            this.m_graphics.template(t.x, t.y, 0, 0, 0, 0, t.width, t.height, this.labelTemplate, this.labelTemplateHashCode, "onAnnotationLabelTemplateRender", c, null)
        }
    }
};
primitives.common.Shape = function (a) {
    this.m_graphics = a;
    this.transform = null;
    this.orientationType = 0;
    this.panelSize = null;
    this.shapeType = 0;
    this.offset = new primitives.common.Thickness(0, 0, 0, 0);
    this.lineWidth = 1;
    this.labelOffset = 4;
    this.cornerRadius = "10%";
    this.opacity = 1;
    this.fillColor = null;
    this.labelSize = new primitives.common.Size(60, 30);
    this.lineType = 0;
    this.borderColor = null;
    this.hasLabel = !1;
    this.labelTemplateHashCode = this.labelTemplate = null;
    this.labelPlacement = 0
};
primitives.common.Shape.prototype = new primitives.common.BaseShape;
primitives.common.Shape.prototype.draw = function (a, b) {
    var c = [], d, e, f, a = (new primitives.common.Rect(a)).offset(this.offset);
    this.transform = new primitives.common.Transform;
    this.transform.size = this.panelSize;
    this.transform.setOrientation(this.orientationType);
    this.hasLabel && (e = this._getLabelPosition(a.x, a.y, a.width, a.height, this.labelSize.width, this.labelSize.height, this.labelOffset, this.labelPlacement));
    switch (this.shapeType) {
        case 0:
            c = new primitives.common.Callout(this.m_graphics);
            c.cornerRadius = this.cornerRadius;
            c.opacity = this.opacity;
            c.lineWidth = this.lineWidth;
            c.lineType = this.lineType;
            c.borderColor = this.borderColor;
            c.fillColor = this.fillColor;
            c.draw(null, a);
            break;
        default:
            this.transform.transformRect(a.x, a.y, a.width, a.height, !1, this, function (b, c, d, e) {
                a = new primitives.common.Rect(b, c, d, e)
            });
            switch (this.shapeType) {
                case 4:
                    d = Math.min(a.width / 2, a.height / 2), a = new primitives.common.Rect(a.horizontalCenter() - d, a.verticalCenter() - d, 2 * d, 2 * d);
                case 1:
                    d = 0.5522848 * (a.width / 2);
                    f = 0.5522848 * (a.height / 2);
                    c.push(new primitives.common.MoveSegment(a.x,
                        a.verticalCenter()));
                    c.push(new primitives.common.CubicArcSegment(a.x, a.verticalCenter() - f, a.horizontalCenter() - d, a.y, a.horizontalCenter(), a.y));
                    c.push(new primitives.common.CubicArcSegment(a.horizontalCenter() + d, a.y, a.right(), a.verticalCenter() - f, a.right(), a.verticalCenter()));
                    c.push(new primitives.common.CubicArcSegment(a.right(), a.verticalCenter() + f, a.horizontalCenter() + d, a.bottom(), a.horizontalCenter(), a.bottom()));
                    c.push(new primitives.common.CubicArcSegment(a.horizontalCenter() - d, a.bottom(),
                        a.x, a.verticalCenter() + f, a.x, a.verticalCenter()));
                    break;
                case 5:
                    c.push(new primitives.common.MoveSegment(a.horizontalCenter(), a.bottom()));
                    c.push(new primitives.common.LineSegment(a.left(), a.verticalCenter()));
                    c.push(new primitives.common.LineSegment(a.horizontalCenter(), a.y));
                    c.push(new primitives.common.LineSegment(a.right(), a.verticalCenter()));
                    c.push(new primitives.common.LineSegment(a.horizontalCenter(), a.bottom()));
                    break;
                case 2:
                    c.push(new primitives.common.MoveSegment(a.left(), a.bottom()));
                    c.push(new primitives.common.LineSegment(a.horizontalCenter(),
                        a.y));
                    c.push(new primitives.common.LineSegment(a.right(), a.bottom()));
                    c.push(new primitives.common.LineSegment(a.left(), a.bottom()));
                    break;
                case 3:
                    c.push(new primitives.common.MoveSegment(a.horizontalCenter(), a.verticalCenter())), c.push(new primitives.common.LineSegment(a.x, a.y)), c.push(new primitives.common.MoveSegment(a.horizontalCenter(), a.verticalCenter())), c.push(new primitives.common.LineSegment(a.right(), a.bottom())), c.push(new primitives.common.MoveSegment(a.horizontalCenter(), a.verticalCenter())),
                        c.push(new primitives.common.LineSegment(a.right(), a.y)), c.push(new primitives.common.MoveSegment(a.horizontalCenter(), a.verticalCenter())), c.push(new primitives.common.LineSegment(a.left(), a.bottom()))
            }
            this.transform.transformSegments(c, !0);
            d = {};
            null !== this.fillColor && (d.fillColor = this.fillColor, d.opacity = this.opacity);
            null !== this.borderColor && (d.borderColor = this.borderColor);
            d.lineWidth = this.lineWidth;
            d.lineType = this.lineType;
            this.m_graphics.polyline(c, d)
    }
    this.hasLabel && this.m_graphics.template(e.x,
        e.y, 0, 0, 0, 0, e.width, e.height, this.labelTemplate, this.labelTemplateHashCode, "onAnnotationLabelTemplateRender", b, null)
};
primitives.common.Point = function (a, b) {
    this.y = this.x = null;
    switch (arguments.length) {
        case 1:
            this.x = a.x;
            this.y = a.y;
            break;
        case 2:
            this.x = a, this.y = b
    }
};
primitives.common.Point.prototype.distanceTo = function (a, b) {
    var c = 0, d = 0;
    switch (arguments.length) {
        case 1:
            c = a.x;
            d = a.y;
            break;
        case 2:
            c = a, d = b
    }
    c = this.x - c;
    d = this.y - d;
    return Math.sqrt(c * c + d * d)
};
primitives.common.Point.prototype.toString = function (a) {
    var b, a = void 0 !== a ? a : "px";
    b = "" + ("left:" + this.x + a + ";");
    return b += "top:" + this.y + a + ";"
};
primitives.common.CubicArcSegment = function (a, b, c, d, e, f) {
    this.cpY2 = this.cpX2 = this.cpY1 = this.cpX1 = this.y = this.x = null;
    switch (arguments.length) {
        case 3:
            this.x = c.x;
            this.y = c.y;
            this.cpX1 = a.x;
            this.cpY1 = a.y;
            this.cpX2 = b.x;
            this.cpY2 = b.y;
            break;
        case 6:
            this.cpX1 = a, this.cpY1 = b, this.cpX2 = c, this.cpY2 = d, this.x = e, this.y = f
    }
    this.segmentType = 3
};
primitives.common.DotSegment = function (a, b, c, d, e) {
    this.segmentType = 4;
    this.x = a;
    this.y = b;
    this.width = c;
    this.height = d;
    this.cornerRadius = e
};
primitives.common.Label = function () {
    this.position = this.text = null;
    this.weight = 0;
    this.isActive = !0;
    this.horizontalAlignmentType = this.labelOrientation = this.labelType = 0;
    this.verticalAlignmentType = 2
};
primitives.common.LineSegment = function () {
    this.parent = primitives.common.Point.prototype;
    this.parent.constructor.apply(this, arguments);
    this.segmentType = 0
};
primitives.common.LineSegment.prototype = new primitives.common.Point;
primitives.common.MoveSegment = function () {
    this.parent = primitives.common.Point.prototype;
    this.parent.constructor.apply(this, arguments);
    this.segmentType = 1
};
primitives.common.MoveSegment.prototype = new primitives.common.Point;
primitives.common.QuadraticArcSegment = function (a, b, c, d) {
    this.cpY = this.cpX = this.y = this.x = null;
    switch (arguments.length) {
        case 2:
            this.x = b.x;
            this.y = b.y;
            this.cpX = a.x;
            this.cpY = a.y;
            break;
        case 4:
            this.cpX = a, this.cpY = b, this.x = c, this.y = d
    }
    this.segmentType = 2
};
primitives.common.Rect = function (a, b, c, d) {
    this.height = this.width = this.y = this.x = null;
    switch (arguments.length) {
        case 1:
            this.x = a.x;
            this.y = a.y;
            this.width = a.width;
            this.height = a.height;
            break;
        case 2:
            this.x = Math.min(a.x, b.x);
            this.y = Math.min(a.y, b.y);
            this.width = Math.abs(b.x - a.x);
            this.height = Math.abs(b.y - a.y);
            break;
        case 4:
            this.x = a, this.y = b, this.width = c, this.height = d
    }
};
primitives.common.Rect.prototype.left = function () {
    return this.x
};
primitives.common.Rect.prototype.top = function () {
    return this.y
};
primitives.common.Rect.prototype.right = function () {
    return this.x + this.width
};
primitives.common.Rect.prototype.bottom = function () {
    return this.y + this.height
};
primitives.common.Rect.prototype.verticalCenter = function () {
    return this.y + this.height / 2
};
primitives.common.Rect.prototype.horizontalCenter = function () {
    return this.x + this.width / 2
};
primitives.common.Rect.prototype.isEmpty = function () {
    return null === this.x || null === this.y || null === this.width || null === this.height || 0 > this.width || 0 > this.height
};
primitives.common.Rect.prototype.offset = function (a, b, c, d) {
    switch (arguments.length) {
        case 1:
            null !== a && "object" == typeof a ? (this.x -= a.left, this.y -= a.top, this.width = this.width + a.left + a.right, this.height = this.height + a.top + a.bottom) : (this.x -= a, this.y -= a, this.width += 2 * a, this.height += 2 * a);
            break;
        case 4:
            this.x -= a, this.y -= b, this.width = this.width + a + c, this.height = this.height + b + d
    }
    return this
};
primitives.common.Rect.prototype.translate = function (a, b) {
    this.x += a;
    this.y += b;
    return this
};
primitives.common.Rect.prototype.invert = function () {
    var a = this.width, b = this.x;
    this.width = this.height;
    this.height = a;
    this.x = this.y;
    this.y = b;
    return this
};
primitives.common.Rect.prototype.contains = function (a, b) {
    switch (arguments.length) {
        case 1:
            return this.x <= a.x && a.x <= this.x + this.width && this.y <= a.y && a.y <= this.y + this.height;
        case 2:
            return this.x <= a && a <= this.x + this.width && this.y <= b && b <= this.y + this.height;
        default:
            return !1
    }
};
primitives.common.Rect.prototype.cropByRect = function (a) {
    this.x < a.x && (this.width -= a.x - this.x, this.x = a.x);
    this.right() > a.right() && (this.width -= this.right() - a.right());
    this.y < a.y && (this.height -= a.y - this.y, this.y = a.y);
    this.bottom() > a.bottom() && (this.height -= this.bottom() - a.bottom());
    this.isEmpty() && (this.height = this.width = this.y = this.x = null);
    return this
};
primitives.common.Rect.prototype.overlaps = function (a) {
    var b = !0;
    if (this.x + this.width < a.x || a.x + a.width < this.x || this.y + this.height < a.y || a.y + a.height < this.y)b = !1;
    return b
};
primitives.common.Rect.prototype.addRect = function (a, b, c, d) {
    var e, f;
    switch (arguments.length) {
        case 1:
            a.isEmpty() || (this.isEmpty() ? (this.x = a.x, this.y = a.y, this.width = a.width, this.height = a.height) : (e = Math.max(this.right(), a.right()), f = Math.max(this.bottom(), a.bottom()), this.x = Math.min(this.x, a.x), this.y = Math.min(this.y, a.y), this.width = e - this.x, this.height = f - this.y));
            break;
        case 2:
            this.isEmpty() ? (this.x = a, this.y = b, this.height = this.width = 0) : (e = Math.max(this.right(), a), f = Math.max(this.bottom(), b), this.x = Math.min(this.x,
                a), this.y = Math.min(this.y, b), this.width = e - this.x, this.height = f - this.y);
            break;
        case 4:
            this.isEmpty() ? (this.x = a, this.y = b, this.width = c, this.height = d) : (e = Math.max(this.right(), a + c), f = Math.max(this.bottom(), b + d), this.x = Math.min(this.x, a), this.y = Math.min(this.y, b), this.width = e - this.x, this.height = f - this.y)
    }
    return this
};
primitives.common.Rect.prototype.getCSS = function (a) {
    a = void 0 !== a ? a : "px";
    return {left: this.x + a, top: this.y + a, width: this.width + a, height: this.height + a}
};
primitives.common.Rect.prototype.toString = function (a) {
    var b, a = void 0 !== a ? a : "px";
    b = "" + ("left:" + this.x + a + ";");
    b += "top:" + this.y + a + ";";
    b += "width:" + this.width + a + ";";
    return b += "height:" + this.height + a + ";"
};
primitives.common.Size = function (a, b) {
    this.height = this.width = 0;
    switch (arguments.length) {
        case 1:
            this.width = a.width;
            this.height = a.height;
            break;
        case 2:
            this.width = a, this.height = b
    }
};
primitives.common.Size.prototype.invert = function () {
    var a = this.width;
    this.width = this.height;
    this.height = a;
    return this
};
primitives.common.Thickness = function (a, b, c, d) {
    this.left = a;
    this.top = b;
    this.right = c;
    this.bottom = d
};
primitives.common.Thickness.prototype.isEmpty = function () {
    return 0 === this.left && 0 === this.top && 0 === this.right && 0 === this.bottom
};
primitives.common.Thickness.prototype.toString = function (a) {
    a = void 0 !== a ? a : "px";
    return this.left + a + ", " + this.top + a + ", " + this.right + a + ", " + this.bottom + a
};
primitives.common.Graphics = function (a) {
    this.m_widget = a;
    this.m_placeholders = {};
    this.m_activePlaceholder = null;
    this.m_cache = new primitives.common.Cache;
    this.boxModel = jQuery.support.boxModel;
    this.graphicsType = null;
    this.debug = this.hasGraphics = !1
};
primitives.common.Graphics.prototype.clean = function () {
    var a, b, c, d;
    this.m_cache.clear();
    this.m_widget = this.m_cache = null;
    for (a in this.m_placeholders)if (this.m_placeholders.hasOwnProperty(a)) {
        b = this.m_placeholders[a];
        for (c in b.layers)b.layers.hasOwnProperty(c) && (d = b.layers[c], d.canvas.remove(), d.canvas = null);
        b.layers.length = 0;
        b.activeLayer = null;
        b.size = null;
        b.rect = null;
        b.div = null
    }
    this.m_placeholders.length = 0;
    this.m_activePlaceholder = null
};
primitives.common.Graphics.prototype.resize = function (a, b, c) {
    a = this.m_placeholders[a];
    null != a && this.resizePlaceholder(a, b, c)
};
primitives.common.Graphics.prototype.resizePlaceholder = function (a, b, c) {
    var d;
    a.size = new primitives.common.Size(b, c);
    a.rect = new primitives.common.Rect(0, 0, b, c);
    for (d in a.layers)a.layers.hasOwnProperty(d) && (b = a.layers[d], -1 !== b.name && b.canvas.css({
        position: "absolute",
        width: "0px",
        height: "0px"
    }))
};
primitives.common.Graphics.prototype.begin = function () {
    this.m_cache.begin()
};
primitives.common.Graphics.prototype.end = function () {
    this.m_cache.end()
};
primitives.common.Graphics.prototype.reset = function (a, b) {
    var c = "none", d = -1;
    switch (arguments.length) {
        case 1:
            "string" === typeof a ? c = a : d = a;
            break;
        case 2:
            c = a, d = b
    }
    this.m_cache.reset(c, d)
};
primitives.common.Graphics.prototype.activate = function (a, b) {
    switch (arguments.length) {
        case 1:
            "string" === typeof a ? (this._activatePlaceholder(a), this._activateLayer(-1)) : (this._activatePlaceholder("none"), this._activateLayer(a));
            break;
        case 2:
            this._activatePlaceholder(a), this._activateLayer(b)
    }
    return this.m_activePlaceholder
};
primitives.common.Graphics.prototype._activatePlaceholder = function (a) {
    var b = this.m_placeholders[a], c;
    void 0 === b && (c = "none" === a ? this.m_widget.element : this.m_widget.element.find("." + a), b = new primitives.common.Placeholder(a), b.div = c, b.size = new primitives.common.Size(c.innerWidth(), c.innerHeight()), b.rect = new primitives.common.Rect(0, 0, b.size.width, b.size.height), this.m_placeholders[a] = b);
    this.m_activePlaceholder = b
};
primitives.common.Graphics.prototype._activateLayer = function (a) {
    var b = this.m_activePlaceholder.layers[a], c, d, e, f;
    if (void 0 === b) {
        c = this.m_activePlaceholder;
        if (-1 === a)b = new primitives.common.Layer(a), b.canvas = c.div; else {
            d = jQuery("<div></div>");
            d.addClass("Layer" + a);
            new primitives.common.Rect(c.rect);
            d.css({position: "absolute", width: "0px", height: "0px"});
            e = null;
            for (f in c.layers)c.layers.hasOwnProperty(f) && (b = c.layers[f], b.name < a && (e = null !== e ? Math.max(e, b.name) : b.name));
            b = new primitives.common.Layer(a);
            b.canvas = d;
            null === e ? c.div.prepend(b.canvas[0]) : b.canvas.insertAfter(c.layers[e].canvas)
        }
        c.layers[a] = b
    }
    this.m_activePlaceholder.activeLayer = b
};
primitives.common.Graphics.prototype.text = function (a, b, c, d, e, f, g, h, j) {
    var i = this.m_activePlaceholder, g = {
        position: "absolute",
        padding: 0,
        margin: 0,
        "text-align": this._getTextAlign(g),
        "font-size": j["font-size"],
        "font-family": j["font-family"],
        "font-weight": j["font-weight"],
        "font-style": j["font-style"],
        color: j["font-color"],
        "line-height": j["font-size"]
    }, j = "";
    switch (f) {
        case 0:
        case 3:
            g.left = a;
            g.top = b;
            g.width = c;
            g.height = d;
            break;
        case 1:
            g.left = a + Math.round(c / 2 - d / 2);
            g.top = b + Math.round(d / 2 - c / 2);
            g.width = d;
            g.height =
                c;
            j = "rotate(-90deg)";
            break;
        case 2:
            g.left = a + Math.round(c / 2 - d / 2), g.top = b + Math.round(d / 2 - c / 2), g.width = d, g.height = c, j = "rotate(90deg)"
    }
    g["-webkit-transform-origin"] = "center center";
    g["-moz-transform-origin"] = "center center";
    g["-o-transform-origin"] = "center center";
    g["-ms-transform-origin"] = "center center";
    g["-webkit-transform"] = j;
    g["-moz-transform"] = j;
    g["-o-transform"] = j;
    g["-ms-transform"] = j;
    g.transform = j;
    g["max-width"] = g.width;
    g["max-height"] = g.height;
    e = e.replace(RegExp("\n", "g"), "<br/>");
    switch (h) {
        case 0:
            this.debug &&
            (g.border = "solid 1px black");
            a = this.m_cache.get(i.name, i.activeLayer.name, "text");
            null === a ? (a = jQuery("<div></div>"), a.css(g), a.html(e), i.activeLayer.canvas.append(a), this.m_cache.put(i.name, i.activeLayer.name, "text", a)) : (a.css(g), a.html(e));
            break;
        default:
            g["border-collapse"] = "collapse", b = {
                "vertical-align": this._getVerticalAlignment(h),
                padding: 0
            }, this.debug && (b.border = "solid 1px black"), a = this.m_cache.get(i.name, i.activeLayer.name, "textintable"), null === a ? (a = jQuery("<table><tbody><tr><td></td></tr></tbody></table>"),
                primitives.common.css(a, g), a.find("td").css(b).html(e), i.activeLayer.canvas.append(a), this.m_cache.put(i.name, i.activeLayer.name, "textintable", a)) : (primitives.common.css(a, g), a.find("td").css(b).html(e))
    }
};
primitives.common.Graphics.prototype._getTextAlign = function (a) {
    var b = null;
    switch (a) {
        case 0:
            b = "center";
            break;
        case 1:
            b = "left";
            break;
        case 2:
            b = "right"
    }
    return b
};
primitives.common.Graphics.prototype._getVerticalAlignment = function (a) {
    var b = null;
    switch (a) {
        case 1:
            b = "middle";
            break;
        case 0:
            b = "top";
            break;
        case 2:
            b = "bottom"
    }
    return b
};
primitives.common.Graphics.prototype.polyline = function (a, b) {
    var c = null, d = null, e, f;
    for (e = 0; e < a.length; e += 1)switch (f = a[e], f.segmentType) {
        case 1:
            c = Math.round(f.x) + 0.5;
            d = Math.round(f.y) + 0.5;
            break;
        case 0:
            this.rightAngleLine(c, d, Math.round(f.x) + 0.5, Math.round(f.y) + 0.5, b);
            break;
        case 4:
            this.dot(f.x, f.y, f.width, f.height, f.cornerRadius, b)
    }
};
primitives.common.Graphics.prototype.dot = function (a, b, c, d, e, f) {
    var g = this.m_activePlaceholder, h = this.m_cache.get(g.name, g.activeLayer.name, "dot"), j = void 0 !== f.lineWidth && void 0 !== f.borderColor, a = {
        position: "absolute",
        width: c - (j ? 1 : 0),
        top: Math.round(b),
        left: Math.round(a),
        padding: 0,
        margin: 0,
        "line-height": "0px",
        overflow: "hidden",
        height: d - (j ? 1 : 0),
        background: f.fillColor,
        "-moz-border-radius": e,
        "-webkit-border-radius": e,
        "-khtml-border-radius": e,
        "border-radius": e,
        "font-size": "0px",
        "border-style": j ? "Solid" :
            "None",
        "border-width": j ? "1px" : "0px",
        "border-color": j ? f.borderColor : ""
    };
    null === h ? (h = jQuery("<div></div>"), primitives.common.css(h, a), g.activeLayer.canvas.append(h), this.m_cache.put(g.name, g.activeLayer.name, "dot", h)) : primitives.common.css(h, a)
};
primitives.common.Graphics.prototype.rightAngleLine = function (a, b, c, d, e) {
    var f = this.m_activePlaceholder, g = Math.abs(d - b) > Math.abs(c - a), h = e.lineWidth, e = {
        position: "absolute",
        top: Math.round(Math.min(b, d) - (g ? 0 : h / 2)),
        left: Math.round(Math.min(a, c) - (g ? h / 2 : 0)),
        padding: 0,
        margin: 0,
        opacity: 0.5,
        "line-height": "0px",
        overflow: "hidden",
        background: e.borderColor,
        "font-size": "0px"
    };
    g ? (e.width = h, e.height = Math.abs(Math.round(d - b))) : (e.width = Math.abs(Math.round(c - a)), e.height = h);
    a = this.m_cache.get(f.name, f.activeLayer.name,
        "rect");
    null === a ? (a = jQuery("<div></div>"), primitives.common.css(a, e), f.activeLayer.canvas.append(a), this.m_cache.put(f.name, f.activeLayer.name, "rect", a)) : primitives.common.css(a, e)
};
primitives.common.Graphics.prototype.template = function (a, b, c, d, e, f, g, h, j, i, k, l, m) {
    var c = this.m_activePlaceholder, d = "template" + (null !== i ? i : primitives.common.hashCode(j)), n = 0, i = this.m_cache.get(c.name, c.activeLayer.name, d);
    null !== m && void 0 !== m["border-width"] && (n = this.boxModel ? this.getPxSize(m["border-width"]) : 0);
    a = {width: g - n + "px", height: h - n + "px", top: b + f + "px", left: a + e + "px"};
    jQuery.extend(a, m);
    null == l && (l = new primitives.common.RenderEventArgs);
    null == i ? (i = jQuery(j), jQuery.extend(a, {
        position: "absolute",
        padding: "0px", margin: "0px"
    }, m), primitives.common.css(i, a), l.element = i, l.renderingMode = 0, null !== k && this.m_widget._trigger(k, null, l), c.activeLayer.canvas.append(i), this.m_cache.put(c.name, c.activeLayer.name, d, i)) : (l.element = i, l.renderingMode = 1, primitives.common.css(i, a), null !== k && this.m_widget._trigger(k, null, l));
    return i
};
primitives.common.Graphics.prototype.getPxSize = function (a, b) {
    var c = a;
    "string" === typeof a && (c = 0 < a.indexOf("pt") ? 96 * parseInt(a, 10) / 72 : 0 < a.indexOf("%") ? parseFloat(a) / 100 * b : parseInt(a, 10));
    return c
};
primitives.common.Graphics.prototype.polylineLength = function (a) {
    var b = 0, c, d, e, f = null;
    c = 0;
    for (d = a.length; c < d; c += 1) {
        e = a[c];
        switch (e.segmentType) {
            case 0:
                b += f.distanceTo(e.x, e.y)
        }
        f = e
    }
    return b
};
primitives.common.Cache = function () {
    this.threshold = 20;
    this.m_visible = {};
    this.m_invisible = {}
};
primitives.common.Cache.prototype.begin = function () {
    var a, b, c, d;
    for (a in this.m_visible)if (this.m_visible.hasOwnProperty(a))for (b in this.m_visible[a])if (this.m_visible[a].hasOwnProperty(b)) {
        for (c = this.m_visible[a][b].length - 1; 0 <= c; c -= 1)d = this.m_visible[a][b][c], d.css({visibility: "hidden"}), this.m_invisible[a][b].push(d);
        this.m_visible[a][b].length = 0
    }
};
primitives.common.Cache.prototype.end = function () {
    var a, b, c;
    for (a in this.m_visible)if (this.m_visible.hasOwnProperty(a))for (b in this.m_visible[a])if (this.m_visible[a].hasOwnProperty(b) && this.m_invisible[a][b].length > this.threshold)for (; void 0 !== (c = this.m_invisible[a][b].pop());)c.remove()
};
primitives.common.Cache.prototype.reset = function (a, b) {
    var a = a + "-" + b, c = null, d, e;
    for (d in this.m_visible[a])if (this.m_visible[a].hasOwnProperty(d)) {
        for (e = this.m_visible[a][d].length - 1; 0 <= e; e -= 1)c = this.m_visible[a][d][e], this.m_invisible[a][d].push(c), c.css({visibility: "hidden"});
        this.m_visible[a][d].length = 0
    }
};
primitives.common.Cache.prototype.clear = function () {
    var a, b, c;
    for (a in this.m_visible)if (this.m_visible.hasOwnProperty(a))for (b in this.m_visible[a])if (this.m_visible[a].hasOwnProperty(b)) {
        for (; void 0 !== (c = this.m_visible[a][b].pop());)c.remove();
        for (; void 0 !== (c = this.m_invisible[a][b].pop());)c.remove()
    }
};
primitives.common.Cache.prototype.get = function (a, b, c) {
    a = a + "-" + b;
    b = null;
    void 0 === this.m_visible[a] && (this.m_visible[a] = {}, this.m_invisible[a] = {});
    void 0 === this.m_visible[a][c] && (this.m_visible[a][c] = [], this.m_invisible[a][c] = []);
    b = this.m_invisible[a][c].pop() || null;
    null !== b && (this.m_visible[a][c].push(b), b.css({visibility: "inherit"}));
    return b
};
primitives.common.Cache.prototype.put = function (a, b, c, d) {
    this.m_visible[a + "-" + b][c].push(d)
};
primitives.common.CanvasGraphics = function (a) {
    this.parent = primitives.common.Graphics.prototype;
    this.parent.constructor.apply(this, arguments);
    this.graphicsType = 1;
    this.m_maximum = 6E3
};
primitives.common.CanvasGraphics.prototype = new primitives.common.Graphics;
primitives.common.CanvasGraphics.prototype.clean = function () {
    var a, b, c, d;
    for (a in this.m_placeholders)if (this.m_placeholders.hasOwnProperty(a))for (c in b = this.m_placeholders[a], b.layers)b.layers.hasOwnProperty(c) && (d = b.layers[c], null !== d.canvascanvas && (d.canvascanvas.remove(), d.canvascanvas = null));
    this.parent.clean.apply(this, arguments)
};
primitives.common.CanvasGraphics.prototype._activatePlaceholder = function (a) {
    var b, c, d;
    this.parent._activatePlaceholder.apply(this, arguments);
    b = this.m_activePlaceholder;
    c = b.size.width;
    d = b.size.height;
    b.hasGraphics = c > this.m_maximum || d > this.m_maximum ? !1 : !0
};
primitives.common.CanvasGraphics.prototype.resizePlaceholder = function (a, b, c) {
    var d, e;
    this.parent.resizePlaceholder.apply(this, arguments);
    for (d in a.layers)a.layers.hasOwnProperty(d) && (e = a.layers[d], null !== e.canvascanvas && (e.canvascanvas.css({
        position: "absolute",
        width: b + "px",
        height: c + "px"
    }), e.canvascanvas.attr({width: b + "px", height: c + "px"})))
};
primitives.common.CanvasGraphics.prototype.begin = function () {
    var a, b, c, d, e, f;
    this.parent.begin.apply(this);
    for (a in this.m_placeholders)if (this.m_placeholders.hasOwnProperty(a))for (c in b = this.m_placeholders[a], e = b.size.width, f = b.size.height, b.layers)b.layers.hasOwnProperty(c) && (d = b.layers[c], null !== d.canvascanvas && d.canvascontext.clearRect(0, 0, e, f))
};
primitives.common.Graphics.prototype._getContext = function (a, b) {
    var c = a.size.width, d = a.size.height;
    null === b.canvascanvas && (b.canvascanvas = jQuery("<canvas></canvas>"), b.canvascanvas.attr({
        width: c + "px",
        height: d + "px"
    }), a.activeLayer.canvas.prepend(b.canvascanvas), b.canvascontext = b.canvascanvas[0].getContext("2d"));
    return b.canvascontext
};
primitives.common.CanvasGraphics.prototype.reset = function (a, b) {
    var c = "none", d = -1, e, f;
    switch (arguments.length) {
        case 1:
            "string" === typeof a ? c = a : d = a;
            break;
        case 2:
            c = a, d = b
    }
    this.parent.reset.apply(this, arguments);
    e = this.m_placeholders[c];
    void 0 !== e && (c = e.size.width, f = e.size.height, d = e.layers[d], void 0 !== d && null !== d.canvascanvas && d.canvascontext.clearRect(0, 0, c, f))
};
primitives.common.CanvasGraphics.prototype.polyline = function (a, b) {
    var c = this.m_activePlaceholder, d, e, f;
    if (c.hasGraphics) {
        d = c.activeLayer;
        c = this._getContext(c, d);
        c.save();
        void 0 !== b.lineWidth && void 0 !== b.borderColor ? (c.strokeStyle = b.borderColor, c.lineWidth = b.lineWidth) : (c.lineWidth = 0, c.strokeStyle = "Transparent");
        if (null != b.lineType) {
            d = Math.round(b.lineWidth) || 1;
            switch (b.lineType) {
                case 0:
                    e = [];
                    break;
                case 1:
                    e = [d, d];
                    break;
                case 2:
                    e = [5 * d, 3 * d]
            }
            void 0 !== c.setLineDash ? c.setLineDash(e) : void 0 !== c.webkitLineDash ?
                c.webkitLineDash = e : void 0 !== c.mozDash && (c.mozDash = e)
        }
        c.beginPath();
        for (e = 0; e < a.length; e += 1)switch (d = a[e], d.segmentType) {
            case 1:
                c.moveTo(Math.round(d.x) + 0.5, Math.round(d.y) + 0.5);
                break;
            case 0:
                c.lineTo(Math.round(d.x) + 0.5, Math.round(d.y) + 0.5);
                break;
            case 4:
                d.width == d.height && d.width / 2 <= d.cornerRadius ? (c.moveTo(Math.round(d.x) + d.width + 0.5, Math.round(d.y) + d.height / 2 + 0.5), c.arc(Math.round(d.x) + d.width / 2 + 0.5, Math.round(d.y) + d.height / 2 + 0.5, Math.round(d.width / 2), 0, 2 * Math.PI, !1)) : 0 == d.cornerRadius ? (c.moveTo(Math.round(d.x) +
                0.5, Math.round(d.y) + 0.5), c.lineTo(Math.round(d.x + d.width) + 0.5, Math.round(d.y) + 0.5), c.lineTo(Math.round(d.x + d.width) + 0.5, Math.round(d.y + d.height) + 0.5), c.lineTo(Math.round(d.x) + 0.5, Math.round(d.y + d.height) + 0.5), c.lineTo(Math.round(d.x) + 0.5, Math.round(d.y) + 0.5)) : (f = Math.min(d.cornerRadius, Math.min(d.width / 2, d.height / 2)), c.moveTo(Math.round(d.x) + 0.5, Math.round(d.y + f) + 0.5), c.arc(Math.round(d.x + f) + 0.5, Math.round(d.y + f) + 0.5, Math.round(f), Math.PI, -Math.PI / 2, !1), c.lineTo(Math.round(d.x + d.width - f) + 0.5, Math.round(d.y) +
                0.5), c.arc(Math.round(d.x + d.width - f) + 0.5, Math.round(d.y + f) + 0.5, Math.round(f), -Math.PI / 2, 0, !1), c.lineTo(Math.round(d.x + d.width) + 0.5, Math.round(d.y + d.height - f) + 0.5), c.arc(Math.round(d.x + d.width - f) + 0.5, Math.round(d.y + d.height - f) + 0.5, Math.round(f), 0, Math.PI / 2, !1), c.lineTo(Math.round(d.x + f) + 0.5, Math.round(d.y + d.height) + 0.5), c.arc(Math.round(d.x + f) + 0.5, Math.round(d.y + d.height - f) + 0.5, Math.round(f), Math.PI / 2, Math.PI, !1), c.lineTo(Math.round(d.x) + 0.5, Math.round(d.y + f) + 0.5));
                break;
            case 2:
                c.quadraticCurveTo(Math.round(d.cpX) +
                0.5, Math.round(d.cpY) + 0.5, Math.round(d.x) + 0.5, Math.round(d.y) + 0.5);
                break;
            case 3:
                c.bezierCurveTo(Math.round(d.cpX1) + 0.5, Math.round(d.cpY1) + 0.5, Math.round(d.cpX2) + 0.5, Math.round(d.cpY2) + 0.5, Math.round(d.x) + 0.5, Math.round(d.y) + 0.5)
        }
        void 0 !== b.lineWidth && c.stroke();
        void 0 !== b.fillColor && (c.fillStyle = b.fillColor, c.globalAlpha = b.opacity, c.fill());
        c.restore()
    } else this.parent.polyline.apply(this, arguments)
};
primitives.common.Element = function (a, b) {
    this.name = this.ns = null;
    this.attr = {};
    this.style = {};
    this.children = [];
    switch (arguments.length) {
        case 1:
            this.name = a;
            break;
        case 2:
            this.ns = a, this.name = b
    }
};
primitives.common.Element.prototype.setAttribute = function (a, b) {
    this.attr[a] = b
};
primitives.common.Element.prototype.appendChild = function (a) {
    this.children[this.children.length] = a
};
primitives.common.Element.prototype.create = function (a) {
    var b = null, c, d, b = null !== this.ns ? document.createElementNS(this.ns, this.name) : document.createElement(this.name);
    for (c in this.attr)this.attr.hasOwnProperty(c) && (void 0 !== a ? b[c] = this.attr[c] : b.setAttribute(c, this.attr[c]));
    for (c in this.style)this.style.hasOwnProperty(c) && (b.style[c] = this.style[c]);
    for (d = 0; d < this.children.length; d += 1)c = this.children[d], "string" === typeof c ? b.appendChild(document.createTextNode(c)) : b.appendChild(c.create(a));
    return b
};
primitives.common.Element.prototype.update = function (a, b) {
    var c, d, e;
    for (c in this.style)this.style.hasOwnProperty(c) && (d = this.style[c], a.style[c] !== d && (a.style[c] = d));
    for (c in this.attr)this.attr.hasOwnProperty(c) && (d = this.attr[c], void 0 !== b ? a[c] !== d && (a[c] = d) : a.getAttribute(c) !== d && a.setAttribute(c, d));
    c = this.children.length;
    for (d = 0; d < c; d += 1)e = this.children[d], "string" === typeof e ? a.innerHtml !== e && (a.innerHtml = e) : this.children[d].update(a.children[d], b)
};
primitives.common.Layer = function (a) {
    this.name = a;
    this.svgcanvas = this.canvascanvas = this.canvas = null
};
primitives.common.Placeholder = function (a) {
    this.name = a;
    this.layers = {};
    this.div = this.rect = this.size = this.activeLayer = null;
    this.hasGraphics = !0
};
primitives.common.SvgGraphics = function (a) {
    this.parent = primitives.common.Graphics.prototype;
    this.parent.constructor.apply(this, arguments);
    this._svgxmlns = "http://www.w3.org/2000/svg";
    this.graphicsType = 0;
    this.hasGraphics = !0
};
primitives.common.SvgGraphics.prototype = new primitives.common.Graphics;
primitives.common.SvgGraphics.prototype.clean = function () {
    var a, b, c, d;
    for (a in this.m_placeholders)if (this.m_placeholders.hasOwnProperty(a))for (c in b = this.m_placeholders[a], b.layers)b.layers.hasOwnProperty(c) && (d = b.layers[c], null !== d.svgcanvas && (d.svgcanvas.remove(), d.svgcanvas = null));
    this.parent.clean.apply(this, arguments)
};
primitives.common.SvgGraphics.prototype.resizePlaceholder = function (a, b, c) {
    var d, e, f;
    this.parent.resizePlaceholder.apply(this, arguments);
    for (d in a.layers)a.layers.hasOwnProperty(d) && (e = a.layers[d], null !== e.svgcanvas && (f = {
        position: "absolute",
        width: b + "px",
        height: c + "px"
    }, e.svgcanvas.css(f), e.svgcanvas.attr({viewBox: "0 0 " + b + " " + c})))
};
primitives.common.SvgGraphics.prototype._getCanvas = function () {
    var a = this.m_activePlaceholder, b = a.activeLayer, c = a.rect;
    null === b.svgcanvas && (b.svgcanvas = jQuery('<svg version = "1.1"></svg>'), b.svgcanvas.attr({viewBox: c.x + " " + c.y + " " + c.width + " " + c.height}), b.svgcanvas.css({
        width: c.width + "px",
        height: c.height + "px"
    }), a.activeLayer.canvas.prepend(b.svgcanvas));
    return b.svgcanvas
};
primitives.common.SvgGraphics.prototype.polyline = function (a, b) {
    var c = this.m_activePlaceholder, d, e, f, g, h;
    d = new primitives.common.Element(this._svgxmlns, "path");
    void 0 !== b.fillColor ? (d.setAttribute("fill", b.fillColor), d.setAttribute("fill-opacity", b.opacity)) : d.setAttribute("fill-opacity", 0);
    void 0 !== b.lineWidth && void 0 !== b.borderColor ? (d.setAttribute("stroke", b.borderColor), d.setAttribute("stroke-width", b.lineWidth)) : (d.setAttribute("stroke", "transparent"), d.setAttribute("stroke-width", 0));
    if (null !=
        b.lineType)switch (e = Math.round(b.lineWidth) || 1, b.lineType) {
        case 0:
            d.setAttribute("stroke-dasharray", "");
            break;
        case 1:
            d.setAttribute("stroke-dasharray", e + "," + e);
            break;
        case 2:
            d.setAttribute("stroke-dasharray", 5 * e + "," + 3 * e)
    }
    e = "";
    for (f = 0; f < a.length; f += 1)switch (g = a[f], g.segmentType) {
        case 1:
            e += "M" + (Math.round(g.x) + 0.5) + " " + (Math.round(g.y) + 0.5);
            break;
        case 0:
            e += "L" + (Math.round(g.x) + 0.5) + " " + (Math.round(g.y) + 0.5);
            break;
        case 2:
            e += "Q" + (Math.round(g.cpX) + 0.5) + " " + (Math.round(g.cpY) + 0.5) + " " + (Math.round(g.x) +
            0.5) + " " + (Math.round(g.y) + 0.5);
            break;
        case 4:
            g.width == g.height && g.width / 2 <= g.cornerRadius ? (h = g.width / 2, e += "M" + (Math.round(g.x) + 0.5) + " " + (Math.round(g.y) + g.height / 2 + 0.5), e += "A" + h + " " + h + " 0 0 0 " + (Math.round(g.x + g.width) + 0.5) + " " + (Math.round(g.y) + g.height / 2 + 0.5), e += "A" + h + " " + h + " 0 0 0 " + (Math.round(g.x) + 0.5) + " " + (Math.round(g.y) + g.height / 2 + 0.5)) : 0 == g.cornerRadius ? (e += "M" + (Math.round(g.x) + 0.5) + " " + (Math.round(g.y) + 0.5), e += "L" + (Math.round(g.x + g.width) + 0.5) + " " + (Math.round(g.y) + 0.5), e += "L" + (Math.round(g.x +
            g.width) + 0.5) + " " + (Math.round(g.y + g.height) + 0.5), e += "L" + (Math.round(g.x) + 0.5) + " " + (Math.round(g.y + g.height) + 0.5), e += "L" + (Math.round(g.x) + 0.5) + " " + (Math.round(g.y) + 0.5)) : (h = Math.min(g.cornerRadius, Math.min(g.width / 2, g.height / 2)), e += "M" + (Math.round(g.x) + 0.5) + " " + (Math.round(g.y + h) + 0.5), e += "A" + Math.round(h) + " " + Math.round(h) + " 0 0 1 " + (Math.round(g.x + h) + 0.5) + " " + (Math.round(g.y) + 0.5), e += "L" + (Math.round(g.x + g.width - h) + 0.5) + " " + (Math.round(g.y) + 0.5), e += "A" + Math.round(h) + " " + Math.round(h) + " 0 0 1 " + (Math.round(g.x +
            g.width) + 0.5) + " " + (Math.round(g.y + h) + 0.5), e += "L" + (Math.round(g.x + g.width) + 0.5) + " " + (Math.round(g.y + g.height - h) + 0.5), e += "A" + Math.round(h) + " " + Math.round(h) + " 0 0 1 " + (Math.round(g.x + g.width - h) + 0.5) + " " + (Math.round(g.y + g.height) + 0.5), e += "L" + (Math.round(g.x + h) + 0.5) + " " + (Math.round(g.y + g.height) + 0.5), e += "A" + Math.round(h) + " " + Math.round(h) + " 0 0 1 " + (Math.round(g.x) + 0.5) + " " + (Math.round(g.y + g.height - h) + 0.5), e += "L" + (Math.round(g.x) + 0.5) + " " + (Math.round(g.y + h) + 0.5));
            break;
        case 3:
            e += "C" + (Math.round(g.cpX1) +
            0.5) + " " + (Math.round(g.cpY1) + 0.5) + " " + (Math.round(g.cpX2) + 0.5) + " " + (Math.round(g.cpY2) + 0.5) + " " + (Math.round(g.x) + 0.5) + " " + (Math.round(g.y) + 0.5)
    }
    d.setAttribute("d", e);
    e = this.m_cache.get(c.name, c.activeLayer.name, "path");
    null === e ? (e = jQuery(d.create()), d = this._getCanvas(), d.append(e), this.m_cache.put(c.name, c.activeLayer.name, "path", e)) : d.update(e[0])
};
primitives.common.Transform = function () {
    this.invertVertically = this.invertHorizontally = this.invertArea = !1;
    this.size = null
};
primitives.common.Transform.prototype.setOrientation = function (a) {
    switch (a) {
        case 0:
            this.invertVertically = this.invertHorizontally = this.invertArea = !1;
            break;
        case 1:
            this.invertHorizontally = this.invertArea = !1;
            this.invertVertically = !0;
            break;
        case 2:
            this.invertArea = !0;
            this.invertVertically = this.invertHorizontally = !1;
            break;
        case 3:
            this.invertHorizontally = this.invertArea = !0, this.invertVertically = !1
    }
};
primitives.common.Transform.prototype.getOrientation = function (a) {
    var b = a;
    if (this.invertHorizontally)switch (a) {
        case 2:
            b = 3;
            break;
        case 3:
            b = 2
    }
    if (this.invertVertically)switch (a) {
        case 0:
            b = 1;
            break;
        case 1:
            b = 0
    }
    if (this.invertArea)switch (b) {
        case 0:
            b = 2;
            break;
        case 1:
            b = 3;
            break;
        case 2:
            b = 0;
            break;
        case 3:
            b = 1
    }
    return b
};
primitives.common.Transform.prototype.transformPoint = function (a, b, c, d, e) {
    var f;
    c && this.invertArea && (f = a, a = b, b = f);
    this.invertHorizontally && (a = this.size.width - a);
    this.invertVertically && (b = this.size.height - b);
    !c && this.invertArea && (f = a, a = b, b = f);
    e.call(d, a, b)
};
primitives.common.Transform.prototype.transformPoints = function (a, b, c, d, e, f, g) {
    var h;
    e && this.invertArea && (h = a, a = b, b = h, h = c, c = d, d = h);
    this.invertHorizontally && (a = this.size.width - a, c = this.size.width - c);
    this.invertVertically && (b = this.size.height - b, d = this.size.height - d);
    !e && this.invertArea && (h = a, a = b, b = h, h = c, c = d, d = h);
    g.call(f, a, b, c, d)
};
primitives.common.Transform.prototype.transform3Points = function (a, b, c, d, e, f, g, h, j) {
    var i;
    g && this.invertArea && (i = a, a = b, b = i, i = c, c = d, d = i, i = e, e = f, f = i);
    this.invertHorizontally && (a = this.size.width - a, c = this.size.width - c, e = this.size.width - e);
    this.invertVertically && (b = this.size.height - b, d = this.size.height - d, f = this.size.height - f);
    !g && this.invertArea && (i = a, a = b, b = i, i = c, c = d, d = i, i = e, e = f, f = i);
    j.call(h, a, b, c, d, e, f)
};
primitives.common.Transform.prototype.transformRect = function (a, b, c, d, e, f, g) {
    var h;
    e && this.invertArea && (h = a, a = b, b = h, h = c, c = d, d = h);
    this.invertHorizontally && (a = this.size.width - a - c);
    this.invertVertically && (b = this.size.height - b - d);
    !e && this.invertArea && (h = a, a = b, b = h, h = c, c = d, d = h);
    g.call(f, a, b, c, d)
};
primitives.common.Transform.prototype.transformSegments = function (a, b) {
    var c, d, e;
    c = 0;
    for (d = a.length; c < d; c += 1)switch (e = a[c], e.segmentType) {
        case 2:
            this.transformPoints(e.x, e.y, e.cpX, e.cpY, b, this, function (a, b, c, d) {
                e.x = a;
                e.y = b;
                e.cpX = c;
                e.cpY = d
            });
            break;
        case 3:
            this.transform3Points(e.x, e.y, e.cpX1, e.cpY1, e.cpX2, e.cpY2, b, this, function (a, b, c, d, i, k) {
                e.x = a;
                e.y = b;
                e.cpX1 = c;
                e.cpY1 = d;
                e.cpX2 = i;
                e.cpY2 = k
            });
            break;
        case 0:
        case 1:
            this.transformPoint(e.x, e.y, b, this, function (a, b) {
                e.x = a;
                e.y = b
            })
    }
};
primitives.common.VmlGraphics = function (a) {
    var b, c, d;
    this.parent = primitives.common.Graphics.prototype;
    this.parent.constructor.apply(this, arguments);
    this.prefix = "rvml";
    this.ie8mode = document.documentMode && 8 <= document.documentMode;
    try {
        eval("document.namespaces")
    } catch (e) {
    }
    document.namespaces[this.prefix] || document.namespaces.add(this.prefix, "urn:schemas-microsoft-com:vml");
    if (!primitives.common.VmlGraphics.prototype.vmlStyle) {
        b = primitives.common.VmlGraphics.prototype.vmlStyle = document.createStyleSheet();
        c = " *;fill;shape;path;textpath;stroke".split(";");
        for (d = 0; d < c.length; d += 1)b.addRule(this.prefix + "\\:" + c[d], "behavior:url(#default#VML); position:absolute;")
    }
    this.graphicsType = 2;
    this.hasGraphics = !0
};
primitives.common.VmlGraphics.prototype = new primitives.common.Graphics;
primitives.common.VmlGraphics.prototype.text = function (a, b, c, d, e, f, g, h, j) {
    var i, k, l;
    switch (f) {
        case 0:
        case 3:
            this.parent.text.call(this, a, b, c, d, e, f, g, h, j);
            break;
        default:
            i = this.m_activePlaceholder;
            f = 1 === f;
            a = new primitives.common.Rect(a, b, c, d);
            d = new primitives.common.Rect(0, 0, 10 * c, 10 * d);
            c = new primitives.common.Element(this.prefix + ":shape");
            c.setAttribute("CoordSize", d.width + "," + d.height);
            c.setAttribute("filled", !0);
            c.setAttribute("stroked", !1);
            c.setAttribute("fillcolor", j["font-color"]);
            c.style.top = a.y +
            "px";
            c.style.left = a.x + "px";
            c.style.width = a.width + "px";
            c.style.height = a.height + "px";
            c.style["font-family"] = j["font-family"];
            a = new primitives.common.Element(this.prefix + ":path");
            a.setAttribute("TextPathOk", !0);
            b = 16 * Math.floor(this.getPxSize(j["font-size"])) * Math.max(e.split("\n").length - 1, 1);
            l = k = null;
            if (f)switch (h) {
                case 0:
                    k = new primitives.common.Point(d.x + b / 2, d.bottom());
                    l = new primitives.common.Point(d.x + b / 2, d.y);
                    break;
                case 1:
                    k = new primitives.common.Point(d.horizontalCenter(), d.bottom());
                    l = new primitives.common.Point(d.horizontalCenter(),
                        d.y);
                    break;
                case 2:
                    k = new primitives.common.Point(d.right() - b / 2, d.bottom()), l = new primitives.common.Point(d.right() - b / 2, d.y)
            } else switch (h) {
                case 0:
                    k = new primitives.common.Point(d.right() - b / 2, d.y);
                    l = new primitives.common.Point(d.right() - b / 2, d.bottom());
                    break;
                case 1:
                    k = new primitives.common.Point(d.horizontalCenter(), d.y);
                    l = new primitives.common.Point(d.horizontalCenter(), d.bottom());
                    break;
                case 2:
                    k = new primitives.common.Point(d.x + b / 2, d.y), l = new primitives.common.Point(d.x + b / 2, d.bottom())
            }
            a.setAttribute("v",
                " m" + k.x + "," + k.y + " l" + l.x + "," + l.y + " e");
            h = new primitives.common.Element(this.prefix + ":textpath");
            h.setAttribute("on", !0);
            h.setAttribute("string", e);
            h.style.trim = !1;
            h.style["v-text-align"] = this._getTextAlign(g);
            h.style.font = "normal normal normal " + j["font-size"] + "pt " + j["font-family"];
            c.appendChild(a);
            c.appendChild(h);
            e = this.m_cache.get(i.name, i.activeLayer.name, "vmltext");
            null === e ? (e = jQuery(c.create(this.ie8mode)), i.activeLayer.canvas.append(e), this.m_cache.put(i.name, i.activeLayer.name, "vmltext",
                e)) : c.update(e[0], this.ie8mode)
    }
};
primitives.common.VmlGraphics.prototype.polyline = function (a, b) {
    var c = this.m_activePlaceholder, d = new primitives.common.Rect(c.rect), e = new primitives.common.Rect(0, 0, 10 * d.width, 10 * d.height), f = new primitives.common.Element(this.prefix + ":shape"), g, h, j, i, k;
    void 0 !== b.borderColor && void 0 !== b.lineWidth ? (f.setAttribute("strokecolor", b.borderColor), f.setAttribute("strokeweight", b.lineWidth), f.setAttribute("stroked", !0)) : f.setAttribute("stroked", !1);
    f.setAttribute("CoordSize", e.width + "," + e.height);
    f.style.top =
        d.y + "px";
    f.style.left = d.x + "px";
    f.style.width = d.width + "px";
    f.style.height = d.height + "px";
    d = "";
    for (e = 0; e < a.length; e += 1)switch (g = a[e], g.segmentType) {
        case 1:
            d += " m" + 10 * Math.round(g.x) + "," + 10 * Math.round(g.y);
            break;
        case 0:
            d += " l" + 10 * Math.round(g.x) + "," + 10 * Math.round(g.y);
            break;
        case 4:
            h = Math.round(g.x);
            j = Math.round(g.y);
            i = Math.round(g.x + g.width);
            g = Math.round(g.y + g.height);
            h > i && (k = h, h = i, i = k);
            j > g && (k = j, j = g, g = k);
            h = 10 * h + 5;
            j = 10 * j + 5;
            i = 10 * i - 5;
            g = 10 * g - 5;
            d += " m" + h + "," + j;
            d += " l" + i + "," + j;
            d += " l" + i + "," + g;
            d += " l" + h + "," +
            g;
            d += " l" + h + "," + j;
            break;
        case 2:
            d += " qb" + 10 * Math.round(g.cpX) + "," + 10 * Math.round(g.cpY) + " l" + 10 * Math.round(g.x) + "," + 10 * Math.round(g.y);
            break;
        case 3:
            d += " c" + 10 * Math.round(g.cpX1) + "," + 10 * Math.round(g.cpY1) + "," + 10 * Math.round(g.cpX2) + "," + 10 * Math.round(g.cpY2) + "," + 10 * Math.round(g.x) + "," + 10 * Math.round(g.y)
    }
    d += " e";
    e = "shapepath";
    h = new primitives.common.Element(this.prefix + ":path");
    h.setAttribute("v", d);
    f.appendChild(h);
    if (null != b.lineType) {
        d = new primitives.common.Element(this.prefix + ":stroke");
        switch (b.lineType) {
            case 0:
                d.setAttribute("dashstyle",
                    "Solid");
                break;
            case 1:
                d.setAttribute("dashstyle", "ShortDot");
                break;
            case 2:
                d.setAttribute("dashstyle", "Dash")
        }
        f.appendChild(d);
        e += "stroke"
    }
    null !== b.fillColor ? (f.setAttribute("filled", !0), d = new primitives.common.Element(this.prefix + ":fill"), d.setAttribute("opacity", b.opacity), d.setAttribute("color", b.fillColor), f.appendChild(d), e += "fill") : f.setAttribute("filled", !1);
    d = this.m_cache.get(c.name, c.activeLayer.name, e);
    null === d ? (d = jQuery(f.create(this.ie8mode)), c.activeLayer.canvas.append(d), this.m_cache.put(c.name,
        c.activeLayer.name, e, d)) : f.update(d[0], this.ie8mode)
};
primitives.text.Config = function () {
    this.classPrefix = "bptext";
    this.graphicsType = 0;
    this.actualGraphicsType = null;
    this.orientation = 0;
    this.text = "";
    this.verticalAlignment = 1;
    this.horizontalAlignment = 0;
    this.fontSize = "16px";
    this.fontFamily = "Arial";
    this.color = "#000000";
    this.fontStyle = this.fontWeight = "normal"
};
primitives.text.Controller = function () {
    this.widgetEventPrefix = "bptext";
    this.options = new primitives.text.Config;
    this.m_graphics = this.m_panelSize = this.m_placeholder = null
};
primitives.text.Controller.prototype._create = function () {
    this.element.addClass("ui-widget");
    this._createLayout();
    this._redraw()
};
primitives.text.Controller.prototype.destroy = function () {
    this._cleanLayout()
};
primitives.text.Controller.prototype._createLayout = function () {
    this.m_panelSize = new primitives.common.Rect(0, 0, this.element.outerWidth(), this.element.outerHeight());
    this.m_placeholder = jQuery("<div></div>");
    this.m_placeholder.css({
        position: "relative",
        overflow: "hidden",
        top: "0px",
        left: "0px",
        padding: "0px",
        margin: "0px"
    });
    this.m_placeholder.css(this.m_panelSize.getCSS());
    this.m_placeholder.addClass("placeholder");
    this.m_placeholder.addClass(this.widgetEventPrefix);
    this.element.append(this.m_placeholder);
    this.m_graphics = primitives.common.createGraphics(this.options.graphicsType, this);
    this.options.actualGraphicsType = this.m_graphics.graphicsType
};
primitives.text.Controller.prototype._cleanLayout = function () {
    null !== this.m_graphics && this.m_graphics.clean();
    this.m_graphics = null;
    this.element.find("." + this.widgetEventPrefix).remove()
};
primitives.text.Controller.prototype._updateLayout = function () {
    this.m_panelSize = new primitives.common.Rect(0, 0, this.element.innerWidth(), this.element.innerHeight());
    this.m_placeholder.css(this.m_panelSize.getCSS())
};
primitives.text.Controller.prototype.update = function (a) {
    a ? (this._cleanLayout(), this._createLayout(), this._redraw()) : (this._updateLayout(), this.m_graphics.resize("placeholder", this.m_panelSize.width, this.m_panelSize.height), this.m_graphics.begin(), this._redraw(), this.m_graphics.end())
};
primitives.text.Controller.prototype._redraw = function () {
    var a = this.m_graphics.activate("placeholder");
    this.m_graphics.text(a.rect.x, a.rect.y, a.rect.width, a.rect.height, this.options.text, this.options.orientation, this.options.horizontalAlignment, this.options.verticalAlignment, {
        "font-size": this.options.fontSize,
        "font-family": this.options.fontFamily,
        "font-style": this.options.fontStyle,
        "font-weight": this.options.fontWeight,
        "font-color": this.options.color
    })
};
primitives.text.Controller.prototype._setOption = function (a, b) {
    jQuery.Widget.prototype._setOption.apply(this, arguments);
    switch (a) {
        case "disabled":
            var c = jQuery([]);
            b ? (c.filter(".ui-state-focus").blur(), c.removeClass("ui-state-hover"), c.propAttr("disabled", !0), this.element.addClass("ui-disabled")) : (c.propAttr("disabled", !1), this.element.removeClass("ui-disabled"))
    }
};
(function (a) {
    a.widget("ui.bpText", new primitives.text.Controller)
})(jQuery);
primitives.orgdiagram.BaseController = function () {
    this.transform = this.graphics = null;
    this._treeItemConfigs = {};
    this._orgItems = {};
    this._orgItemChildren = {};
    this._orgItemRoot = null;
    this._orgPartners = {};
    this._treeItems = {};
    this._treeItemCounter = 0;
    this._treeItemsByUserId = {};
    this._treeLevels = [];
    this._leftMargins = {};
    this._rightMargins = {};
    this._templates = {};
    this.m_scrollPanel = this._highlightTreeItem = this._cursorTreeItem = this._printPreviewTemplateHashCode = this._printPreviewTemplate = this._annotationLabelTemplateHashCode =
        this._annotationLabelTemplate = this._groupTitleTemplateHashCode = this._groupTitleTemplate = this._buttonsTemplateHashCode = this._buttonsTemplate = this._checkBoxTemplateHashCode = this._checkBoxTemplate = this._defaultTemplate = null;
    this.m_scrollPanelRect = new primitives.common.Rect(0, 0, 0, 0);
    this.m_placeholder = null;
    this.m_placeholderRect = new primitives.common.Rect(0, 0, 0, 0);
    this.m_calloutShape = this.m_calloutPlaceholder = null;
    this.boxModel = jQuery.support.boxModel;
    this._cancelMouseClick = !1;
    this._itemsInterval = [];
    this._scale = null;
    this.scale = 1;
    this._debug = this.showElbowDots = this.showInvisibleSubTrees = !1
};
primitives.orgdiagram.BaseController.prototype._create = function () {
    this.element.addClass("ui-widget");
    this._createLayout();
    this._virtualBind();
    this.transform = this.graphics = null;
    this._redraw()
};
primitives.orgdiagram.BaseController.prototype.destroy = function () {
    this._virtualUnbind();
    this._clean();
    this._cleanLayout()
};
primitives.orgdiagram.BaseController.prototype._clean = function () {
    null !== this.graphics && this.graphics.clean();
    this.transform = this.graphics = null
};
primitives.orgdiagram.BaseController.prototype._cleanLayout = function () {
    this.options.enablePanning && this._mouseDestroy();
    this.element.find("." + this.widgetEventPrefix).remove()
};
primitives.orgdiagram.BaseController.prototype._createLayout = function () {
    this.m_scrollPanelRect = new primitives.common.Rect(0, 0, this.element.outerWidth(), this.element.outerHeight());
    this.m_placeholderRect = new primitives.common.Rect(this.m_scrollPanelRect);
    var a = this.element.offset();
    this.m_scrollPanel = jQuery('<div tabindex="0"></div>');
    this.m_scrollPanel.css({
        position: "relative",
        overflow: "auto",
        top: "0px",
        left: "0px",
        width: this.m_scrollPanelRect.width + "px",
        height: this.m_scrollPanelRect.height + "px",
        padding: "0px",
        "margin-bottom": "0px",
        "margin-right": "0px",
        "margin-top": -a.top + Math.floor(a.top) + "px",
        "margin-left": -a.left + Math.floor(a.left) + "px",
        "-webkit-overflow-scrolling": "touch"
    });
    this.m_scrollPanel.addClass(this.widgetEventPrefix);
    this.m_placeholder = jQuery("<div></div>");
    this.m_placeholder.css({position: "absolute", overflow: "hidden", top: "0px", left: "0px"});
    this.m_placeholder.addClass("placeholder");
    this.m_placeholder.addClass(this.widgetEventPrefix);
    this.m_placeholder.css(this.m_placeholderRect.getCSS());
    this.m_scrollPanel.append(this.m_placeholder);
    this.m_calloutPlaceholder = jQuery("<div></div>");
    this.m_calloutPlaceholder.css({position: "absolute", overflow: "visible"});
    this.m_calloutPlaceholder.addClass("calloutplaceholder");
    this.m_calloutPlaceholder.addClass(this.widgetEventPrefix);
    this.m_calloutPlaceholder.css({top: "0px", left: "0px", width: "0px", height: "0px"});
    this.m_placeholder.append(this.m_calloutPlaceholder);
    this.element.append(this.m_scrollPanel);
    this.options.enablePanning && this._mouseInit(this.m_placeholder)
};
primitives.orgdiagram.BaseController.prototype._updateLayout = function () {
    var a = this.element.offset();
    this.m_scrollPanelRect = new primitives.common.Rect(0, 0, this.element.outerWidth(), this.element.outerHeight());
    this.m_scrollPanel.css({
        top: "0px",
        left: "0px",
        width: this.m_scrollPanelRect.width + "px",
        height: this.m_scrollPanelRect.height + "px",
        "margin-bottom": "0px",
        "margin-right": "0px",
        "margin-top": -a.top + Math.floor(a.top) + "px",
        "margin-left": -a.left + Math.floor(a.left) + "px"
    })
};
primitives.orgdiagram.BaseController.prototype._virtualBind = function () {
    var a = this;
    this.m_placeholder.mousemove(function (b) {
        a._onMouseMove(b)
    }).click(function (b) {
        a._onMouseClick(b)
    });
    this.m_scrollPanel.keydown(function (b) {
        a._onKeyDown(b)
    });
    "ontouchstart"in document.documentElement && (this.m_scrollPanel[0].addEventListener("gesturestart", a.onGestureStartHandler = function (b) {
        a.onGestureStart(b)
    }, !1), this.m_scrollPanel[0].addEventListener("gesturechange", a.onGestureChangeHandler = function (b) {
            a.onGestureChange(b)
        },
        !1));
    this.options.onDefaultTemplateRender = function (b, c) {
        a._onDefaultTemplateRender(b, c)
    };
    this.options.onCheckBoxTemplateRender = function (b, c) {
        a._onCheckBoxTemplateRender(b, c)
    };
    this.options.onGroupTitleTemplateRender = function (b, c) {
        a._onGroupTitleTemplateRender(b, c)
    };
    this.options.onButtonsTemplateRender = function (b, c) {
        a._onButtonsTemplateRender(b, c)
    };
    this.options.onAnnotationLabelTemplateRender = function (b, c) {
        a._onAnnotationLabelTemplateRender(b, c)
    }
};
primitives.orgdiagram.BaseController.prototype._virtualUnbind = function () {
    this.m_placeholder.unbind("mousemove");
    this.m_placeholder.unbind("click");
    this.m_scrollPanel.unbind("keydown");
    "ontouchstart"in document.documentElement && (this.m_scrollPanel[0].removeEventListener("gesturestart", this.onGestureStartHandler, !1), this.m_scrollPanel[0].removeEventListener("gesturechange", this.onGestureChangeHandler, !1));
    this.options.onDefaultTemplateRender = null;
    this.options.onCheckBoxTemplateRender = null;
    this.options.onGroupTitleTemplateRender =
        null;
    this.options.onButtonsTemplateRender = null;
    this.options.onAnnotationLabelTemplateRender = null
};
primitives.orgdiagram.BaseController.prototype.update = function (a) {
    switch (a) {
        case 2:
            this._redrawHighlight();
            break;
        case 1:
            this._refresh();
            break;
        default:
            this._redraw()
    }
};
primitives.orgdiagram.BaseController.prototype._mouseCapture = function (a) {
    this._dragStartPosition = new primitives.common.Point(this.m_scrollPanel.scrollLeft() + a.pageX, this.m_scrollPanel.scrollTop() + a.pageY);
    return !0
};
primitives.orgdiagram.BaseController.prototype._mouseDrag = function (a) {
    var b = new primitives.common.Point(a.pageX, a.pageY), a = -b.x + this._dragStartPosition.x, b = -b.y + this._dragStartPosition.y;
    this.m_scrollPanel.css("visibility", "hidden");
    this.m_scrollPanel.scrollLeft(a).scrollTop(b);
    this.m_scrollPanel.css("visibility", "inherit");
    return !1
};
primitives.orgdiagram.BaseController.prototype._mouseStop = function () {
    this._cancelMouseClick = !0
};
primitives.orgdiagram.BaseController.prototype._virtualGetEventArgs = function () {
    return null
};
primitives.orgdiagram.BaseController.prototype._onMouseMove = function (a) {
    var b = this.m_placeholder.offset(), c = a.pageX - b.left, b = a.pageY - b.top;
    this._mouseStarted || (this._cancelMouseClick = !1, c = this._getTreeItemForMousePosition(c, b), this._setHighlightItem(a, c))
};
primitives.orgdiagram.BaseController.prototype._onMouseClick = function (a) {
    var b = this._highlightTreeItem, c, d;
    null !== b && !this._cancelMouseClick && (c = jQuery(a.target), c.hasClass(this.widgetEventPrefix + "button") || 0 < c.parent("." + this.widgetEventPrefix + "button").length ? (c = c.hasClass(this.widgetEventPrefix + "button") ? c : c.parent("." + this.widgetEventPrefix + "button"), d = c.data("buttonname"), c = this._virtualGetEventArgs(null, b, d), this._trigger("onButtonClick", a, c)) : "selectiontext" !== c.attr("name") && ("checkbox" ===
    c.attr("name") ? (c = this._virtualGetEventArgs(null, b, d), this._trigger("onSelectionChanging", a, c), d = primitives.common.indexOf(this.options.selectedItems, b.itemConfig.id), 0 <= d ? this.options.selectedItems.splice(d, 1) : this.options.selectedItems.push(b.itemConfig.id), this._trigger("onSelectionChanged", a, c)) : (c = this._virtualGetEventArgs(null, b), this._trigger("onMouseClick", a, c), c.cancel || (this._setCursorItem(a, b), this.m_scrollPanel.focus()))));
    this._cancelMouseClick = !1
};
primitives.orgdiagram.BaseController.prototype._setHighlightItem = function (a, b) {
    var c = !0, d;
    null !== b ? b.itemConfig.id !== this.options.highlightItem && (d = this._virtualGetEventArgs(this._highlightTreeItem, b), this._highlightTreeItem = b, this.options.highlightItem = b.itemConfig.id, this._trigger("onHighlightChanging", a, d), d.cancel ? c = !1 : (this._refreshHighlight(), this._trigger("onHighlightChanged", a, d))) : null !== this.options.highlightItem && (d = this._virtualGetEventArgs(this._highlightTreeItem, null), this._highlightTreeItem =
        null, this.options.highlightItem = null, this._trigger("onHighlightChanging", a, d), d.cancel ? c = !1 : (this._refreshHighlight(), this._trigger("onHighlightChanged", a, d)));
    return c
};
primitives.orgdiagram.BaseController.prototype._setCursorItem = function (a, b) {
    var c;
    b.itemConfig.id !== this.options.cursorItem && (c = this._virtualGetEventArgs(null != this.options.cursorItem ? this._treeItemsByUserId[this.options.cursorItem] : null, b), this.options.cursorItem = b.itemConfig.id, this._trigger("onCursorChanging", a, c), c.cancel || (this._refresh(), this._trigger("onCursorChanged", a, c)))
};
primitives.orgdiagram.BaseController.prototype._getNextLevelTreeItem = function (a, b) {
    var c = a.actualPosition.horizontalCenter(), d, e, f, g, h = null, j = null, i, k, l, m = b ? this._treeLevels.slice(a.level + 1, this._treeLevels.length) : this._treeLevels.slice(0, a.level).reverse();
    f = 0;
    for (g = m.length; f < g; f += 1) {
        k = m[f].treeItems;
        d = 0;
        for (e = k.length; d < e; d += 1)if (l = this._treeItems[k[d]], 1 == l.actualVisibility)if (i = Math.abs(c - l.actualPosition.horizontalCenter()), i < j || null == j)j = i, h = l; else break;
        if (null != j)break
    }
    return h
};
primitives.orgdiagram.BaseController.prototype._onKeyDown = function (a) {
    var b, c, d, e = null != this._highlightTreeItem ? this._highlightTreeItem : this._cursorTreeItem, f, g, h = null, j;
    if (null != e) {
        switch (a.which) {
            case 13:
                this._setCursorItem(a, e);
                a.preventDefault();
                this.m_scrollPanel.focus();
                break;
            case 40:
                h = 1;
                break;
            case 38:
                h = 0;
                break;
            case 37:
                h = 2;
                break;
            case 39:
                h = 3
        }
        if (null != h) {
            for (j = !1; !j;) {
                j = !0;
                h = this.transform.getOrientation(h);
                switch (h) {
                    case 0:
                        g = this._getNextLevelTreeItem(e, !1);
                        break;
                    case 1:
                        g = this._getNextLevelTreeItem(e,
                            !0);
                        break;
                    case 2:
                        b = this._treeLevels[e.level];
                        for (c = e.levelPosition - 1; 0 <= c; c -= 1)if (f = this._treeItems[b.treeItems[c]], 1 == f.actualVisibility) {
                            g = f;
                            break
                        }
                        break;
                    case 3:
                        b = this._treeLevels[e.level];
                        c = e.levelPosition + 1;
                        for (d = b.treeItems.length; c < d; c += 1)if (f = this._treeItems[b.treeItems[c]], 1 == f.actualVisibility) {
                            g = f;
                            break
                        }
                }
                null != g && (a.preventDefault(), this._centerOnCursor(g, !1), (j = this._setHighlightItem(a, g)) || (e = g))
            }
            this.m_scrollPanel.focus()
        }
    }
};
primitives.orgdiagram.BaseController.prototype.onGestureStart = function (a) {
    this._scale = this.scale;
    a.preventDefault()
};
primitives.orgdiagram.BaseController.prototype.onGestureChange = function (a) {
    var b = Math.round(10 * this._scale * a.scale) / 10;
    b > this.options.maximumScale ? b = this.options.maximumScale : b < this.options.minimumScale && (b = this.options.minimumScale);
    this.scale = b;
    this._refresh();
    a.preventDefault()
};
primitives.orgdiagram.BaseController.prototype._updateScale = function () {
    var a = "scale(" + this.scale + "," + this.scale + ")";
    this.m_placeholder.css({
        "transform-origin": "0 0",
        transform: a,
        "-ms-transform": a,
        "-webkit-transform": a,
        "-o-transform": a,
        "-moz-transform": a
    })
};
primitives.orgdiagram.BaseController.prototype._redraw = function () {
    this._clean();
    this.graphics = primitives.common.createGraphics(this.options.graphicsType, this);
    this.graphics.debug = this._debug;
    this.transform = new primitives.common.Transform;
    this.options.actualGraphicsType = this.graphics.graphicsType;
    this.m_calloutShape = new primitives.common.Callout(this.graphics);
    this._virtualReadTemplates();
    this._createCheckBoxTemplate();
    this._createButtonsTemplate();
    this._createGroupTitleTemplate();
    this._createAnnotationLabelTemplate();
    this._createPrintPreviewTemplate();
    this._refresh()
};
primitives.orgdiagram.BaseController.prototype._refresh = function () {
    this._updateLayout();
    this.m_scrollPanel.css({display: "none", "-webkit-overflow-scrolling": "auto"});
    this._updateScale();
    this._setItemsIntervals();
    this._virtualCreateOrgTree();
    this._createVisualTree();
    this._positionTreeItems();
    this.graphics.resize("placeholder", this.m_placeholderRect.width, this.m_placeholderRect.height);
    this.transform.size = new primitives.common.Size(this.m_placeholderRect.width, this.m_placeholderRect.height);
    this.graphics.begin();
    this._redrawTreeItems();
    this._tracePathAnnotations();
    this._redrawConnectors();
    this._drawPrintPreview();
    this._drawAnnotations();
    this._drawHighlight();
    this._hideHighlightAnnotation();
    this._drawCursor();
    this.graphics.end();
    this.m_scrollPanel.css({display: "block"});
    this._centerOnCursor(this._cursorTreeItem, !0);
    this.m_scrollPanel.css({"-webkit-overflow-scrolling": "touch"})
};
primitives.orgdiagram.BaseController.prototype._setItemsIntervals = function () {
    this._itemsInterval[1] = this.options.normalItemsInterval;
    this._itemsInterval[2] = this.options.dotItemsInterval;
    this._itemsInterval[3] = this.options.lineItemsInterval;
    this._itemsInterval[4] = this.options.lineItemsInterval
};
primitives.orgdiagram.BaseController.prototype._redrawHighlight = function () {
    null != this._treeItemsByUserId[this.options.highlightItem] && (this._highlightTreeItem = this._treeItemsByUserId[this.options.highlightItem]);
    this._refreshHighlight()
};
primitives.orgdiagram.BaseController.prototype._refreshHighlight = function () {
    this.graphics.reset("placeholder", 3);
    this.graphics.reset("calloutplaceholder", 9);
    this._drawHighlight();
    this._drawHighlightAnnotation()
};
primitives.orgdiagram.BaseController.prototype._drawHighlight = function () {
    var a, b, c, d;
    null !== this._highlightTreeItem && (this.graphics.activate("placeholder", 3), a = this._highlightTreeItem.actualPosition, b = new primitives.common.Rect(0, 0, Math.round(this._highlightTreeItem.actualSize.width), Math.round(this._highlightTreeItem.actualSize.height)), c = this._highlightTreeItem.template.highlightPadding, b.offset(c.left, c.top, c.right, c.bottom), d = new primitives.common.RenderEventArgs, d.context = this._highlightTreeItem.itemConfig,
        d.isCursor = this._highlightTreeItem.isCursor, d.isSelected = this._highlightTreeItem.isSelected, d.templateName = this._highlightTreeItem.template.name, this.transform.transformRect(a.x, a.y, a.width, a.height, !0, this, function (a, c, g, h) {
        1 == this._highlightTreeItem.actualVisibility ? this.graphics.template(a, c, g, h, b.x, b.y, b.width, b.height, this._highlightTreeItem.template.highlightTemplate, this._highlightTreeItem.template.highlightTemplateHashCode, this._highlightTreeItem.template.highlightTemplateRenderName, d, null) :
            this.graphics.template(a, c, g, h, b.x, b.y, b.width - 1, b.height - 1, this._highlightTreeItem.template.dotHighlightTemplate, this._highlightTreeItem.template.dotHighlightTemplateHashCode, null, d, null)
    }))
};
primitives.orgdiagram.BaseController.prototype._drawCursor = function () {
    var a = this._cursorTreeItem, b, c, d, e;
    null !== a && 1 == a.actualVisibility && (this.graphics.activate("placeholder", 6), b = a.actualPosition, c = new primitives.common.Rect(a.contentPosition), d = a.template.cursorPadding, c.offset(d.left, d.top, d.right, d.bottom), e = new primitives.common.RenderEventArgs, e.context = a.itemConfig, e.isCursor = a.isCursor, e.isSelected = a.isSelected, e.templateName = a.template.name, this.transform.transformRect(b.x, b.y, b.width, b.height,
        !0, this, function (b, d, h, j) {
            this.graphics.template(b, d, h, j, c.x, c.y, c.width, c.height, a.template.cursorTemplate, a.template.cursorTemplateHashCode, a.template.cursorTemplateRenderName, e, {"border-width": a.template.cursorBorderWidth})
        }))
};
primitives.orgdiagram.BaseController.prototype._redrawTreeItems = function () {
    var a, b, c, d, e, f, g = {}, h, j, i, k;
    this.transform.setOrientation(this.options.orientationType);
    j = 0;
    for (i = this._treeLevels.length; j < i; j += 1)c = this._treeLevels[j], c.labels = [], c.labelsRect = null, c.hasFixedLabels = !1, c.showLabels = !0;
    for (f in this._treeItems)this._treeItems.hasOwnProperty(f) && (a = this._treeItems[f], b = a.orgItem, c = this._treeLevels[a.level], a.setActualPosition(c, this.options), this.transform.transformRect(a.actualPosition.x,
        a.actualPosition.y, a.actualPosition.width, a.actualPosition.height, !0, this, function (f, i, j, p) {
            switch (a.actualVisibility) {
                case 1:
                    d = new primitives.common.RenderEventArgs;
                    d.context = a.itemConfig;
                    d.isCursor = a.isCursor;
                    d.isSelected = a.isSelected;
                    d.templateName = a.template.name;
                    this.graphics.activate("placeholder", 7);
                    this.graphics.template(f, i, j, p, a.contentPosition.x, a.contentPosition.y, a.contentPosition.width, a.contentPosition.height, a.template.itemTemplate, a.template.itemTemplateHashCode, a.template.itemTemplateRenderName,
                        d, {"border-width": a.template.itemBorderWidth});
                    a.actualHasGroupTitle && this.graphics.template(f, i, j, p, 2, a.contentPosition.y, this.options.groupTitlePanelSize - 4, a.contentPosition.height, this._groupTitleTemplate, this._groupTitleTemplateHashCode, "onGroupTitleTemplateRender", a, null);
                    a.actualHasSelectorCheckbox && (this.graphics.activate("placeholder", 10), this.graphics.template(f, i, j, p, a.contentPosition.x, a.actualSize.height - (this.options.checkBoxPanelSize - 4), a.contentPosition.width, this.options.checkBoxPanelSize -
                    4, this._checkBoxTemplate, this._checkBoxTemplateHashCode, "onCheckBoxTemplateRender", a, null));
                    a.actualHasButtons && (this.graphics.activate("placeholder", 10), this.graphics.template(f, i, j, p, a.actualSize.width - (this.options.buttonsPanelSize - 4), a.contentPosition.y, this.options.buttonsPanelSize - 4, Math.max(a.contentPosition.height, a.actualSize.height - a.contentPosition.y), this._buttonsTemplate, a.template.name + this._buttonsTemplateHashCode, "onButtonsTemplateRender", a, null));
                    0 == this.options.showLabels && (k = new primitives.common.Label,
                        k.text = b.title, k.position = new primitives.common.Rect(f, i, j, p), k.weight = 1E4, k.labelType = 1, c.labels.push(k));
                    break;
                case 2:
                    e = b.itemTitleColor;
                    null == e && (e = "#000080");
                    g.hasOwnProperty(e) || (g[e] = []);
                    h = g[e];
                    h.push(new primitives.common.DotSegment(f, i, j, p, a.template.minimizedItemCornerRadius));
                    k = this._createLabel(f, i, j, p, a);
                    null != k && c.labels.push(k);
                    break;
                default:
                    this._debug && (e = "#ff0000", g.hasOwnProperty(e) || (g[e] = []), h = g[e], h.push(new primitives.common.DotSegment(f - 1, i - 1, 2, 2, 1)))
            }
        }));
    this.graphics.activate("placeholder",
        4);
    for (e in g)g.hasOwnProperty(e) && (h = g[e], f = {
        fillColor: e,
        borderColor: e,
        opacity: 1,
        lineWidth: 1,
        lineType: 0
    }, this.graphics.polyline(h, f));
    this._redrawLabels()
};
primitives.orgdiagram.BaseController.prototype._redrawLabels = function () {
    var a, b, c, d, e, f, g, h;
    if (0 == this.options.showLabels) {
        g = 0;
        for (h = this._treeLevels.length; g < h; g += 1) {
            e = this._treeLevels[g];
            a = e.labels;
            d = 0;
            for (f = a.length; d < f; d += 1)b = a[d], null == e.labelsRect ? e.labelsRect = new primitives.common.Rect(b.position) : e.labelsRect.addRect(b.position), e.hasFixedLabels = e.hasFixedLabels || 2 == b.labelType
        }
        for (g = this._treeLevels.length - 1; 0 < g; g -= 1)a = this._treeLevels[g - 1], b = this._treeLevels[g], null != a.labelsRect && null !=
        b.labelsRect && a.labelsRect.overlaps(b.labelsRect) && (b.showLabels = !1);
        g = 0;
        for (h = this._treeLevels.length; g < h; g += 1)if (e = this._treeLevels[g], a = e.labels, e.showLabels) {
            d = 0;
            for (f = a.length; d < f; d += 1)if (b = a[d], b.isActive)for (e = d + 1; e < f; e += 1)if (c = a[e], c.isActive)if (b.position.overlaps(c.position))if (b.weight >= c.weight)0 == c.labelType && (c.isActive = !1); else {
                0 == b.labelType && (b.isActive = !1);
                break
            } else break
        }
    }
    this.graphics.activate("placeholder", 5);
    c = {
        "font-size": this.options.labelFontSize,
        "font-family": this.options.labelFontFamily,
        "font-style": this.options.labelFontStyle,
        "font-weight": this.options.labelFontWeight,
        "font-color": this.options.labelColor
    };
    g = 0;
    for (h = this._treeLevels.length; g < h; g += 1)if (e = this._treeLevels[g], e.showLabels || e.hasFixedLabels) {
        a = e.labels;
        d = 0;
        for (f = a.length; d < f; d += 1)if (b = a[d], b.isActive)switch (b.labelType) {
            case 0:
            case 2:
                this.graphics.text(b.position.x, b.position.y, b.position.width, b.position.height, b.text, b.labelOrientation, b.horizontalAlignmentType, b.verticalAlignmentType, c)
        }
    }
};
primitives.orgdiagram.BaseController.prototype._createLabel = function (a, b, c, d, e) {
    var f, g, h = null, j = this.options.labelOffset, i;
    i = e.orgItem;
    if (!primitives.common.isNullOrEmpty(i.label)) {
        switch (i.showLabel) {
            case 0:
                switch (this.options.showLabels) {
                    case 0:
                        switch (e.actualVisibility) {
                            case 3:
                            case 2:
                                h = new primitives.common.Label, h.labelType = 0, h.weight = e.leftPadding + e.rightPadding
                        }
                        break;
                    case 1:
                        h = new primitives.common.Label, h.labelType = 2, h.weight = 1E4
                }
                break;
            case 1:
                h = new primitives.common.Label, h.weight = 1E4, h.labelType =
                    2
        }
        if (null != h) {
            h.text = i.label;
            e = null != i.labelSize ? i.labelSize : this.options.labelSize;
            h.labelOrientation = 3 != i.labelOrientation ? i.labelOrientation : 3 != this.options.labelOrientation ? this.options.labelOrientation : 0;
            i = 0 != i.labelPlacement ? i.labelPlacement : 0 != this.options.labelPlacement ? this.options.labelPlacement : 1;
            switch (h.labelOrientation) {
                case 0:
                    f = e.width;
                    g = e.height;
                    break;
                case 1:
                case 2:
                    g = e.width, f = e.height
            }
            switch (i) {
                case 0:
                case 1:
                    h.position = new primitives.common.Rect(a + c / 2 - f / 2, b - j - g, f, g);
                    switch (h.labelOrientation) {
                        case 0:
                            h.horizontalAlignmentType =
                                0;
                            h.verticalAlignmentType = 2;
                            break;
                        case 1:
                            h.horizontalAlignmentType = 1;
                            h.verticalAlignmentType = 1;
                            break;
                        case 2:
                            h.horizontalAlignmentType = 2, h.verticalAlignmentType = 1
                    }
                    break;
                case 2:
                case 11:
                    h.position = new primitives.common.Rect(a + c + j, b - j - g, f, g);
                    switch (h.labelOrientation) {
                        case 0:
                            h.horizontalAlignmentType = 1;
                            h.verticalAlignmentType = 2;
                            break;
                        case 1:
                            h.horizontalAlignmentType = 1;
                            h.verticalAlignmentType = 0;
                            break;
                        case 2:
                            h.horizontalAlignmentType = 2, h.verticalAlignmentType = 2
                    }
                    break;
                case 3:
                    h.position = new primitives.common.Rect(a +
                    c + j, b + d / 2 - g / 2, f, g);
                    switch (h.labelOrientation) {
                        case 0:
                            h.horizontalAlignmentType = 1;
                            h.verticalAlignmentType = 1;
                            break;
                        case 1:
                            h.horizontalAlignmentType = 0;
                            h.verticalAlignmentType = 0;
                            break;
                        case 2:
                            h.horizontalAlignmentType = 0, h.verticalAlignmentType = 2
                    }
                    break;
                case 4:
                case 12:
                    h.position = new primitives.common.Rect(a + c + j, b + d + j, f, g);
                    switch (h.labelOrientation) {
                        case 0:
                            h.horizontalAlignmentType = 1;
                            h.verticalAlignmentType = 0;
                            break;
                        case 1:
                            h.horizontalAlignmentType = 2;
                            h.verticalAlignmentType = 0;
                            break;
                        case 2:
                            h.horizontalAlignmentType =
                                1, h.verticalAlignmentType = 2
                    }
                    break;
                case 5:
                    h.position = new primitives.common.Rect(a + c / 2 - f / 2, b + d + j, f, g);
                    switch (h.labelOrientation) {
                        case 0:
                            h.horizontalAlignmentType = 0;
                            h.verticalAlignmentType = 0;
                            break;
                        case 1:
                            h.horizontalAlignmentType = 2;
                            h.verticalAlignmentType = 1;
                            break;
                        case 2:
                            h.horizontalAlignmentType = 1, h.verticalAlignmentType = 1
                    }
                    break;
                case 6:
                case 10:
                    h.position = new primitives.common.Rect(a - f - j, b + d + j, f, g);
                    switch (h.labelOrientation) {
                        case 0:
                            h.horizontalAlignmentType = 2;
                            h.verticalAlignmentType = 0;
                            break;
                        case 1:
                            h.horizontalAlignmentType =
                                2;
                            h.verticalAlignmentType = 2;
                            break;
                        case 2:
                            h.horizontalAlignmentType = 1, h.verticalAlignmentType = 0
                    }
                    break;
                case 7:
                    h.position = new primitives.common.Rect(a - f - j, b + d / 2 - g / 2, f, g);
                    switch (h.labelOrientation) {
                        case 0:
                            h.horizontalAlignmentType = 2;
                            h.verticalAlignmentType = 1;
                            break;
                        case 1:
                            h.horizontalAlignmentType = 0;
                            h.verticalAlignmentType = 2;
                            break;
                        case 2:
                            h.horizontalAlignmentType = 0, h.verticalAlignmentType = 0
                    }
                    break;
                case 8:
                case 9:
                    switch (h.position = new primitives.common.Rect(a - f - j, b - j - g, f, g), h.labelOrientation) {
                        case 0:
                            h.horizontalAlignmentType =
                                2;
                            h.verticalAlignmentType = 2;
                            break;
                        case 1:
                            h.horizontalAlignmentType = 1;
                            h.verticalAlignmentType = 2;
                            break;
                        case 2:
                            h.horizontalAlignmentType = 2, h.verticalAlignmentType = 0
                    }
            }
        }
    }
    return h
};
primitives.orgdiagram.BaseController.prototype._tracePathAnnotations = function () {
    var a, b, c, d, e, f, g, h, j, i, k, l;
    a = 0;
    for (b = this.options.annotations.length; a < b; a += 1)switch (c = this.options.annotations[a], c.annotationType) {
        case 2:
            if (null == j && (j = this._getConnectionsGraph()), null != c.items && 0 < c.items.length) {
                k = c.items.slice(0);
                g = this._treeItemsByUserId[k[0]];
                if (1 == k.length) {
                    c = 0;
                    for (d = g.logicalParents.length; c < d; c += 1)e = this._treeItems[g.logicalParents[c]], null != e.itemConfig && k.push(e.itemConfig.id)
                }
                if (1 < k.length) {
                    c =
                        1;
                    for (d = k.length; c < d; c += 1) {
                        e = this._treeItemsByUserId[k[c]];
                        i = primitives.common.getShortestPath(j, g, e);
                        e = 1;
                        for (f = i.length; e < f; e += 1)l = j[i[e - 1]][i[e]], h = this._treeItems[l.id], h.highlightPath = 1, l.hasOwnProperty("partnerid") && (h = this._treeItems[l.partnerid], h.partnerHighlightPath = 1)
                    }
                }
            }
    }
};
primitives.orgdiagram.BaseController.prototype._getConnectionsGraph = function () {
    var a, b, c, d, e, f, g, h, j, i, k = {};
    b = 0;
    for (c = this._treeLevels.length; b < c; b += 1) {
        a = this._treeLevels[b];
        d = 0;
        for (e = a.treeItems.length; d < e; d += 1) {
            h = a.treeItems[d];
            h = this._treeItems[h];
            h.connectorPlacement & 8 ? j = [a.treeItems[h.levelPosition - 1]] : h.connectorPlacement & 2 ? j = [a.treeItems[h.levelPosition + 1]] : h.connectorPlacement & 1 ? (f = this._treeItems[h.visualParentId], j = 1 < f.partners.length ? f.partners.slice(0) : [h.visualParentId], 0 < f.extraPartners.length &&
            (j = j.concat(f.extraPartners))) : j = [];
            f = 0;
            for (g = j.length; f < g; f += 1)i = j[f], k.hasOwnProperty(h.id) || (k[h.id] = {}), k[h.id][i] = 1 == g ? {id: h.id} : {
                id: h.id,
                partnerid: i
            }, k.hasOwnProperty(i) || (k[i] = {}), k[i][h.id] = 1 == g ? {id: h.id} : {id: h.id, partnerid: i}
        }
    }
    return k
};
primitives.orgdiagram.BaseController.prototype._drawPrintPreview = function () {
    var a = this.options.printPreviewPageSize, b, c, d;
    if (4 == this.options.pageFitMode) {
        this.graphics.activate("placeholder", 1);
        for (b = 0; (b + 1) * a.width < this.m_placeholderRect.width;) {
            for (c = 0; (c + 1) * a.height < this.m_placeholderRect.height;)d = this.graphics.template(b * a.width, c * a.height, a.width, a.height, 0, 0, a.width, a.height, this._printPreviewTemplate, this._printPreviewTemplateHashCode, null, null, null), d.data({
                column: b,
                row: c
            }), c += 1;
            b += 1
        }
    }
};
primitives.orgdiagram.BaseController.prototype._drawAnnotations = function () {
    var a;
    a = 8;
    var b, c, d, e, f, g, h, j, i, k, l;
    b = 0;
    for (c = this.options.annotations.length; b < c; b += 1)switch (k = this.options.annotations[b], k.annotationType) {
        case 0:
            if (null != k.fromItem && null != k.toItem && (e = this._treeItemsByUserId[k.fromItem], f = this._treeItemsByUserId[k.toItem], null != e && null != f)) {
                h = new primitives.orgdiagram.ConnectorAnnotationConfig;
                g = new primitives.common.Connector(this.graphics);
                g.orientationType = this.options.orientationType;
                j = "connectorShapeType labelPlacementType offset lineWidth color lineType labelSize zOrderType".split(" ");
                a = 0;
                for (d = j.length; a < d; a += 1)i = j[a], g[i] = k.hasOwnProperty(i) ? k[i] : h[i];
                g.labelTemplate = this._annotationLabelTemplate;
                g.labelTemplateHashCode = this._annotationLabelTemplateHashCode;
                g.hasLabel = !primitives.common.isNullOrEmpty(k.label);
                l = new primitives.common.RenderEventArgs;
                l.context = k;
                switch (g.zOrderType) {
                    case 1:
                        a = 1;
                        break;
                    default:
                        a = 8
                }
                a = this.graphics.activate("placeholder", a);
                g.panelSize = a.size;
                this.transform.transformRect(e.actualPosition.x,
                    e.actualPosition.y, e.actualPosition.width, e.actualPosition.height, !0, this, function (a, b, c, d) {
                        var e = new primitives.common.Rect(a, b, c, d);
                        this.transform.transformRect(f.actualPosition.x, f.actualPosition.y, f.actualPosition.width, f.actualPosition.height, !0, this, function (a, b, c, d) {
                            a = new primitives.common.Rect(a, b, c, d);
                            g.draw(e, a, l)
                        })
                    })
            }
            break;
        case 1:
            if (null != k.items && 0 < k.items.length) {
                e = new primitives.common.Rect;
                a = 0;
                for (d = k.items.length; a < d; a += 1)h = this._treeItemsByUserId[k.items[a]], null != h && e.addRect(h.actualPosition);
                if (!e.isEmpty()) {
                    g = new primitives.common.Shape(this.graphics);
                    h = new primitives.orgdiagram.ShapeAnnotationConfig;
                    j = "opacity cornerRadius shapeType offset lineWidth borderColor fillColor lineType labelSize labelOffset labelPlacement zOrderType".split(" ");
                    a = 0;
                    for (d = j.length; a < d; a += 1)i = j[a], g[i] = k.hasOwnProperty(i) ? k[i] : h[i];
                    switch (g.zOrderType) {
                        case 2:
                            a = 8;
                            break;
                        case 1:
                            a = 1;
                            break;
                        default:
                            switch (g.shapeType) {
                                case 3:
                                case 1:
                                case 2:
                                    a = 8;
                                    break;
                                default:
                                    a = 1
                            }
                    }
                    a = this.graphics.activate("placeholder", a);
                    g.position =
                        e;
                    g.orientationType = this.options.orientationType;
                    g.panelSize = a.size;
                    g.labelTemplate = this._annotationLabelTemplate;
                    g.labelTemplateHashCode = this._annotationLabelTemplateHashCode;
                    g.hasLabel = null != k.templateName || null != k.label;
                    l = new primitives.common.RenderEventArgs;
                    l.context = k;
                    l.templateName = g.labelTemplate;
                    this.transform.transformRect(e.x, e.y, e.width, e.height, !0, this, function (a, b, c, d) {
                        a = new primitives.common.Rect(a, b, c, d);
                        g.draw(a, l)
                    })
                }
            }
    }
};
primitives.orgdiagram.BaseController.prototype._redrawConnectors = function () {
    var a = this.graphics.activate("placeholder", 2), b, c, d, e, f, g, h;
    if (this._treeItems.hasOwnProperty(this._visualRootItem)) {
        e = new primitives.orgdiagram.Buffer(this.options);
        for (h = 0; h < this._treeLevels.length; h += 1) {
            d = this._treeLevels[h];
            c = d.treeItems;
            f = 0;
            for (g = c.length; f < g; f += 1)b = this._treeItems[c[f]], this._redrawConnector(a.hasGraphics, e, b, d)
        }
        b = e.getPolylines();
        f = 0;
        for (g = b.length; f < g; f += 1)c = b[f], 0 < c.segments.length && (a = {
            borderColor: c.lineColor,
            lineWidth: c.lineWidth, lineType: c.lineType
        }, this.graphics.polyline(c.segments, a))
    }
};
primitives.orgdiagram.BaseController.prototype._redrawConnector = function (a, b, c, d) {
    var e, f, g, h, j, i, k, l, m, n = 0, p, q = 0 == this.options.connectorType, r;
    m = 0 < c.partnerConnectorOffset ? d.connectorShift - d.levelSpace / 2 * (d.partnerConnectorOffset - c.partnerConnectorOffset + 1) : c.connectorPlacement & 4 ? c.actualPosition.bottom() : d.connectorShift;
    1 >= c.partnerConnectorOffset ? b.selectPalette(0) : 1 < c.partnerConnectorOffset ? b.selectPalette(c.partnerConnectorOffset - 1) : b.selectPalette(d.partnerConnectorOffset);
    0 < c.visualChildren.length &&
    (e = 4 === c.actualVisibility && c.id === this._visualRootItem, l = c.actualPosition.horizontalCenter());
    if (1 < c.partners.length || 0 < c.extraPartners.length) {
        f = [];
        g = c.partners;
        for (i = 0; i < g.length; i += 1)h = this._treeItems[g[i]], p = new primitives.orgdiagram.ConnectorPoint(h.actualPosition.horizontalCenter(), h.actualPosition.bottom()), p.isSquared = !0, p.highlightPath = h.partnerHighlightPath, p.connectorStyleType = h.partnerHighlightPath ? 2 : 1, f.push(p);
        g = c.extraPartners;
        for (i = 0; i < g.length; i += 1)h = this._treeItems[g[i]], p = new primitives.orgdiagram.ConnectorPoint(h.actualPosition.horizontalCenter(),
            h.actualPosition.bottom()), p.isSquared = !0, p.highlightPath = h.partnerHighlightPath, p.connectorStyleType = h.partnerHighlightPath ? 2 : 0, f.push(p);
        0 < f.length && (f.sort(function (a, b) {
            return a.x - b.x
        }), 0 == c.visualChildren.length && (l = (f[0].x + f[f.length - 1].x) / 2), this._drawTopConnectors(b, l, m, f, !0, a))
    }
    if (0 < c.visualChildren.length) {
        f = [];
        k = !1;
        g = c.visualChildren;
        for (i = 0; i < g.length; i += 1)if (h = this._treeItems[g[i]], j = this._treeLevels[h.level], r = b.getPolyline(h.highlightPath ? 2 : 1).segments, h.connectorPlacement & 8)j = this._treeItems[j.treeItems[h.levelPosition -
        1]], this.transform.transformPoints(h.actualPosition.x, h.actualPosition.verticalCenter(), j.actualPosition.right(), h.actualPosition.verticalCenter(), !0, this, function (a, b, c, d) {
            r.push(new primitives.common.MoveSegment(a, b));
            r.push(new primitives.common.LineSegment(c, d))
        }); else if (h.connectorPlacement & 2)j = this._treeItems[j.treeItems[h.levelPosition + 1]], this.transform.transformPoints(h.actualPosition.right(), h.actualPosition.verticalCenter(), j.actualPosition.x, h.actualPosition.verticalCenter(), !0, this,
            function (a, b, c, d) {
                r.push(new primitives.common.MoveSegment(a, b));
                r.push(new primitives.common.LineSegment(c, d))
            }); else if (h.connectorPlacement & 1 && !e) {
            j = !0;
            if (a)switch (h.actualVisibility) {
                case 2:
                case 3:
                    j = q
            }
            p = new primitives.orgdiagram.ConnectorPoint(h.actualPosition.horizontalCenter() + 0, h.actualPosition.top());
            p.isSquared = j;
            p.connectorStyleType = h.highlightPath ? 2 : 1;
            f.push(p);
            k = k || p.isSquared
        }
        !e && 0 < f.length && (n = this._drawTopConnectors(b, l, d.connectorShift, f, k, a));
        e || this.transform.transformPoints(l, m,
            l, d.connectorShift, !0, this, function (a, d, e, g) {
                r = b.getPolyline(n).segments;
                this.showElbowDots && (0 != this.options.elbowType && 0 < c.partners.length) && r.push(new primitives.common.DotSegment(a - 1, d - 1, 2, 2, 1));
                r.push(new primitives.common.MoveSegment(a, d));
                r.push(new primitives.common.LineSegment(e, g));
                this.showElbowDots && (0 != this.options.elbowType && 1 < f.length) && r.push(new primitives.common.DotSegment(e - 1, g - 1, 2, 2, 1))
            })
    }
};
primitives.orgdiagram.BaseController.prototype._drawTopConnectors = function (a, b, c, d, e, f) {
    var g, h, j, i, k = [], l, m = 0, n;
    if (e) {
        k = [];
        g = 0;
        for (j = d.length; g < j; g += 1)if (i = d[g], i.x < b && !i.isSquared)k.push(i); else break;
        j = k.length;
        0 < j && (k[j - 1].connectorStyleType = this._drawAngularConnectors(a, b, c, k, !1), m = Math.max(m, k[j - 1].connectorStyleType));
        k = [];
        for (h = d.length - 1; h >= g; h -= 1)if (i = d[h], i.x > b && !i.isSquared)k.push(i); else break;
        j = k.length;
        0 < j && (k[j - 1].connectorStyleType = this._drawAngularConnectors(a, b, c, k, !1), m = Math.max(m,
            k[j - 1].connectorStyleType));
        for (k = g; k <= h; k += 1) {
            i = d[k];
            n = a.getPolyline(i.connectorStyleType).segments;
            m = Math.max(m, i.connectorStyleType);
            e = this.options.dotItemsInterval / 2;
            if (f)switch (this.options.elbowType) {
                case 2:
                case 3:
                    Math.abs(b - i.x) > e && Math.abs(c - i.y) > e && (i.hasElbow = !0, i.elbowPoint1 = new primitives.common.Point(i.x, c + (c > i.y ? -e : e)), i.elbowPoint2 = new primitives.common.Point(i.x + (b > i.x ? e : -e), c));
                    break;
                case 1:
                    0 < h - g && this.transform.transformPoints(i.x, c, i.x, i.y, !0, this, function (a, b) {
                        n.push(new primitives.common.DotSegment(a -
                        1, b - 1, 2, 2, 1))
                    })
            }
            i.hasElbow ? (this.transform.transformPoints(i.x, i.y, i.elbowPoint1.x, i.elbowPoint1.y, !0, this, function (a, b, c, d) {
                n.push(new primitives.common.MoveSegment(a, b));
                n.push(new primitives.common.LineSegment(c, d))
            }), this.transform.transform3Points(i.elbowPoint1.x, i.elbowPoint1.y, i.elbowPoint1.x, i.elbowPoint2.y, i.elbowPoint2.x, i.elbowPoint2.y, !0, this, function (a, b, c, d, e, f) {
                switch (this.options.elbowType) {
                    case 2:
                        n.push(new primitives.common.MoveSegment(a, b));
                        n.push(new primitives.common.LineSegment(e,
                            f));
                        break;
                    case 3:
                        n.push(new primitives.common.MoveSegment(a, b)), n.push(new primitives.common.CubicArcSegment(a, b, c, d, e, f))
                }
            })) : this.transform.transformPoints(i.x, c, i.x, i.y, !0, this, function (a, b, c, d) {
                n.push(new primitives.common.MoveSegment(a, b));
                n.push(new primitives.common.LineSegment(c, d))
            })
        }
        f = {};
        e = {};
        for (l in primitives.common.ConnectorStyleType)primitives.common.ConnectorStyleType.hasOwnProperty(l) && (f[primitives.common.ConnectorStyleType[l]] = b, e[primitives.common.ConnectorStyleType[l]] = b);
        k = Math.max(0,
            g - 1);
        for (j = Math.min(h + 1, d.length - 1); k <= j; k += 1)i = d[k], f[i.connectorStyleType] = Math.min(f[i.connectorStyleType], i.hasElbow ? i.elbowPoint2.x : i.x), e[i.connectorStyleType] = Math.max(e[i.connectorStyleType], i.hasElbow ? i.elbowPoint2.x : i.x);
        d = b;
        for (k = 2; 0 <= k; k -= 1)n = a.getPolyline(k).segments, l = f[k], null != l && l < d && (this.transform.transformPoints(l, c, d, c, !0, this, function (a, b, c, d) {
            n.push(new primitives.common.MoveSegment(a, b));
            n.push(new primitives.common.LineSegment(c, d))
        }), d = l), l = e[k], null != l && l > b && (this.transform.transformPoints(l,
            c, b, c, !0, this, function (a, b, c, d) {
                n.push(new primitives.common.MoveSegment(a, b));
                n.push(new primitives.common.LineSegment(c, d))
            }), b = l)
    } else m = Math.max(m, this._drawAngularConnectors(a, b, c, d, !0));
    return m
};
primitives.orgdiagram.BaseController.prototype._drawAngularConnectors = function (a, b, c, d, e) {
    var f = null, g = d.length, h, j, i, k = 0, f = e ? b : d[g - 1].x;
    j = new primitives.common.Point(f, c);
    for (b = 0; b < g; b += 1)switch (h = d[b], i = a.getPolyline(h.connectorStyleType).segments, k = Math.max(k, h.connectorStyleType), this.transform.transformPoint(f, c, !0, this, function (a, b) {
        i.push(new primitives.common.MoveSegment(a, b))
    }), this.options.connectorType) {
        case 1:
            this.transform.transformPoint(h.x, h.y, !0, this, function (a, b) {
                i.push(new primitives.common.LineSegment(a,
                    b))
            });
            break;
        case 2:
            h = new primitives.common.Rect(j, h), e ? f > h.x ? this.transform.transform3Points(h.right(), h.verticalCenter(), h.x, h.verticalCenter(), h.x, h.bottom(), !0, this, function (a, b, c, d, e, f) {
                i.push(new primitives.common.CubicArcSegment(a, b, c, d, e, f))
            }) : this.transform.transform3Points(h.x, h.verticalCenter(), h.right(), h.verticalCenter(), h.right(), h.bottom(), !0, this, function (a, b, c, d, e, f) {
                i.push(new primitives.common.CubicArcSegment(a, b, c, d, e, f))
            }) : f > h.x ? this.transform.transformPoints(h.x, h.y, h.x, h.bottom(),
                !0, this, function (a, b, c, d) {
                    i.push(new primitives.common.QuadraticArcSegment(a, b, c, d))
                }) : this.transform.transformPoints(h.right(), h.y, h.right(), h.bottom(), !0, this, function (a, b, c, d) {
                i.push(new primitives.common.QuadraticArcSegment(a, b, c, d))
            })
    }
    return k
};
primitives.orgdiagram.BaseController.prototype._centerOnCursor = function (a, b) {
    var c;
    if (null !== a && (this.graphics.activate("placeholder", 7), c = this._getTransformedItemPosition(a), b || this._isAnnotationNeeded(a, this._getPanelPosition())))this.m_scrollPanel.scrollLeft(c.horizontalCenter() - this.m_scrollPanelRect.horizontalCenter()), this.m_scrollPanel.scrollTop(c.verticalCenter() - this.m_scrollPanelRect.verticalCenter())
};
primitives.orgdiagram.BaseController.prototype._setOption = function (a, b) {
    jQuery.Widget.prototype._setOption.apply(this, arguments);
    switch (a) {
        case "disabled":
            var c = jQuery([]);
            b ? (c.filter(".ui-state-focus").blur(), c.removeClass("ui-state-hover"), c.propAttr("disabled", !0), this.element.addClass("ui-disabled")) : (c.propAttr("disabled", !1), this.element.removeClass("ui-disabled"))
    }
};
primitives.orgdiagram.BaseController.prototype._getTreeItemForMousePosition = function (a, b) {
    var c = null, d = this, e, f, g;
    this.graphics.activate("placeholder", 7);
    a /= this.scale;
    b /= this.scale;
    this.transform.transformPoint(a, b, !1, this, function (a, b) {
        e = 0;
        for (f = this._treeLevels.length; e < f; e += 1)if (g = d._treeLevels[e], 0 < g.activeTreeItems.length && b > g.topConnectorShift && b <= g.connectorShift) {
            c = d._treeItems[primitives.common.binarySearch(g.activeTreeItems, function (c) {
                c = d._treeItems[c];
                switch (c.actualVisibility) {
                    case 1:
                        if (c.actualPosition.contains(a,
                                b))return 0;
                    case 2:
                    case 3:
                        return a - c.actualPosition.horizontalCenter();
                    case 4:
                        if (d._debug)throw"Clickable items collection should contain only visible items.";
                }
            })];
            break
        }
    });
    return c
};
primitives.orgdiagram.BaseController.prototype._drawHighlightAnnotation = function () {
    var a = primitives.common, b, c, d, e, f;
    e = !0;
    var g;
    if (null !== this._highlightTreeItem)switch (this._highlightTreeItem.actualVisibility) {
        case 2:
        case 3:
        case 1:
            b = this._highlightTreeItem;
            c = b.orgItem;
            switch (c.showCallout) {
                case 2:
                    e = !1;
                    break;
                case 1:
                    e = !1;
                    break;
                default:
                    e = this.options.showCallout
            }
            e ? (this.graphics.activate("placeholder", 7), e = this._getTransformedItemPosition(b), e = new a.Point(e.horizontalCenter(), e.verticalCenter()), d =
                this._getPanelPosition(), this._isAnnotationNeeded(b, d) ? (c = !a.isNullOrEmpty(c.calloutTemplateName) ? c.calloutTemplateName : !a.isNullOrEmpty(c.templateName) ? c.templateName : !a.isNullOrEmpty(this.options.defaultCalloutTemplateName) ? this.options.defaultCalloutTemplateName : this.options.defaultTemplateName, c = this._templates[c], null == c && (c = this._defaultTemplate), f = this._getAnnotationPosition(e, d, c.itemSize), d = new a.Rect(f), d.addRect(e.x, e.y), d.offset(50), g = d.getCSS(), g.display = "inherit", g.visibility = "inherit",
                this.m_calloutPlaceholder.css(g), e.x -= d.x, e.y -= d.y, f.x -= d.x, f.y -= d.y, a = new a.RenderEventArgs, a.context = b.itemConfig, a.isCursor = b.isCursor, a.isSelected = b.isSelected, a.templateName = c.name, this.graphics.resize("calloutplaceholder", d.width, d.height), this.graphics.activate("calloutplaceholder", 9), this.graphics.template(f.x, f.y, f.width, f.height, 0, 0, f.width, f.height, c.itemTemplate, c.itemTemplateHashCode, c.itemTemplateRenderName, a, null), this.pointerPlacement = 0, this.m_calloutShape.cornerRadius = this.options.calloutCornerRadius,
                this.m_calloutShape.offset = this.options.calloutOffset, this.m_calloutShape.opacity = this.options.calloutOpacity, this.m_calloutShape.lineWidth = this.options.calloutLineWidth, this.m_calloutShape.pointerWidth = this.options.calloutPointerWidth, this.m_calloutShape.borderColor = this.options.calloutBorderColor, this.m_calloutShape.fillColor = this.options.calloutfillColor, this.m_calloutShape.draw(e, f)) : this.m_calloutPlaceholder.css({
                display: "none",
                visibility: "hidden"
            })) : this.m_calloutPlaceholder.css({
                display: "none",
                visibility: "hidden"
            });
            break;
        case 4:
            this.m_calloutPlaceholder.css({display: "none", visibility: "hidden"})
    }
};
primitives.orgdiagram.BaseController.prototype._hideHighlightAnnotation = function () {
    this.m_calloutPlaceholder.css({display: "none", visibility: "hidden"})
};
primitives.orgdiagram.BaseController.prototype._getPanelPosition = function () {
    return new primitives.common.Rect(this.m_scrollPanel.scrollLeft(), this.m_scrollPanel.scrollTop(), Math.min(this.m_scrollPanelRect.width - 25, this.m_placeholderRect.width), Math.min(this.m_scrollPanelRect.height - 25, this.m_placeholderRect.height))
};
primitives.orgdiagram.BaseController.prototype._getTransformedItemPosition = function (a) {
    var b = !1;
    this.transform.transformRect(a.actualPosition.x * this.scale, a.actualPosition.y * this.scale, a.actualPosition.width * this.scale, a.actualPosition.height * this.scale, !0, this, function (a, d, e, f) {
        b = new primitives.common.Rect(a, d, e, f)
    });
    return b
};
primitives.orgdiagram.BaseController.prototype._isAnnotationNeeded = function (a, b) {
    var c = !1, d = this._getTransformedItemPosition(a);
    if (1 != a.actualVisibility || !b.overlaps(d))c = !0;
    return c
};
primitives.orgdiagram.BaseController.prototype._getAnnotationPosition = function (a, b, c) {
    var d = new primitives.common.Rect(a.x, a.y, c.width, c.height);
    a.y > b.bottom() - b.height / 4 ? (d.y -= c.height / 2, d.x = a.x < b.horizontalCenter() ? d.x + c.width / 4 : d.x - (c.width / 4 + c.width)) : (d.y += c.height / 4, d.x -= c.width / 2);
    d.x < b.x ? d.x = b.x + 5 : d.right() > b.right() && (d.x -= d.right() - b.right() + 5);
    d.y < b.y ? d.y = b.y + 5 : d.bottom() > b.bottom() && (d.y -= d.bottom() - b.bottom() + 5);
    return d
};
primitives.orgdiagram.BaseController.prototype._positionTreeItems = function () {
    var a = new primitives.common.Rect(0, 0, (this.m_scrollPanelRect.width - 25) / this.scale, (this.m_scrollPanelRect.height - 25) / this.scale), b = new primitives.common.Rect(0, 0, 0, 0), c, d, e, f, g;
    switch (this.options.orientationType) {
        case 2:
        case 3:
            a.invert()
    }
    if (0 < this._treeLevels.length) {
        switch (this.options.pageFitMode) {
            case 0:
            case 4:
                c = [new primitives.orgdiagram.LevelVisibility(0, 1)];
                b = this._setTreeLevelsVisibilityAndPositionTreeItems(c, 0);
                break;
            default:
                c = [new primitives.orgdiagram.LevelVisibility(0, 1)];
                b = [];
                switch (this.options.minimalVisibility) {
                    case 2:
                        b.push(2);
                        break;
                    case 0:
                    case 3:
                    case 4:
                        b.push(2), b.push(3)
                }
                for (d = this._treeLevels.length - 1; 0 <= d; d -= 1)for (e = 0; e < b.length; e += 1)c.push(new primitives.orgdiagram.LevelVisibility(d, b[e]));
                d = this._setTreeLevelsVisibilityAndPositionTreeItems(c, c.length - 1);
                d.addRect(a);
                d.offset(0, 0, 5, 5);
                b = this._setTreeLevelsVisibilityAndPositionTreeItems(c, 0);
                if (!this._checkDiagramSize(b, d) && (e = 0, b = this._setTreeLevelsVisibilityAndPositionTreeItems(c,
                        c.length - 1), this._checkDiagramSize(b, d))) {
                    for (g = f = c.length - 1; 1 < f - e;)g = Math.floor((f + e) / 2), b = this._setTreeLevelsVisibilityAndPositionTreeItems(c, g), this._checkDiagramSize(b, d) ? f = g : e = g;
                    f !== g && (b = this._setTreeLevelsVisibilityAndPositionTreeItems(c, f))
                }
        }
        switch (this.options.pageFitMode) {
            case 4:
                a = this._stretchToAvoidPageMargins();
                b.width = a.width;
                b.height = a.height;
                break;
            default:
                b.width < a.width && (this._stretchToWidth(b.width, a.width), b.width = a.width), b.height < a.height && (b.height = a.height)
        }
        switch (this.options.orientationType) {
            case 2:
            case 3:
                b.invert()
        }
        this.m_placeholder.css(b.getCSS());
        this.m_placeholderRect = new primitives.common.Rect(b)
    }
};
primitives.orgdiagram.BaseController.prototype._stretchToAvoidPageMargins = function () {
    var a = new primitives.common.Size(this.options.printPreviewPageSize), b = this, c, d, e, f, g, h;
    switch (this.options.orientationType) {
        case 2:
        case 3:
            a.invert()
    }
    c = [];
    e = 0;
    for (f = this._treeLevels.length; e < f; e += 1)c.push(this._treeLevels[e].treeItems);
    d = primitives.common.mergeSort(c, function (a) {
        return b._treeItems[a].offset
    });
    c = 0;
    g = a.width;
    e = 0;
    for (f = d.length; e < f; e += 1)h = b._treeItems[d[e]], h.offset + c < g && h.offset + h.actualSize.width +
    c > g && (c += g - h.offset - c + this.options.normalItemsInterval / 2), h.offset += c, h.offset > g && (g += a.width);
    c = 0;
    f = a.height;
    for (e = 0; e < this._treeLevels.length; e += 1)d = this._treeLevels[e], d.shift + c < f && d.shift + d.depth + c > f && (c += f - d.shift - c + this.options.normalLevelShift / 2), d.shiftDown(c), d.shift > f && (f += a.height);
    return new primitives.common.Size(g + 1, f + 1)
};
primitives.orgdiagram.BaseController.prototype._checkDiagramSize = function (a, b) {
    var c = !1;
    switch (this.options.pageFitMode) {
        case 1:
            b.width >= a.width && (c = !0);
            break;
        case 2:
            b.height >= a.height && (c = !0);
            break;
        case 3:
            b.height >= a.height && b.width >= a.width && (c = !0)
    }
    return c
};
primitives.orgdiagram.BaseController.prototype._setTreeLevelsVisibilityAndPositionTreeItems = function (a, b) {
    var c, d;
    for (c = 0; c < this._treeLevels.length; c += 1)this._treeLevels[c].currentvisibility = 1;
    for (c = 0; c <= b; c += 1)d = a[c], this._treeLevels[d.level].currentvisibility = d.currentvisibility;
    this._recalcItemsSize();
    this._setOffsets();
    this._recalcLevelsDepth();
    this._shiftLevels();
    return new primitives.common.Rect(0, 0, Math.round(this._getDiagramWidth()), Math.round(this._getDiagramHeight()))
};
primitives.orgdiagram.BaseController.prototype._getDiagramHeight = function () {
    return this._treeLevels[this._treeLevels.length - 1].nextLevelShift
};
primitives.orgdiagram.BaseController.prototype._getDiagramWidth = function () {
    var a = 0, b, c;
    b = 0;
    for (c = this._treeLevels.length; b < c; b += 1)a = Math.max(a, this._treeLevels[b].currentOffset);
    return a += this.options.normalItemsInterval
};
primitives.orgdiagram.BaseController.prototype._setOffsets = function () {
    var a, b;
    a = 0;
    for (b = this._treeLevels.length; a < b; a += 1)this._treeLevels[a].currentOffset = 0;
    void 0 !== this._treeItems[this._visualRootItem] && this._setOffset(this._treeItems[this._visualRootItem])
};
primitives.orgdiagram.BaseController.prototype._setOffset = function (a) {
    var b = this._treeLevels[a.level], c = this._itemsInterval[0 === a.visibility ? b.currentvisibility : a.visibility] / 2, d, e, f, g, h, j;
    a.leftPadding = c + (0 < b.currentOffset ? c * a.relationDegree * this.options.cousinsIntervalMultiplier : 0);
    a.rightPadding = c;
    a.offset = b.currentOffset + a.leftPadding;
    b.currentOffset = a.offset + a.actualSize.width + a.rightPadding;
    if (0 < a.visualChildren.length) {
        b = 0;
        for (d = a.visualChildren.length; b < d; b += 1)this._setOffset(this._treeItems[a.visualChildren[b]]);
        c = this._getChildrenOffset(a);
        if (0 < c)this._offsetItemChildren(a, c); else if (0 > c && (c = -c, this._offsetItem(a, c), d = null, e = {}, g = null, h = this._getParentItem(a), null !== h)) {
            for (b = h.visualChildren.length - 1; 0 <= b; b -= 1)if (j = h.visualChildren[b], j === a)d = []; else if (null !== d)if (f = this._getGapBetweenSiblings(j, a), e[j.id] = f, 0 < f)d.splice(0, 0, j); else {
                g = j;
                break
            }
            if (0 < d.length) {
                if (null !== g) {
                    f = [g];
                    f = f.concat(d);
                    f.push(a);
                    g = [[g]];
                    b = 1;
                    for (d = f.length; b < d; b += 1)a = f[b - 1], h = f[b], 2 == a.gravity || 1 == h.gravity ? g[g.length - 1].push(h) : g.push([h])
                } else g =
                    [d.slice(0)], g[g.length - 1].push(a);
                if (0 < g.length) {
                    d = g[g.length - 1];
                    for (b = d.length - 2; 0 <= b; b -= 1)a = d[b], f = e[a.id], c = Math.min(f, c), this._offsetItem(a, c), this._offsetItemChildren(a, c)
                }
                h = c / (g.length - 1);
                for (d = g.length - 2; 0 < d; d -= 1) {
                    j = g[d];
                    for (b = j.length - 1; 0 <= b; b -= 1)a = j[b], f = e[a.id], c = Math.min(d * h, Math.min(f, c)), this._offsetItem(a, c), this._offsetItemChildren(a, c)
                }
            }
        }
    }
};
primitives.orgdiagram.BaseController.prototype._getGapBetweenSiblings = function (a, b) {
    var c = null, d = this._getRightMargins(a), e = this._getLeftMargins(b), f = Math.min(d.length, e.length), g, h;
    for (g = 0; g < f && !(h = e[g] - d[g], c = null !== c ? Math.min(c, h) : h, 0 >= h); g += 1);
    return Math.floor(c)
};
primitives.orgdiagram.BaseController.prototype._getRightMargins = function (a) {
    var b = [], c, d, e;
    c = this._rightMargins[a];
    void 0 === c && (c = []);
    c = c.slice();
    c.splice(0, 0, a.id);
    a = 0;
    for (d = c.length; a < d; a += 1)e = this._treeItems[c[a]], b[a] = e.offset + e.actualSize.width + e.rightPadding;
    return b
};
primitives.orgdiagram.BaseController.prototype._getLeftMargins = function (a) {
    var b = [], c, d, e;
    c = this._leftMargins[a];
    void 0 === c && (c = []);
    c = c.slice();
    c.splice(0, 0, a.id);
    a = 0;
    for (d = c.length; a < d; a += 1)e = this._treeItems[c[a]], b[a] = e.offset - e.leftPadding;
    return b
};
primitives.orgdiagram.BaseController.prototype._getChildrenOffset = function (a) {
    var b = a.offset + a.actualSize.width / 2, c = null, d, e, f;
    if (null === a.visualAggregatorId) {
        a = a.visualChildren;
        d = null;
        f = 0;
        for (e = a.length; f < e && !(d = this._treeItems[a[f]], d.connectorPlacement & 1); f += 1);
        e = null;
        for (f = a.length - 1; 0 <= f && !(e = this._treeItems[a[f]], e.connectorPlacement & 1); f -= 1);
        switch (this.options.horizontalAlignment) {
            case 1:
                c = d.offset + d.actualSize.width / 2;
                break;
            case 2:
                c = e.offset + e.actualSize.width / 2;
                break;
            case 0:
                c = (d.offset +
                e.offset + e.actualSize.width) / 2
        }
    } else c = this._treeItems[a.visualAggregatorId], c = c.offset + c.actualSize.width / 2;
    return b - c
};
primitives.orgdiagram.BaseController.prototype._getParentItem = function (a) {
    var b = null;
    null !== a && null !== a.visualParentId && (b = this._treeItems[a.visualParentId]);
    return b
};
primitives.orgdiagram.BaseController.prototype._offsetItem = function (a, b) {
    a.offset += b;
    var c = this._treeLevels[a.level];
    c.currentOffset = Math.max(c.currentOffset, a.offset + a.actualSize.width)
};
primitives.orgdiagram.BaseController.prototype._offsetItemChildren = function (a, b) {
    var c = a.visualChildren, d, e, f;
    if (0 < c.length) {
        d = null;
        e = 0;
        for (f = c.length; e < f; e += 1)d = this._treeItems[c[e]], d.offset += b, this._offsetItemChildren(d, b);
        c = this._treeLevels[d.level];
        c.currentOffset = Math.max(c.currentOffset, d.offset + d.actualSize.width)
    }
};
primitives.orgdiagram.BaseController.prototype._stretchToWidth = function (a, b) {
    var c, d;
    switch (this.options.horizontalAlignment) {
        case 1:
            c = 0;
            break;
        case 2:
            c = b - a;
            break;
        case 0:
            c = (b - a) / 2
    }
    if (0 < c)for (d in this._treeItems)this._treeItems.hasOwnProperty(d) && (this._treeItems[d].offset += c)
};
primitives.orgdiagram.BaseController.prototype._recalcItemsSize = function () {
    var a, b, c, d, e, f, g;
    a = 0;
    for (b = this._treeLevels.length; a < b; a += 1) {
        f = this._treeLevels[a];
        g = f.treeItems;
        c = 0;
        for (d = g.length; c < d; c += 1)e = this._treeItems[g[c]], e.setActualSize(f, this.options)
    }
};
primitives.orgdiagram.BaseController.prototype._recalcLevelsDepth = function () {
    var a, b, c, d, e, f, g, h, j, i, k;
    a = 0;
    for (b = this._treeLevels.length; a < b; a += 1) {
        g = this._treeLevels[a];
        f = g.treeItems;
        c = 0;
        for (d = f.length; c < d; c += 1);
    }
    a = 0;
    for (b = this._treeLevels.length; a < b; a += 1) {
        g = this._treeLevels[a];
        g.shift = 0;
        g.depth = 0;
        g.partnerConnectorOffset = 0;
        g.childrenConnectorOffset = 0;
        g.actualVisibility = 4;
        f = g.treeItems;
        j = [];
        c = 0;
        for (d = f.length; c < d; c += 1)e = this._treeItems[f[c]], g.depth = Math.max(g.depth, e.actualSize.height), g.actualVisibility =
            Math.min(g.actualVisibility, e.actualVisibility), (0 < e.partners.length || 0 < e.extraPartners.length) && j.push(new primitives.common.StackSegment(e));
        if (0 < j.length) {
            c = 0;
            for (d = j.length; c < d; c += 1) {
                i = j[c];
                k = i.context.partners.slice(0).concat(i.context.extraPartners);
                e = 0;
                for (f = k.length; e < f; e += 1)h = this._treeItems[k[e]], h = h.offset + h.actualSize.width / 2, i.startIndex = null != i.startIndex ? Math.min(i.startIndex, h) : h, i.endIndex = null != i.endIndex ? Math.max(i.endIndex, h) : h
            }
            g.partnerConnectorOffset = primitives.common.stackSegments(j,
                function (a, b) {
                    a.context.partnerConnectorOffset = b
                })
        }
    }
};
primitives.orgdiagram.BaseController.prototype._shiftLevels = function () {
    var a = this.options.lineLevelShift, b, c, d;
    b = 0;
    for (c = this._treeLevels.length; b < c; b += 1)d = this._treeLevels[b], d.shift = a, d.levelSpace = this._getLevelShift(d.actualVisibility), d.connectorShift = d.shift + d.depth + (d.partnerConnectorOffset + 1) * (d.levelSpace / 2), d.topConnectorShift = d.shift - d.levelSpace / 2, a += d.depth + d.levelSpace + (d.partnerConnectorOffset + d.childrenConnectorOffset) * d.levelSpace / 2, d.nextLevelShift = a
};
primitives.orgdiagram.BaseController.prototype._getLevelShift = function (a) {
    var b = 0;
    switch (a) {
        case 1:
            b = this.options.normalLevelShift;
            break;
        case 2:
            b = this.options.dotLevelShift;
            break;
        case 3:
        case 4:
            b = this.options.lineLevelShift
    }
    return b
};
primitives.orgdiagram.BaseController.prototype._virtualReadTemplates = function () {
    var a, b = new primitives.orgdiagram.TemplateConfig, c;
    this._templates = {};
    a = new primitives.orgdiagram.Template(b, b);
    a.name = this.widgetEventPrefix + "Template";
    a.createDefaultTemplates();
    this._templates[a.name] = a;
    for (a = 0; a < this.options.templates.length; a += 1)c = this.options.templates[a], c = new primitives.orgdiagram.Template(c, b), c.createDefaultTemplates(), this._templates[c.name] = c
};
primitives.orgdiagram.BaseController.prototype._onDefaultTemplateRender = function (a, b) {
    var c = b.context, d = null != c.itemTitleColor ? c.itemTitleColor : "#4169e1", e = primitives.common.highestContrast(d, this.options.itemTitleSecondFontColor, this.options.itemTitleFirstFontColor);
    b.element.find("[name=titleBackground]").css({background: d});
    b.element.find("[name=photo]").attr({src: c.image, alt: c.title});
    b.element.find("[name=title]").css({color: e}).text(c.title);
    b.element.find("[name=description]").text(c.description)
};
primitives.orgdiagram.BaseController.prototype._createCheckBoxTemplate = function () {
    var a = jQuery("<div></div>");
    a.addClass("bp-item bp-selectioncheckbox-frame");
    a.append(jQuery('<label><nobr><input type="checkbox" name="checkbox" class="bp-selectioncheckbox" />&nbsp;<span name="selectiontext" class="bp-selectiontext">' + this.options.selectCheckBoxLabel + "</span></nobr></label>"));
    this._checkBoxTemplate = a.wrap("<div>").parent().html();
    this._checkBoxTemplateHashCode = primitives.common.hashCode(this._checkBoxTemplate)
};
primitives.orgdiagram.BaseController.prototype._onCheckBoxTemplateRender = function (a, b) {
    b.element.find("[name=checkbox]").prop("checked", b.isSelected)
};
primitives.orgdiagram.BaseController.prototype._createGroupTitleTemplate = function () {
    var a = jQuery("<div></div>");
    a.addClass("bp-item bp-corner-all bp-grouptitle-frame");
    this._groupTitleTemplate = a.wrap("<div>").parent().html();
    this._groupTitleTemplateHashCode = primitives.common.hashCode(this._groupTitleTemplate)
};
primitives.orgdiagram.BaseController.prototype._onGroupTitleTemplateRender = function (a, b) {
    var c = new primitives.text.Config, d = null != b.itemConfig.groupTitleColor ? b.itemConfig.groupTitleColor : "#4169e1";
    c.orientation = 2;
    c.horizontalAlignment = 0;
    c.verticalAlignment = 1;
    c.text = b.itemConfig.groupTitle;
    c.fontSize = "12px";
    c.color = primitives.common.highestContrast(d, this.options.itemTitleSecondFontColor, this.options.itemTitleFirstFontColor);
    c.fontFamily = "Arial";
    switch (b.renderingMode) {
        case 0:
            b.element.bpText(c);
            break;
        case 1:
            b.element.bpText("option", c), b.element.bpText("update")
    }
    primitives.common.css(b.element, {background: d})
};
primitives.orgdiagram.BaseController.prototype._createButtonsTemplate = function () {
    var a = jQuery("<ul></ul>");
    a.css({position: "absolute"}).addClass("ui-widget ui-helper-clearfix");
    this._buttonsTemplate = a.wrap("<div>").parent().html();
    this._buttonsTemplateHashCode = primitives.common.hashCode(this._buttonsTemplate)
};
primitives.orgdiagram.BaseController.prototype._onButtonsTemplateRender = function (a, b) {
    var c = 0, d, e, f, g;
    switch (b.renderingMode) {
        case 0:
            f = null != b.template.buttons ? b.template.buttons : this.options.buttons;
            for (g = 0; g < f.length; g += 1)d = f[g], e = jQuery('<li data-buttonname="' + d.name + '"></li>').css({
                position: "absolute",
                top: c + "px",
                left: "0px",
                width: d.size.width + "px",
                height: d.size.height + "px",
                padding: "3px"
            }).addClass(this.widgetEventPrefix + "button"), b.element.append(e), e.button({
                icons: {primary: d.icon}, text: d.text,
                label: d.label
            }), primitives.common.isNullOrEmpty(d.tooltip) || null != e.tooltip && e.tooltip({content: d.tooltip}), c += 10 + d.size.height
    }
};
primitives.orgdiagram.BaseController.prototype._createAnnotationLabelTemplate = function () {
    var a = jQuery("<div></div>");
    a.addClass("bp-item bp-corner-all bp-connector-label");
    this._annotationLabelTemplate = a.wrap("<div>").parent().html();
    this._annotationLabelTemplateHashCode = primitives.common.hashCode(this._annotationLabelTemplate)
};
primitives.orgdiagram.BaseController.prototype._onAnnotationLabelTemplateRender = function (a, b) {
    b.element.html(b.context.label)
};
primitives.orgdiagram.BaseController.prototype._createPrintPreviewTemplate = function () {
    var a = jQuery("<div></div>");
    a.addClass("bp-item bp-printpreview");
    this._printPreviewTemplate = a.wrap("<div>").parent().html();
    this._printPreviewTemplateHashCode = primitives.common.hashCode(this._printPreviewTemplate)
};
primitives.orgdiagram.BaseController.prototype._virtualCreateOrgTree = function () {
};
primitives.orgdiagram.BaseController.prototype._createVisualTree = function () {
    var a, b, c, d, e, f;
    this._defaultTemplate = this._highlightTreeItem = this._cursorTreeItem = null;
    this._defaultTemplate = this._templates[this.options.defaultTemplateName];
    void 0 === this._defaultTemplate && (this._defaultTemplate = this._templates[this.widgetEventPrefix + "Template"]);
    this._treeItems = {};
    this._treeItemCounter = 0;
    this._treeItemsByUserId = {};
    this._treeLevels = [];
    this._leftMargins = {};
    this._rightMargins = {};
    this._visualRootItem = 0;
    if (null !=
        this._orgItemRoot && (a = this._getNewTreeItem({
            visibility: 4,
            visualChildren: [],
            connectorPlacement: 0,
            visualParentId: null,
            parentId: null,
            orgItem: this._orgItemRoot,
            itemConfig: null,
            actualItemType: 0
        }), this._createVisualTreeItem(a), this._treeItemsByUserId.hasOwnProperty(this.options.cursorItem) && (this._cursorTreeItem = this._treeItemsByUserId[this.options.cursorItem], this._cursorTreeItem.isCursor = !0), this._treeItemsByUserId.hasOwnProperty(this.options.highlightItem) && (this._highlightTreeItem = this._treeItemsByUserId[this.options.highlightItem]),
            this._readVisualTree(this._treeItems[this._visualRootItem], 0), this._addExtraConnections(), this._showSelectedItems(), this._virtualShowCursorNeighbours(), this._debug))for (d in this._treeItems)if (this._treeItems.hasOwnProperty(d)) {
        c = this._treeItems[d];
        a = 0;
        for (b = c.logicalChildren.length; a < b; a += 1)if (e = c.logicalChildren[a], e = this._treeItems[e], f = !0, jQuery.each(e.logicalParents, function (a, b) {
                if (b == d)return f = !1
            }), f)throw"Family tree is broken. Logical child does not reference logical parent.";
    }
};
primitives.orgdiagram.BaseController.prototype._addExtraConnections = function () {
    var a, b, c, d, e, f;
    for (a in this._orgPartners)if (this._orgPartners.hasOwnProperty(a) && null != this._orgPartners[a]) {
        c = this._orgPartners[a];
        f = this._treeItemsByUserId[a];
        d = 0;
        for (e = c.length; d < e; d += 1)b = c[d], 0 == f.partners.length && f.partners.push(f.id), b = this._treeItemsByUserId[b], f.extraPartners.push(b.id)
    }
};
primitives.orgdiagram.BaseController.prototype._getNewTreeItem = function (a) {
    var b = new primitives.orgdiagram.TreeItem(this._treeItemCounter), c;
    for (c in a)a.hasOwnProperty(c) && (b[c] = a[c]);
    this._treeItemCounter += 1;
    this._treeItems[b.id] = b;
    a = a.orgItem;
    null != a && (this._treeItemsByUserId[a.id] = b, c = this._templates[a.templateName], b.template = void 0 !== c ? c : this._defaultTemplate, b.actualHasSelectorCheckbox = this._getSelectionVisibility(this.options.cursorItem == a.id, a.hasSelectorCheckbox, this.options.hasSelectorCheckbox),
        b.actualHasButtons = (0 < this.options.buttons.length || null != b.template.buttons && 0 < b.template.buttons.length) && this._getSelectionVisibility(this.options.cursorItem == a.id, a.hasButtons, this.options.hasButtons), b.actualIsActive = a.isActive && b.template.isActive);
    return b
};
primitives.orgdiagram.BaseController.prototype._createVisualTreeItem = function (a) {
    var b, c, d, e, f, g, h, j, i, k;
    i = j = 0;
    null !== a.visualParentId && (i = this._treeItems[a.visualParentId].visualChildren, j = h = primitives.common.indexOf(i, a), i = i.length - h - 1);
    g = [];
    f = this._orgItemChildren[a.orgItem.id];
    if (null != f) {
        h = 0;
        for (e = f.length; h < e; h += 1)if (c = f[h], this.showInvisibleSubTrees || this._hasVisibleChildren(c)) {
            b = this._getNewTreeItem({
                orgItem: c,
                itemConfig: c.context,
                parentId: a.id,
                visualParentId: a.id,
                actualItemType: c.itemType
            });
            g.push(b);
            b.visibility = !b.orgItem.isVisible ? 4 : 0;
            switch (a.actualItemType) {
                case 7:
                case 8:
                case 6:
                    switch (b.actualItemType) {
                        case 7:
                        case 8:
                        case 6:
                            b.actualItemType = 0;
                            break;
                        case 0:
                            b.actualItemType = 1
                    }
            }
            switch (b.actualItemType) {
                case 5:
                    this._defineLogicalParent(a, b), b.connectorPlacement = 5, b = this._createNewVisualParent(b);
                case 8:
                case 2:
                    d = this._treeItems[a.visualParentId];
                    if (a.connectorPlacement & 2)c = this._findLeftSiblingIndex(d.visualChildren, a), d.visualChildren.splice(c + 1, 0, b), b.connectorPlacement = 6, b.gravity =
                        2; else if (a.connectorPlacement & 8)c = this._findRightSiblingIndex(d.visualChildren, a), d.visualChildren.splice(c, 0, b), b.connectorPlacement = 12, b.gravity = 1; else switch (c.adviserPlacementType) {
                        case 2:
                            c = this._findLeftSiblingIndex(d.visualChildren, a);
                            d.visualChildren.splice(c + 1, 0, b);
                            b.connectorPlacement = 6;
                            b.gravity = 2;
                            break;
                        default:
                            c = this._findRightSiblingIndex(d.visualChildren, a), d.visualChildren.splice(c, 0, b), b.connectorPlacement = 12, b.gravity = 1
                    }
                    b.visualParentId = a.visualParentId;
                    switch (b.actualItemType) {
                        case 8:
                            this._defineLogicalParent(this._treeItems[a.parentId ||
                            a.logicalParents[0]], b);
                            break;
                        case 2:
                            this._defineLogicalParent(a, b)
                    }
                    break;
                case 4:
                    this._defineLogicalParent(a, b), b.connectorPlacement = 5, b = this._createNewVisualParent(b);
                case 1:
                    null === a.visualAggregatorId && this._createNewVisualAggregator(a);
                    switch (c.adviserPlacementType) {
                        case 2:
                            a.visualChildren.splice(0, 0, b);
                            b.connectorPlacement = 6;
                            b.gravity = 2;
                            break;
                        default:
                            a.visualChildren.push(b), b.connectorPlacement = 12, b.gravity = 1
                    }
                    b.visualParentId = a.id;
                    1 == b.actualItemType && this._defineLogicalParent(a, b);
                    break;
                case 0:
                    d =
                        a;
                    null !== a.visualAggregatorId && (d = this._treeItems[d.visualAggregatorId]);
                    d.visualChildren.push(b);
                    b.visualParentId = d.id;
                    this._defineLogicalParent(a, b);
                    b.connectorPlacement = (c.hideParentConnection ? 0 : 1) | (c.hideChildrenConnection ? 0 : 4);
                    break;
                case 7:
                case 6:
                    d = this._treeItems[a.visualParentId];
                    if (a.connectorPlacement & 2)d.visualChildren.splice(j, 0, b), b.connectorPlacement = 6, b.gravity = 2; else if (a.connectorPlacement & 8)d.visualChildren.splice(d.visualChildren.length - i, 0, b), b.connectorPlacement = 12, b.gravity = 1;
                    else {
                        switch (c.adviserPlacementType) {
                            case 2:
                                d.visualChildren.splice(j, 0, b);
                                b.gravity = 2;
                                break;
                            default:
                                d.visualChildren.splice(d.visualChildren.length - i, 0, b), b.gravity = 1
                        }
                        switch (b.actualItemType) {
                            case 6:
                                b.connectorPlacement = 5;
                                break;
                            case 7:
                                b.connectorPlacement = 4
                        }
                    }
                    b.visualParentId = a.visualParentId;
                    this._defineLogicalParent(this._treeItems[a.parentId || a.logicalParents[0]], b)
            }
        }
    }
    b = [];
    switch (a.actualItemType) {
        case 7:
        case 8:
        case 6:
            break;
        default:
            if (null !== a.visualParentId) {
                d = this._treeItems[a.visualParentId];
                for (h = j; h < d.visualChildren.length - i; h += 1)if (e = d.visualChildren[h], e.id == a.id)b.push(e); else switch (e.actualItemType) {
                    case 7:
                    case 8:
                    case 6:
                        b.push(e)
                }
            }
    }
    d = [];
    c = [];
    this._layoutChildren(a, a.orgItem.childrenPlacementType, d, c);
    h = 0;
    for (e = g.length; h < e; h += 1)this._createVisualTreeItem(g[h]);
    if (null !== a.visualAggregatorId && (e = this._treeItems[a.visualAggregatorId], 0 < e.visualChildren.length && (i = this._getAssitantsDepth(a), 1 < i)))for (h = 0; h < i - 1; h += 1)e = this._createNewVisualAggregator(e);
    if (0 < a.visualChildren.length &&
        (i = this._getAdvisersDepth(a), 1 < i)) {
        e = a;
        for (h = 0; h < i - 1; h += 1)e = this._createNewVisualAggregator(e)
    }
    f = [];
    h = 0;
    for (e = c.length; h < e; h += 1) {
        i = c[h];
        g = f[h] = 0;
        for (j = i.length; g < j; g += 1)f[h] = Math.max(f[h], this._getItemDepth(i[g]))
    }
    h = 0;
    for (e = f.length; h < e; h += 1)if (c = f[h], 1 < c) {
        g = 0;
        for (j = d[h].length; g < j; g += 1)if (k = d[h][g], 0 < k.visualChildren.length)for (i = c; 1 < i;)k = this._createNewVisualAggregator(k), i -= 1
    }
    this._layoutPartners(a, b)
};
primitives.orgdiagram.BaseController.prototype._layoutPartners = function (a, b) {
    var c, d, e, f, g, h = 0, j = [], i;
    f = [];
    if (1 < b.length) {
        d = this._getLastVisualAggregator(a);
        f = f.concat(d.visualChildren.slice(0));
        d = d.visualChildren.length = 0;
        for (e = b.length; d < e; d += 1)c = b[d], g = this._getAdvisersDepth(c), c = this._getItemDepth(c), h = Math.max(Math.max(h, c), g);
        d = 0;
        for (e = b.length; d < e; d += 1) {
            c = b[d];
            i = this._getLastVisualAggregator(c);
            for (c = this._getLastVisualAggregatorDepth(c); c < h;)i = this._createNewVisualAggregator(i), c += 1;
            j.push(this._getLastVisualAggregator(i).id)
        }
        if (0 <
            f.length) {
            i = b[Math.floor(b.length / 2)];
            if (1 < b.length && 0 == b.length % 2) {
                d = this._treeItems[i.visualParentId];
                e = this._findLeftSiblingIndex(d.visualChildren, i);
                c = d.visualChildren[e].gravity || d.visualChildren[e + 1].gravity;
                i = this._getNewTreeItem({
                    visibility: 4,
                    visualParentId: d.id,
                    connectorPlacement: i.connectorPlacement & 10,
                    gravity: c
                });
                d.visualChildren.splice(e + 1, 0, i);
                for (c = 1; c < h;)i = this._createNewVisualAggregator(i), i.connectorPlacement = 0, c += 1
            }
            i = this._getLastVisualAggregator(i);
            i.visualChildren = f;
            d = 0;
            for (e =
                     f.length; d < e; d += 1)h = f[d], h.visualParentId = i.id;
            d = 0;
            for (e = b.length; d < e; d += 1)if (c = b[d], c.id != a.id) {
                f = 0;
                for (g = a.logicalChildren.length; f < g; f += 1)switch (h = a.logicalChildren[f], h.actualItemType) {
                    case 5:
                    case 2:
                    case 4:
                    case 1:
                        break;
                    default:
                        this._defineLogicalParent(c, h)
                }
            }
        }
        i.partners = j
    }
};
primitives.orgdiagram.BaseController.prototype._defineLogicalParent = function () {
};
primitives.orgdiagram.BaseController.prototype._getLastVisualAggregatorDepth = function (a) {
    for (var b = 0; null != a.visualAggregatorId;)a = this._treeItems[a.visualAggregatorId], b += 1;
    return b + 1
};
primitives.orgdiagram.BaseController.prototype._getLastVisualAggregator = function (a) {
    for (; null != a.visualAggregatorId;)a = this._treeItems[a.visualAggregatorId];
    return a
};
primitives.orgdiagram.BaseController.prototype._createNewVisualParent = function (a) {
    var b;
    b = this._getNewTreeItem({visibility: 4, visualChildren: [a]});
    a.visualParentId = b.id;
    return b
};
primitives.orgdiagram.BaseController.prototype._hasVisibleChildren = function (a) {
    var b = !0, c, d;
    if (!a.isVisible && (b = !1, a = this._orgItemChildren[a.id], null != a)) {
        c = 0;
        for (d = a.length; c < d; c += 1)if (this._hasVisibleChildren(a[c])) {
            b = !0;
            break
        }
    }
    return b
};
primitives.orgdiagram.BaseController.prototype._getAdvisersDepth = function (a) {
    var b = 0, c = this._getParentItem(a), d, e;
    if (null !== c) {
        a = primitives.common.indexOf(c.visualChildren, a);
        for (d = a + 1; d < c.visualChildren.length; d += 1)if (e = c.visualChildren[d], e.connectorPlacement & 8)b = Math.max(b, this._getItemDepth(e)); else break;
        for (d = a - 1; 0 <= d; d -= 1)if (e = c.visualChildren[d], e.connectorPlacement & 2)b = Math.max(b, this._getItemDepth(e)); else break
    }
    return b
};
primitives.orgdiagram.BaseController.prototype._getAssitantsDepth = function (a) {
    var b = 0, c, d;
    for (c = 0; c < a.visualChildren.length; c += 1)d = a.visualChildren[c], d.connectorPlacement & 1 || (b = Math.max(b, this._getItemDepth(d)));
    return b
};
primitives.orgdiagram.BaseController.prototype._getItemsDepth = function (a) {
    var b = 0, c, d, e;
    c = 0;
    for (d = a.length; c < d; c += 1)e = a[c], b = Math.max(b, this._getItemDepth(e));
    return b
};
primitives.orgdiagram.BaseController.prototype._getItemDepth = function (a) {
    var b = 0, c, d;
    c = 0;
    for (d = a.visualChildren.length; c < d; c += 1)b = Math.max(b, this._getItemDepth(a.visualChildren[c]));
    return b + 1
};
primitives.orgdiagram.BaseController.prototype._layoutChildren = function (a, b, c, d) {
    var e, f, g, h, j, i, k, l, m, n = 4 == a.visibility && 0 == a.connectorPlacement;
    switch (this.options.horizontalAlignment) {
        case 0:
        case 1:
            f = 3;
            break;
        case 2:
            f = 2
    }
    0 === b && (b = this._hasLeavesOnly(a) ? 0 === this.options.leavesPlacementType ? 3 : this.options.leavesPlacementType : 0 === this.options.childrenPlacementType ? 2 : this.options.childrenPlacementType);
    e = a;
    null !== a.visualAggregatorId && (e = this._treeItems[a.visualAggregatorId]);
    switch (b) {
        case 2:
            0 < e.visualChildren.length &&
            (this._treeItems[e.visualChildren[0]].relationDegree = 1);
            break;
        case 3:
            if (3 < e.visualChildren.length) {
                a = e.visualChildren.slice(0);
                e.visualChildren.length = 0;
                j = Math.min(this.options.maximumColumnsInMatrix, Math.ceil(Math.sqrt(a.length)));
                i = Math.ceil(a.length / j);
                k = Math.ceil(j / 2);
                for (l = 0; l < k; l += 1) {
                    f = e;
                    for (m = 0; m < i; m += 1) {
                        b = this._getMatrixItem(a, 2 * l, m, j);
                        g = this._getMatrixItem(a, 2 * l + 1, m, j);
                        void 0 === c[m] && (c[m] = [], d[m] = []);
                        null !== b && (0 == l && (b.relationDegree = 1), f.visualChildren.push(b), b.visualParentId = f.id, b.connectorPlacement =
                            (n ? 0 : 2) | 4, b.gravity = 2, d[m].push(b));
                        if (null !== b || null !== g)h = this._getNewTreeItem({
                            visibility: 4,
                            visualParentId: f.id,
                            connectorPlacement: n ? 0 : 5
                        }), f.visualChildren.push(h), f.visualAggregatorId = h.id, c[m].push(h);
                        null !== g && (f.visualChildren.push(g), g.visualParentId = f.id, g.connectorPlacement = (n ? 0 : 8) | 4, g.gravity = 1, d[m].push(g));
                        f = h
                    }
                }
                2 < j && (e.visualAggregatorId = null)
            }
            break;
        case 1:
            a = e.visualChildren.slice(0);
            g = e.visualChildren.length = 0;
            for (j = a.length; g < j; g += 1) {
                b = a[g];
                h = this._getNewTreeItem({
                    visibility: 4, visualParentId: e.id,
                    connectorPlacement: n ? 0 : 5
                });
                e.visualAggregatorId = h.id;
                b.visualParentId = e.id;
                switch (f) {
                    case 2:
                        e.visualChildren.push(b);
                        e.visualChildren.push(h);
                        b.connectorPlacement = (n ? 0 : 2) | 4;
                        b.gravity = 2;
                        break;
                    case 3:
                        e.visualChildren.push(h), e.visualChildren.push(b), b.connectorPlacement = (n ? 0 : 8) | 4, b.gravity = 1
                }
                c[g] = [h];
                d[g] = [b];
                e = h
            }
    }
};
primitives.orgdiagram.BaseController.prototype._getMatrixItem = function (a, b, c, d) {
    0 < d % 2 && (b === d - 1 ? b = a.length : b === d && (b = d - 1));
    b = c * d + b;
    return b > a.length - 1 ? null : a[b]
};
primitives.orgdiagram.BaseController.prototype._hasLeavesOnly = function (a) {
    var b = !1, c, d, e;
    if (null !== a.orgItem && (e = this._orgItemChildren[a.orgItem.id], null != e && (c = e.length, 0 < c))) {
        b = !0;
        for (a = 0; a < c; a += 1)if (d = e[a], 0 === d.itemType && null != this._orgItemChildren[d.id]) {
            b = !1;
            break
        }
    }
    return b
};
primitives.orgdiagram.BaseController.prototype._findLeftSiblingIndex = function (a, b) {
    var c = null, d, e, f, g = {};
    for (e = a.length - 1; 0 <= e; e -= 1)if (d = a[e], null === c) {
        if (d === b) {
            c = -1;
            g[b] = !0;
            d = 0;
            for (f = b.logicalChildren.length; d < f; d += 1)g[b.logicalChildren[d]] = !0
        }
    } else if (g.hasOwnProperty(d)) {
        d = 0;
        for (f = b.logicalChildren.length; d < f; d += 1)g[b.logicalChildren[d]] = !0
    } else {
        c = e;
        break
    }
    return c
};
primitives.orgdiagram.BaseController.prototype._findRightSiblingIndex = function (a, b) {
    var c = null, d, e, f, g, h = {};
    e = 0;
    for (f = a.length; e < f; e += 1)if (d = a[e], null === c) {
        if (d === b) {
            c = f;
            h[b] = !0;
            d = 0;
            for (g = b.logicalChildren.length; d < g; d += 1)h[b.logicalChildren[d]] = !0
        }
    } else if (h.hasOwnProperty(d)) {
        d = 0;
        for (g = b.logicalChildren.length; d < g; d += 1)h[b.logicalChildren[d]] = !0
    } else {
        c = e;
        break
    }
    return c
};
primitives.orgdiagram.BaseController.prototype._createNewVisualAggregator = function (a) {
    var b, c;
    b = this._getNewTreeItem({
        visibility: 4,
        visualParentId: a.id,
        visualAggregatorId: a.visualAggregatorId,
        connectorPlacement: 4 == a.visibility && 0 == a.connectorPlacement ? 0 : 5
    });
    b.visualChildren = a.visualChildren;
    for (c = 0; c < b.visualChildren.length; c += 1)b.visualChildren[c].visualParentId = b.id;
    a.visualChildren = [b];
    a.visualAggregatorId = b.id;
    return b
};
primitives.orgdiagram.BaseController.prototype._readVisualTree = function (a, b) {
    var c = this._treeLevels[b], d, e;
    void 0 === c && (c = this._treeLevels[b] = new primitives.orgdiagram.TreeLevel(b));
    c.treeItems.push(a.id);
    a.actualIsActive && 4 != a.visibility && c.activeTreeItems.push(a.id);
    a.level = b;
    a.levelPosition = c.treeItems.length - 1;
    c = 0;
    for (d = a.visualChildren.length; c < d; c += 1)e = a.visualChildren[c], 0 === c && this._updateLeftMargins(e, 0), c === d - 1 && this._updateRightMargins(e, 0), this._readVisualTree(e, b + 1)
};
primitives.orgdiagram.BaseController.prototype._updateLeftMargins = function (a, b) {
    for (var c = a, d; null !== (c = this._getParentItem(c));)d = this._leftMargins[c.id], void 0 === d && (d = this._leftMargins[c.id] = []), void 0 === d[b] && (d[b] = a.id), b += 1
};
primitives.orgdiagram.BaseController.prototype._updateRightMargins = function (a, b) {
    for (var c = a, d; null !== (c = this._getParentItem(c));)d = this._rightMargins[c.id], void 0 === d && (d = this._rightMargins[c.id] = []), d[b] = a.id, b += 1
};
primitives.orgdiagram.BaseController.prototype._showSelectedItems = function () {
    var a, b, c, d, e, f;
    d = [];
    b = 0;
    for (c = this.options.annotations.length; b < c; b += 1)a = this.options.annotations[b], a.selectItems && (null != a.fromItem && d.push(a.fromItem), null != a.toItem && d.push(a.toItem), null != a.items && 0 < a.items.length && (d = d.concat(a.items)));
    b = 0;
    for (c = d.length; b < c; b += 1)a = this._treeItemsByUserId[d[b]], null != a && 0 === a.visibility && (a.visibility = 1);
    b = 0;
    for (c = this.options.selectedItems.length; b < c; b += 1)if (a = this._treeItemsByUserId[this.options.selectedItems[b]],
        null != a)switch (a.isSelected = !0, 0 === a.visibility && (a.visibility = 1), this.options.selectionPathMode) {
        case 1:
            f = this._getAllLogicalParents(a);
            d = 0;
            for (a = f.length; d < a; d += 1)e = f[d], 0 === e.visibility && (e.visibility = 1)
    }
};
primitives.orgdiagram.BaseController.prototype._getAllLogicalParents = function (a) {
    for (var b = [], c = [], d = [], e, f, c = c.concat(a.logicalParents); 0 < c.length;) {
        e = 0;
        for (f = c.length; e < f; e += 1)a = this._treeItems[c[e]], b.push(a), d = d.concat(a.logicalParents);
        c = d;
        d = []
    }
    return b
};
primitives.orgdiagram.BaseController.prototype._virtualShowCursorNeighbours = function () {
};
primitives.orgdiagram.BaseController.prototype._getSelectionVisibility = function (a, b, c) {
    var d = !1;
    switch (b) {
        case 0:
            switch (c) {
                case 0:
                    d = a;
                    break;
                case 1:
                    d = !0;
                    break;
                case 2:
                    d = !1
            }
            break;
        case 1:
            d = !0;
            break;
        case 2:
            d = !1
    }
    return d
};
primitives.common.ReferenceItem = function () {
    this.key = this.name = "";
    this.actualTargets = [];
    this.targets = [];
    this.processed = !1;
    this.isVisible = !0;
    this.level = 0
};
primitives.common.SharedReferences = function (a) {
    this.items = [];
    this.difference = this.weight = 0;
    0 < arguments.length && (this.difference = a)
};
primitives.common.StackSegment = function (a, b, c) {
    this.context = a;
    this.startIndex = b;
    this.endIndex = c
};
primitives.common.StackSegment.prototype.toString = function () {
    return "[" + Math.round(this.startIndex) + " - " + Math.round(this.endIndex) + "]"
};
primitives.common.getGraphSpanningTree = function (a, b, c) {
    var d = {}, e = {}, f, g = [], h = {}, j, i, k, l, m, n, p;
    e[b] = !0;
    j = 1;
    for (h[b] = null; 0 < j;) {
        g = [];
        l = k = i = null;
        for (f in e)if (e.hasOwnProperty(f)) {
            m = a[f];
            b = !1;
            for (n in m)if (m.hasOwnProperty(n) && !h.hasOwnProperty(n) && (p = m[n], b = !0, !k || 0 <= c(p, k)))i = n, k = p, l = f;
            b || g.push(f)
        }
        if (null == i)break; else e[i] = !0, j += 1, h[i] = l, d.hasOwnProperty(l) || (d[l] = []), d[l].push(i);
        b = 0;
        for (i = g.length; b < i; b += 1)delete e[g[b]], j -= 1
    }
    return d
};
primitives.common.getShortestPath = function (a, b, c) {
    var d = {}, e = {}, f = {}, g, h, j, i, k;
    d[b] = !0;
    g = 1;
    for (e[b] = 0; 0 < g;) {
        h = b = null;
        for (j in d)d.hasOwnProperty(j) && (null == h ? (b = j, h = e[j]) : h > e[j] && (b = j, h = e[j]));
        i = a[b];
        for (j in i)i.hasOwnProperty(j) && (k = h + 1, e.hasOwnProperty(j) ? e[j] > k && d.hasOwnProperty(j) && (e[j] = k, f[j] = b) : (e[j] = k, f[j] = b, d[j] = !0, g += 1));
        if (b == c)break; else delete d[b], g -= 1
    }
    for (a = []; null != c;)a.push(c), c = f[c];
    return a
};
primitives.common.invertReferences = function (a, b) {
    var c = {}, d, e, f, g, h;
    for (d in a)if (a.hasOwnProperty(d)) {
        e = a[d];
        e = null != b ? b(e) : e;
        g = 0;
        for (h = e.length; g < h; g += 1)f = e[g], c.hasOwnProperty(f) || (c[f] = []), c[f].push(d)
    }
    return c
};
primitives.common.optimizeReferences = function (a, b) {
    var c = {}, d = [], e = {}, f = {}, g, h, j, i, k, l, m, n, p, q, r;
    for (g in a)a.hasOwnProperty(g) && (h = a[g], j = new primitives.common.ReferenceItem, h.sort(), j.key = h.join(","), j.name = g, j.targets = h.slice(0), j.actualTargets = h.slice(0), j.level = 0, f[j.name] = j);
    for (; !primitives.common.isEmptyObject(f);) {
        h = {};
        j = primitives.common.getReferencesGraph(f);
        for (g in f)if (f.hasOwnProperty(g) && (i = f[g], d.push(i), !i.processed))for (m in l = primitives.common.getGraphSpanningTree(j, g, function (a,
                                                                                                                                                        b) {
            return a.weight > b.weight ? 1 : a.weight == b.weight ? b.difference - a.difference : -1
        }), l)if (l.hasOwnProperty(m)) {
            f[m].processed = !0;
            n = l[m];
            i = 0;
            for (k = n.length; i < k; i += 1)p = n[i], f[p].processed = !0, q = j[m][p], 1 < q.weight && (g = q.items.join(","), r = null, e.hasOwnProperty(g) ? r = e[g] : (r = new primitives.common.ReferenceItem, r.name = b(), r.key = g, r.actualTargets = q.items.slice(0), r.targets = q.items.slice(0), e[r.key] = r, h[r.name] = r), primitives.common.addGroup(f[m], r), primitives.common.addGroup(f[p], r))
        }
        f = h
    }
    i = 0;
    for (k = d.length; i < k; i +=
        1)e = d[i], c[e.name] = e.actualTargets;
    return c
};
primitives.common.addGroup = function (a, b) {
    var c, d, e, f;
    if (a.name != b.name) {
        e = {};
        c = 0;
        for (d = b.targets.length; c < d; c += 1)e[b.targets[c]] = !0;
        f = [];
        c = 0;
        for (d = a.actualTargets.length; c < d; c += 1)e.hasOwnProperty(a.actualTargets[c]) || f.push(a.actualTargets[c]);
        f.length != a.actualTargets.length && (f.push(b.name), a.actualTargets = f)
    }
};
primitives.common.getReferencesGraph = function (a) {
    var b = {}, c = primitives.common.invertReferences(a, function (a) {
        return a.targets
    }), d, e, f, g, h, j, i, k, l;
    for (d in c)if (c.hasOwnProperty(d)) {
        e = c[d];
        f = 0;
        for (h = e.length; f < h - 1; f += 1) {
            j = e[f];
            i = a[j];
            for (g = f + 1; g < h; g += 1)k = e[g], l = a[k], l = Math.abs(i.targets.length - l.targets.length), b.hasOwnProperty(j) || (b[j] = {}), b[j].hasOwnProperty(k) || (b[j][k] = new primitives.common.SharedReferences(l)), b[j][k].items.push(d), b[j][k].weight += 1, b.hasOwnProperty(k) || (b[k] = {}), b[k].hasOwnProperty(j) ||
            (b[k][j] = new primitives.common.SharedReferences(l)), b[k][j].items.push(d), b[k][j].weight += 1
        }
    }
    return b
};
primitives.common.topologicalSort = function (a) {
    var b = [], c = {}, d, e, f, g, h, j, i, k;
    for (d in a)if (a.hasOwnProperty(d)) {
        e = a[d];
        g = 0;
        for (h = e.length; g < h; g += 1)j = e[g].toString(), c.hasOwnProperty(j) || (c[j] = 0), c[j] += 1
    }
    j = [];
    for (d in a)a.hasOwnProperty(d) && (c.hasOwnProperty(d) || j.push(d));
    for (; 0 < j.length;) {
        d = [];
        g = 0;
        for (h = j.length; g < h; g += 1) {
            e = j[g];
            b.push(e);
            e = a[e];
            i = 0;
            for (k = e.length; i < k; i += 1)f = e[i].toString(), c[f] -= 1, 0 == c[f] && d.push(f)
        }
        j = d
    }
    return b
};
primitives.common.getGraphGrowthSequence = function (a, b, c) {
    var d = [b], e = {}, f, g = [], h = {}, j, i, k, l, m, n, p;
    e[b] = !0;
    j = 1;
    for (h[b] = null; 0 < j;) {
        g = [];
        k = i = null;
        l = {};
        for (f in e)if (e.hasOwnProperty(f)) {
            m = a[f];
            b = !1;
            for (n in m)if (m.hasOwnProperty(n) && !h.hasOwnProperty(n) && (p = c(m[n]), b = !0, null == l[n] && (l[n] = 0), l[n] += p, !k || l[n] > k))i = n, k = l[n];
            b || g.push(f)
        }
        if (null == i)break; else e[i] = !0, j += 1, h[i] = !0, d.push(i);
        b = 0;
        for (i = g.length; b < i; b += 1)delete e[g[b]], j -= 1
    }
    return d
};
primitives.common.mergeSort = function (a, b) {
    var c = null, d, e, f, g, h, j, i, k, l, m, n;
    switch (a.length) {
        case 0:
            c = [];
            break;
        case 1:
            c = a[0].slice(0);
            break;
        default:
            c = a[0];
            for (f = 1; f < a.length; f += 1) {
                d = a[f];
                e = [];
                j = c.length;
                i = d.length;
                h = g = 0;
                n = l = m = k = null;
                0 < j && (k = c[g], m = !b ? k : b(k));
                0 < i && (l = d[h], n = !b ? l : b(l));
                for (; g < j || h < i;)g >= j ? (e.push(l), h += 1, h < i && (l = d[h], n = !b ? l : b(l))) : h >= i ? (e.push(k), g += 1, g < j && (k = c[g], m = !b ? k : b(k))) : m < n ? (e.push(k), g += 1, g < j && (k = c[g], m = !b ? k : b(k))) : (e.push(l), h += 1, h < i && (l = d[h], n = !b ? l : b(l)));
                c = e
            }
    }
    return c
};
primitives.common.stackSegments = function (a, b) {
    var c = 0, d, e, f, g, h, j, i, k = [], l, m, n, p, q, r, s = {};
    a.sort(function (a, b) {
        return a.endIndex - a.startIndex - (b.endIndex - b.startIndex)
    });
    g = 0;
    for (h = a.length; g < h; g += 1) {
        f = a[g];
        e = d = 0;
        n = f.startIndex;
        s[n] = d + 1;
        p = f.endIndex;
        s[p] = e;
        i = k.length;
        if (0 < i) {
            l = [];
            r = q = !1;
            for (j = 0; j < i; j += 1)m = k[j], m < n ? (l.push(m), d = s[m], e = s[m]) : m < p ? (q || (l.push(n), q = !0), d = Math.max(d, s[m]), e = s[m]) : (q || (l.push(n), q = !0), r || (l.push(p), r = !0, s[n] = d + 1, s[p] = e), l.push(m));
            q || (l.push(n), q = !0);
            r || (l.push(p), r = !0, s[n] =
                d + 1, s[p] = e);
            k = l
        } else k = [n, p];
        b(f, s[n]);
        c = Math.max(c, s[n])
    }
    return c
};
primitives.common.binarySearch = function (a, b) {
    var c = null, d, e, f = 0, g = a.length - 1, h, j;
    if (0 < a.length && (c = a[f], d = b(c), 0 < d))if (e = Math.abs(d), j = a[g], d = b(j), 0 <= d)c = j; else {
        d = Math.abs(d);
        e > d && (e = d, c = j);
        for (; f + 1 < g;)if (h = Math.round((f + g) / 2), j = a[h], d = b(j), 0 == d) {
            c = j;
            break
        } else 0 < d ? f = h : g = h, d = Math.abs(d), e > d && (e = d, c = j)
    }
    return c
};
primitives.callout.Config = function () {
    this.classPrefix = "bpcallout";
    this.graphicsType = 1;
    this.actualGraphicsType = null;
    this.pointerPlacement = 0;
    this.snapPoint = this.position = null;
    this.cornerRadius = "10%";
    this.offset = 0;
    this.lineWidth = this.opacity = 1;
    this.lineType = 0;
    this.pointerWidth = "10%";
    this.borderColor = "#000000";
    this.fillColor = "#d3d3d3"
};
primitives.callout.Controller = function () {
    this.widgetEventPrefix = "bpcallout";
    this.options = new primitives.callout.Config;
    this.m_shape = this.m_graphics = this.m_panelSize = this.m_placeholder = null
};
primitives.callout.Controller.prototype._create = function () {
    this.element.addClass("ui-widget");
    this._createLayout();
    this._redraw()
};
primitives.callout.Controller.prototype.destroy = function () {
    this._cleanLayout()
};
primitives.callout.Controller.prototype._createLayout = function () {
    this.m_panelSize = new primitives.common.Rect(0, 0, this.element.outerWidth(), this.element.outerHeight());
    this.m_placeholder = jQuery("<div></div>");
    this.m_placeholder.css({
        position: "relative",
        overflow: "hidden",
        top: "0px",
        left: "0px",
        padding: "0px",
        margin: "0px"
    });
    this.m_placeholder.css(this.m_panelSize.getCSS());
    this.m_placeholder.addClass("placeholder");
    this.m_placeholder.addClass(this.widgetEventPrefix);
    this.element.append(this.m_placeholder);
    this.m_graphics = primitives.common.createGraphics(this.options.graphicsType, this);
    this.options.actualGraphicsType = this.m_graphics.graphicsType;
    this.m_shape = new primitives.common.Callout(this.m_graphics)
};
primitives.callout.Controller.prototype._cleanLayout = function () {
    null !== this.m_graphics && this.m_graphics.clean();
    this.m_graphics = null;
    this.element.find("." + this.widgetEventPrefix).remove()
};
primitives.callout.Controller.prototype._updateLayout = function () {
    this.m_panelSize = new primitives.common.Rect(0, 0, this.element.innerWidth(), this.element.innerHeight());
    this.m_placeholder.css(this.m_panelSize.getCSS())
};
primitives.callout.Controller.prototype.update = function (a) {
    a ? (this._cleanLayout(), this._createLayout(), this._redraw()) : (this._updateLayout(), this.m_graphics.resize("placeholder", this.m_panelSize.width, this.m_panelSize.height), this.m_graphics.begin(), this._redraw(), this.m_graphics.end())
};
primitives.callout.Controller.prototype._redraw = function () {
    var a = "pointerPlacement cornerRadius offset opacity lineWidth lineType pointerWidth borderColor fillColor".split(" "), b, c;
    this.m_graphics.activate("placeholder");
    for (b = 0; b < a.length; b += 1)c = a[b], this.m_shape[c] = this.options[c];
    this.m_shape.draw(this.options.snapPoint, this.options.position)
};
primitives.callout.Controller.prototype._setOption = function (a, b) {
    jQuery.Widget.prototype._setOption.apply(this, arguments);
    switch (a) {
        case "disabled":
            var c = jQuery([]);
            b ? (c.filter(".ui-state-focus").blur(), c.removeClass("ui-state-hover"), c.propAttr("disabled", !0), this.element.addClass("ui-disabled")) : (c.propAttr("disabled", !1), this.element.removeClass("ui-disabled"))
    }
};
(function (a) {
    a.widget("ui.bpCallout", new primitives.callout.Controller)
})(jQuery);
primitives.connector.Config = function () {
    this.classPrefix = "bpconnector";
    this.graphicsType = 1;
    this.actualGraphicsType = null;
    this.connectorShapeType = this.orientationType = 0;
    this.toRectangle = this.fromRectangle = null;
    this.offset = new primitives.common.Thickness(0, 0, 0, 0);
    this.lineWidth = 3;
    this.color = "#000000";
    this.lineType = 0;
    this.label = null;
    this.labelSize = new primitives.common.Size(60, 30);
    this.labelPlacementType = primitives.common.ConnectorLabelPlacementType.Between
};
primitives.connector.Controller = function () {
    this.widgetEventPrefix = "bpconnector";
    this.options = new primitives.connector.Config;
    this._labelTemplateHashCode = this._labelTemplate = this.m_shape = this.m_graphics = this.m_panelSize = this.m_placeholder = null
};
primitives.connector.Controller.prototype._create = function () {
    var a = this;
    this.element.addClass("ui-widget");
    this._createLabelTemplate();
    this._createLayout();
    this.options.onAnnotationLabelTemplateRender = function (b, c) {
        a._onAnnotationLabelTemplateRender(b, c)
    };
    this._redraw()
};
primitives.connector.Controller.prototype.destroy = function () {
    this._cleanLayout();
    this.options.onLabelTemplateRender = null
};
primitives.connector.Controller.prototype._createLayout = function () {
    this.m_panelSize = new primitives.common.Rect(0, 0, this.element.outerWidth(), this.element.outerHeight());
    this.m_placeholder = jQuery("<div></div>");
    this.m_placeholder.css({
        position: "relative",
        overflow: "hidden",
        top: "0px",
        left: "0px",
        padding: "0px",
        margin: "0px"
    });
    this.m_placeholder.css(this.m_panelSize.getCSS());
    this.m_placeholder.addClass("placeholder");
    this.m_placeholder.addClass(this.widgetEventPrefix);
    this.element.append(this.m_placeholder);
    this.m_graphics = primitives.common.createGraphics(this.options.graphicsType, this);
    this.options.actualGraphicsType = this.m_graphics.graphicsType;
    this.m_shape = new primitives.common.Connector(this.m_graphics)
};
primitives.connector.Controller.prototype._cleanLayout = function () {
    null !== this.m_graphics && this.m_graphics.clean();
    this.m_graphics = null;
    this.element.find("." + this.widgetEventPrefix).remove()
};
primitives.connector.Controller.prototype._updateLayout = function () {
    this.m_panelSize = new primitives.common.Rect(0, 0, this.element.innerWidth(), this.element.innerHeight());
    this.m_placeholder.css(this.m_panelSize.getCSS())
};
primitives.connector.Controller.prototype.update = function (a) {
    a ? (this._cleanLayout(), this._createLayout(), this._redraw()) : (this._updateLayout(), this.m_graphics.resize("placeholder", this.m_panelSize.width, this.m_panelSize.height), this.m_graphics.begin(), this._redraw(), this.m_graphics.end())
};
primitives.connector.Controller.prototype._createLabelTemplate = function () {
    var a = jQuery("<div></div>");
    a.addClass("bp-item bp-corner-all bp-connector-label");
    this._labelTemplate = a.wrap("<div>").parent().html();
    this._labelTemplateHashCode = primitives.common.hashCode(this._labelTemplate)
};
primitives.connector.Controller.prototype._onAnnotationLabelTemplateRender = function (a, b) {
    b.element.html(this.options.label)
};
primitives.connector.Controller.prototype._redraw = function () {
    var a = "orientationType connectorShapeType offset lineWidth color lineType labelSize".split(" "), b, c;
    this.m_graphics.activate("placeholder");
    for (b = 0; b < a.length; b += 1)c = a[b], null != this.options[c] && (this.m_shape[c] = this.options[c]);
    this.m_shape.hasLabel = !primitives.common.isNullOrEmpty(this.options.label);
    this.m_shape.labelPlacementType = this.options.labelPlacementType;
    this.m_shape.labelTemplate = this._labelTemplate;
    this.m_shape.labelTemplateHashCode =
        this._labelTemplateHashCode;
    this.m_shape.panelSize = new primitives.common.Size(this.m_panelSize.width, this.m_panelSize.height);
    this.m_shape.draw(this.options.fromRectangle, this.options.toRectangle)
};
primitives.connector.Controller.prototype._setOption = function (a, b) {
    jQuery.Widget.prototype._setOption.apply(this, arguments);
    switch (a) {
        case "disabled":
            var c = jQuery([]);
            b ? (c.filter(".ui-state-focus").blur(), c.removeClass("ui-state-hover"), c.propAttr("disabled", !0), this.element.addClass("ui-disabled")) : (c.propAttr("disabled", !1), this.element.removeClass("ui-disabled"))
    }
};
(function (a) {
    a.widget("ui.bpConnector", new primitives.connector.Controller)
})(jQuery);
primitives.famdiagram.EventArgs = function () {
    this.context = this.oldContext = null;
    this.parentItems = [];
    this.name = this.position = null;
    this.cancel = !1
};
primitives.famdiagram.TemplateConfig = function () {
    this.name = null;
    this.isActive = !0;
    this.itemSize = new primitives.common.Size(120, 100);
    this.itemBorderWidth = 1;
    this.itemTemplate = null;
    this.minimizedItemSize = new primitives.common.Size(4, 4);
    this.minimizedItemCornerRadius = null;
    this.highlightPadding = new primitives.common.Thickness(2, 2, 2, 2);
    this.highlightBorderWidth = 1;
    this.highlightTemplate = null;
    this.cursorPadding = new primitives.common.Thickness(3, 3, 3, 3);
    this.cursorBorderWidth = 2;
    this.buttons = this.cursorTemplate =
        null
};
primitives.famdiagram.ButtonConfig = function (a, b, c) {
    this.name = a;
    this.icon = b;
    this.text = !1;
    this.label = null;
    this.tooltip = c;
    this.size = new primitives.common.Size(16, 16)
};
primitives.famdiagram.Config = function (a) {
    this.name = void 0 !== a ? a : "FamDiagram";
    this.classPrefix = "famdiagram";
    this.graphicsType = 0;
    this.actualGraphicsType = null;
    this.pageFitMode = 3;
    this.minimalVisibility = 2;
    this.orientationType = 0;
    this.groupByType = this.verticalAlignment = 1;
    this.elbowType = 3;
    this.emptyDiagramMessage = "Diagram is empty.";
    this.items = [];
    this.annotations = [];
    this.highligtItem = this.cursorItem = null;
    this.selectedItems = [];
    this.hasSelectorCheckbox = 0;
    this.selectCheckBoxLabel = "Selected";
    this.selectionPathMode =
        1;
    this.templates = [];
    this.defaulLabelAnnotationTemplate = this.defaultTemplateName = null;
    this.hasButtons = 0;
    this.buttons = [];
    this.onCursorRender = this.onHighlightRender = this.onItemRender = this.onMouseClick = this.onButtonClick = this.onSelectionChanged = this.onSelectionChanging = this.onCursorChanged = this.onCursorChanging = this.onHighlightChanged = this.onHighlightChanging = null;
    this.dotLevelShift = this.normalLevelShift = 20;
    this.normalItemsInterval = this.lineLevelShift = 10;
    this.dotItemsInterval = 1;
    this.lineItemsInterval =
        2;
    this.cousinsIntervalMultiplier = 5;
    this.itemTitleFirstFontColor = "#ffffff";
    this.itemTitleSecondFontColor = "#000080";
    this.linesColor = "#c0c0c0";
    this.linesWidth = 1;
    this.linesType = 0;
    this.linesPalette = [];
    this.showCallout = !0;
    this.defaultCalloutTemplateName = null;
    this.calloutfillColor = "#000000";
    this.calloutBorderColor = null;
    this.calloutCornerRadius = this.calloutOffset = 4;
    this.calloutPointerWidth = "10%";
    this.calloutLineWidth = 1;
    this.calloutOpacity = 0.2;
    this.buttonsPanelSize = 28;
    this.checkBoxPanelSize = this.groupTitlePanelSize =
        24;
    this.distance = 3;
    this.minimumScale = 0.5;
    this.maximumScale = 1;
    this.showLabels = 0;
    this.labelSize = new primitives.common.Size(80, 24);
    this.labelOffset = 1;
    this.labelOrientation = 0;
    this.labelPlacement = 1;
    this.labelFontSize = "10px";
    this.labelFontFamily = "Arial";
    this.labelColor = "#000000";
    this.labelFontStyle = this.labelFontWeight = "normal";
    this.enablePanning = !0;
    this.printPreviewPageSize = new primitives.common.Size(612, 792)
};
primitives.famdiagram.ConnectorAnnotationConfig = function (a, b) {
    var c;
    this.annotationType = 0;
    this.zOrderType = 2;
    this.toItem = this.fromItem = null;
    this.connectorShapeType = 0;
    this.labelPlacementType = primitives.common.ConnectorLabelPlacementType.Between;
    this.offset = new primitives.common.Thickness(0, 0, 0, 0);
    this.lineWidth = 2;
    this.color = "#000000";
    this.lineType = 0;
    this.selectItems = !0;
    this.label = null;
    this.labelSize = new primitives.common.Size(60, 30);
    switch (arguments.length) {
        case 1:
            for (c in a)a.hasOwnProperty(c) && (this[c] =
                a[c]);
            break;
        case 2:
            this.fromItem = a, this.toItem = b
    }
};
primitives.famdiagram.HighlightPathAnnotationConfig = function (a) {
    var b;
    this.annotationType = 2;
    this.items = [];
    this.selectItems = !1;
    switch (arguments.length) {
        case 1:
            if (null !== a)if (a instanceof Array)this.items = a; else if ("object" == typeof a)for (b in a)a.hasOwnProperty(b) && (this[b] = a[b])
    }
};
primitives.famdiagram.ItemConfig = function (a, b, c, d, e) {
    var f;
    this.id = null;
    this.parents = [];
    this.context = this.image = this.description = this.title = null;
    this.itemTitleColor = "#4169e1";
    this.groupTitle = null;
    this.groupTitleColor = "#4169e1";
    this.isActive = this.isVisible = !0;
    this.hasButtons = this.hasSelectorCheckbox = 0;
    this.templateName = null;
    this.showCallout = 0;
    this.label = this.calloutTemplateName = null;
    this.showLabel = 0;
    this.labelSize = null;
    this.labelOrientation = 3;
    this.labelPlacement = 0;
    switch (arguments.length) {
        case 1:
            for (f in a)a.hasOwnProperty(f) &&
            (this[f] = a[f]);
            break;
        case 5:
            this.id = a, this.parent = b, this.title = c, this.description = d, this.image = e
    }
};
primitives.famdiagram.LabelAnnotationConfig = function (a, b) {
    var c;
    this.annotationType = 3;
    this.fromItem = null;
    this.toItems = [];
    this.title = null;
    this.itemTitleColor = "#4169e1";
    this.templateName = null;
    switch (arguments.length) {
        case 1:
            for (c in a)a.hasOwnProperty(c) && (this[c] = a[c]);
            break;
        case 2:
            this.fromItem = a, this.toItem = b
    }
};
primitives.famdiagram.PaletteItemConfig = function (a, b, c) {
    var d;
    this.lineColor = "#c0c0c0";
    this.lineWidth = 1;
    this.lineType = 0;
    switch (arguments.length) {
        case 1:
            for (d in a)a.hasOwnProperty(d) && (this[d] = a[d]);
            break;
        case 3:
            this.lineColor = a, this.lineWidth = b, this.lineType = c
    }
};
primitives.famdiagram.ShapeAnnotationConfig = function (a) {
    var b;
    this.annotationType = 1;
    this.zOrderType = 0;
    this.items = [];
    this.shapeType = 0;
    this.offset = new primitives.common.Thickness(0, 0, 0, 0);
    this.lineWidth = 2;
    this.cornerRadius = "10%";
    this.opacity = 1;
    this.fillColor = this.borderColor = null;
    this.lineType = 0;
    this.selectItems = !1;
    this.label = null;
    this.labelSize = new primitives.common.Size(60, 30);
    this.labelPlacement = 0;
    this.labelOffset = 4;
    switch (arguments.length) {
        case 1:
            if (null !== a)if (a instanceof Array)this.items = a; else if ("object" == typeof a)for (b in a)a.hasOwnProperty(b) && (this[b] = a[b])
    }
};
primitives.famdiagram.Controller = function () {
    this.widgetEventPrefix = "famdiagram";
    this.parent = primitives.orgdiagram.BaseController.prototype;
    this.parent.constructor.apply(this, arguments);
    this.options = new primitives.famdiagram.Config;
    this.options.childrenPlacementType = 2;
    this.options.leavesPlacementType = 2;
    this.options.horizontalAlignment = 0;
    this.options.connectorType = 0;
    this.options.maximumColumnsInMatrix = 6;
    this.options.highlightLinesColor = "#ff0000";
    this.options.highlightLinesWidth = 1;
    this.options.highlightLinesType =
        0;
    this._defaultLabelAnnotationTemplateName = null
};
primitives.famdiagram.Controller.prototype = new primitives.orgdiagram.BaseController;
primitives.famdiagram.Controller.prototype._virtualBind = function () {
    var a = this;
    this.parent._virtualBind.apply(this, arguments);
    this.options.onLabelAnnotationTemplateRender = function (b, c) {
        a._onDefaulLabelAnnotationTemplateRender(b, c)
    }
};
primitives.famdiagram.Controller.prototype._virtualUnbind = function () {
    this.parent._virtualUnbind.apply(this, arguments);
    this.options.onLabelAnnotationTemplateRender = null
};
primitives.famdiagram.Controller.prototype._virtualGetEventArgs = function (a, b, c) {
    var d = new primitives.famdiagram.EventArgs, e, f;
    null != a && (a.itemConfig && null != a.itemConfig.id) && (d.oldContext = this._treeItemConfigs[a.itemConfig.id]);
    if (null != b && b.itemConfig && null != b.itemConfig.id) {
        d.context = this._treeItemConfigs[b.itemConfig.id];
        if (null != b.itemConfig.parents) {
            a = 0;
            for (e = b.itemConfig.parents.length; a < e; a += 1)f = this._treeItemConfigs[b.itemConfig.parents[a]], null != f && d.parentItems.push(f)
        }
        e = this.m_placeholder.offset();
        a = this.element.offset();
        d.position = (new primitives.common.Rect(b.actualPosition)).translate(e.left, e.top).translate(-a.left, -a.top)
    }
    null != c && (d.name = c);
    return d
};
primitives.famdiagram.Controller.prototype._virtualReadTemplates = function () {
    var a = new primitives.orgdiagram.TemplateConfig;
    this.parent._virtualReadTemplates.apply(this, arguments);
    a = new primitives.orgdiagram.Template({
        name: this.widgetEventPrefix + "DefaultLabelAnnotationTemplate",
        itemTemplate: this._getDefaultLabelAnnotationTemplate(),
        itemSize: new primitives.common.Size(100, 20)
    }, a);
    a.itemTemplateRenderName = "onLabelAnnotationTemplateRender";
    a.createDefaultTemplates();
    this._templates[a.name] = a
};
primitives.famdiagram.Controller.prototype._onDefaulLabelAnnotationTemplateRender = function (a, b) {
    b.element.text(b.context.title)
};
primitives.famdiagram.Controller.prototype._getDefaultLabelAnnotationTemplate = function () {
    var a = jQuery('<div class="bp-label-annotation"></div>');
    a.addClass("bp-item");
    return a.wrap("<div>").parent().html()
};
primitives.famdiagram.Controller.prototype._virtualCreateOrgTree = function () {
    var a, b, c, d, e, f, g, h = {}, j, i;
    g = [];
    var k, l, m, n, p = this, q;
    this._defaultLabelAnnotationTemplateName = this.widgetEventPrefix + "DefaultLabelAnnotationTemplate";
    primitives.common.isNullOrEmpty(this.options.defaulLabelAnnotationTemplate) || (this._defaultLabelAnnotationTemplateName = this.options.defaulLabelAnnotationTemplate);
    this.showElbowDots = this.showInvisibleSubTrees = !0;
    this._treeItemConfigs = {};
    this._famItems = {};
    this._famItemsNonExtracted =
    {};
    this.itemByChildrenKey = {};
    this._orgPartners = {};
    this._families = [];
    this._orgItems = {};
    this._orgItemChildren = {};
    this._orgItemRoot = null;
    this.maximumFamItemId = 0;
    this.maximumLevel = this.minimumLevel = null;
    if (0 < this.options.items.length) {
        a = 0;
        for (b = this.options.items.length; a < b; a += 1)i = this.options.items[a], null != i && (this._treeItemConfigs[i.id] = i, g = new primitives.famdiagram.FamilyItem({
            id: i.id,
            itemConfig: i,
            isActive: i.hasOwnProperty("isActive") ? i.isActive : !0
        }), this._famItems[g.id] = g, g = parseInt(i.id, 10), this.maximumFamItemId =
            Math.max(isNaN(g) ? 0 : g, this.maximumFamItemId));
        i = {};
        f = {};
        for (e in this._famItems)if (this._famItems.hasOwnProperty(e) && (g = this._famItems[e], n = {}, m = g.itemConfig.parents, null != m)) {
            a = 0;
            for (b = m.length; a < b; a += 1)k = m[a], this._famItems.hasOwnProperty(k) && (k != g.id && !n.hasOwnProperty(k)) && (n[k] = !0, l = this._famItems[k], l.children.push(g.id), l.logicalChildren.push(g.id), g.logicalParents.push(k), g.parents.push(k), i.hasOwnProperty(k) || (i[k] = {}), i[k][e] = k, f.hasOwnProperty(e) || (f[e] = {}), f[e][k] = e)
        }
        this._sortItemsBylevelsTopo(this._famItems);
        for (c in this._famItems)this._famItems.hasOwnProperty(c) && (g = this._famItems[c], g.logicalChildren.sort(function (a, b) {
            return p._famItems[a].level - p._famItems[b].level
        }), g.logicalParents.sort(function (a, b) {
            return p._famItems[b].level - p._famItems[a].level
        }));
        for (c in this._famItems)this._famItems.hasOwnProperty(c) && (this._famItems[c].level = null);
        this._sortItemsBylevelsSmart(this._famItems);
        if (0 < this.options.annotations.length) {
            for (c in this._famItems)this._famItems.hasOwnProperty(c) && (g = this._famItems[c],
                g.logicalChildren.length = 0, g.logicalParents.length = 0, g.children.length = 0, g.parents.length = 0);
            g = {};
            a = 0;
            for (b = this.options.annotations.length; a < b; a += 1)q = this.options.annotations[a], 3 == q.annotationType && (g.hasOwnProperty(q.fromItem) ? g[q.fromItem].push(q) : g[q.fromItem] = [q]);
            for (j in g)if (g.hasOwnProperty(j)) {
                b = g[j];
                b.sort(function (a, b) {
                    return b.toItems.length - a.toItems.length
                });
                for (a = 0; a < b.length; a += 1)q = b[a], this._addLabelAnnotation(i, q.fromItem, q.toItems, function () {
                    var a = null;
                    p.maximumFamItemId += 1;
                    a =
                        new primitives.famdiagram.FamilyItem({
                            id: p.maximumFamItemId,
                            isVisible: !0,
                            isActive: !1,
                            itemConfig: q,
                            levelGravity: 1
                        });
                    p._famItems[a.id] = a;
                    return a.id
                }), this._addLabelAnnotation(f, q.fromItem, q.toItems, function () {
                    var a = null;
                    p.maximumFamItemId += 1;
                    a = new primitives.famdiagram.FamilyItem({
                        id: p.maximumFamItemId,
                        isVisible: !0,
                        isActive: !1,
                        itemConfig: q,
                        levelGravity: 2
                    });
                    p._famItems[a.id] = a;
                    return a.id
                })
            }
            for (e in this._famItems)if (this._famItems.hasOwnProperty(e)) {
                g = this._famItems[e];
                j = i[g.id];
                if (null != j)for (d in j)j.hasOwnProperty(d) &&
                (l = g, j[d] != g.id && (l = this._famItems[j[d]]), a = this._famItems[d], f.hasOwnProperty(d) && f[d].hasOwnProperty(g.id) && f[d][g.id] != d && (a = this._famItems[f[d][g.id]]), l.logicalChildren.push(a.id), a.logicalParents.push(l.id), l.children.push(a.id), a.parents.push(l.id));
                m = f[g.id];
                if (null != m)for (k in m)m.hasOwnProperty(k) && (l = this._famItems[k], a = g, m[k] == g.id && !i.hasOwnProperty(k) && (l.logicalChildren.push(a.id), a.logicalParents.push(l.id), l.children.push(a.id), a.parents.push(l.id)))
            }
        }
        a = {};
        for (c in this._famItems)this._famItems.hasOwnProperty(c) &&
        (a[c] = this._famItems[c].logicalChildren.slice(0));
        a = primitives.common.optimizeReferences(a, function () {
            var a;
            p.maximumFamItemId += 1;
            a = new primitives.famdiagram.FamilyItem({
                id: p.maximumFamItemId,
                isVisible: !1,
                isActive: !1,
                levelGravity: 2
            });
            p._famItems[a.id] = a;
            return a.id
        });
        for (c in a)a.hasOwnProperty(c) && (j = a[c], p._famItems[c].logicalChildren = j);
        this._eliminateManyToMany(this._famItems, function () {
            p.maximumFamItemId += 1;
            return new primitives.famdiagram.FamilyItem({
                id: p.maximumFamItemId, isVisible: !1, isActive: !1,
                itemConfig: new primitives.famdiagram.ItemConfig({id: p.maximumFamItemId}), levelGravity: 2
            })
        });
        this._resortItemsBylevels(this._famItems);
        this._fillInItems(this._famItems, function () {
            p.maximumFamItemId += 1;
            return new primitives.famdiagram.FamilyItem({
                id: p.maximumFamItemId,
                levelGravity: 2,
                isVisible: !1,
                isActive: !1
            })
        });
        this._setLogicalParents(this._famItems);
        if (this._debug)for (c in this._famItems)if (this._famItems.hasOwnProperty(c)) {
            g = this._famItems[c];
            j = g.logicalChildren;
            for (a = 0; a < j.length; a += 1) {
                b = j[a];
                b =
                    this._famItems[b];
                if (0 > b.logicalParents.indexOf(c))throw"Family tree is broken. Logical child does not reference logical parent.";
                if (null === b.level || null === g.level || b.level != g.level + 1)throw"Family tree is broken. Children/Parents or levels mismatch!";
            }
        }
        this._famItemsNonExtracted = {};
        for (c in this._famItems)this._famItems.hasOwnProperty(c) && (this._famItemsNonExtracted[c] = this._famItems[c]);
        this.properties = "title description image itemTitleColor groupTitle groupTitleColor isVisible isActive hasSelectorCheckbox hasButtons templateName showCallout calloutTemplateName label showLabel labelSize labelOrientation labelPlacement".split(" ");
        this.defaultItemConfig = new primitives.famdiagram.ItemConfig;
        a = null;
        for (b = 0; null != (a = this._findLargestRoot());)e = new primitives.famdiagram.Family(b), this._extractOrgChart(e, this._famItems[a]), this._families.push(e), b += 1;
        g = [];
        k = {};
        if (0 < this._families.length) {
            a = 0;
            for (b = this._families.length; a < b; a += 1) {
                e = this._families[a];
                c = 0;
                for (d = e.links.length; c < d; c += 1)j = e.links[c], i = this._famItems[j.fromItem].familyId, f = this._famItems[j.toItem].familyId, i != f && (h.hasOwnProperty(i) || (h[i] = {}), h[i].hasOwnProperty(f) ||
                (h[i][f] = 0), h[i][f] += 1, h.hasOwnProperty(f) || (h[f] = {}), h[f].hasOwnProperty(i) || (h[f][i] = 0), h[f][i] += 1), this._families[f].backLinks.push(new primitives.famdiagram.FamLink(j.toItem, j.fromItem))
            }
            for (; g.length < this._families.length;) {
                a = 0;
                for (b = this._families.length; a < b; a += 1)if (e = this._families[a], !k.hasOwnProperty(e.id))if (i = primitives.common.getGraphSpanningTree(h, e.id, function (a, b) {
                        return a - b
                    }), i.hasOwnProperty(e.id)) {
                    this._countNumberOfSubFamilies(e.id, i);
                    g.push(e.id);
                    k[e.id] = !0;
                    j = i[e.id];
                    c = 0;
                    for (d =
                             j.length; c < d; c += 1) {
                        l = this._getFamilyAndItsSubFamilies(j[c], i);
                        e = 0;
                        for (f = l.length; e < f; e += 1)m = l[e], g.push(m), k[m] = !0
                    }
                } else g.push(e.id), k[e.id] = !0
            }
        }
        this.maximumFamItemId += 1;
        this._orgItemRoot = this._createOrgItem(this.maximumFamItemId, null, null, this.minimumLevel - 1, null);
        this._orgItemRoot.hideParentConnection = !0;
        this._orgItemRoot.hideChildrenConnection = !0;
        this._orgItemRoot.title = "internal root";
        this._orgItemRoot.isVisible = !1;
        this._orgItemRoot.isActive = !1;
        d = {};
        a = 0;
        for (b = g.length; a < b; a += 1) {
            e = this._families[g[a]];
            k = {};
            i = this._orgItemRoot;
            f = 0;
            h = e.links.concat(e.backLinks);
            for (c = 0; c < h.length; c += 1)if (j = h[c], l = this._orgItems[j.toItem], j = this._orgItems[j.fromItem], !0 == d[l.familyId]) {
                for (j = e.items[0]; l.level >= j.level;)l = this._orgItems[l.parent];
                k[l.id] = k.hasOwnProperty(l.id) ? k[l.id] + 1 : 1;
                f < k[l.id] && (i = l, f = k[l.id])
            }
            this._attachFamilyToOrgChart(i, e);
            d[e.id] = !0
        }
        a = this._getExtraGravity();
        b = this._getGrandChildren();
        this._balanceChildrenForItem(a, b, this._orgItemRoot)
    }
};
primitives.famdiagram.Controller.prototype._addLabelAnnotation = function (a, b, c, d) {
    var e, f, g, h;
    if (a.hasOwnProperty(b)) {
        b = a[b];
        e = !0;
        f = null;
        for (h = 0; h < c.length; h += 1)if (g = c[h], b.hasOwnProperty(g))if (null == f)f = b[g]; else {
            if (f != b[g]) {
                e = !1;
                break
            }
        } else {
            e = !1;
            break
        }
        if (e) {
            d = d();
            a.hasOwnProperty(f) || (a[f] = {});
            a[f][d] = f;
            for (h = 0; h < c.length; h += 1)g = c[h], b[g] = d
        }
    }
};
primitives.famdiagram.Controller.prototype._getGrandChildren = function () {
    var a, b, c = {}, d, e, f, g = {};
    for (a in this._orgItems)this._orgItems.hasOwnProperty(a) && (b = this._orgItems[a], c.hasOwnProperty(b.level) || (c[b.level] = [], this.minimumLevel = null != this.minimumLevel ? Math.min(this.minimumLevel, b.level) : b.level, this.maximumLevel = null != this.maximumLevel ? Math.max(this.maximumLevel, b.level) : b.level), c[b.level].push(b));
    for (f = this.maximumLevel; f >= this.minimumLevel; f -= 1)if (a = c[f], null != a) {
        d = 0;
        for (e = a.length; d < e; d +=
            1)b = a[d], this._sumGrandChildren(g, b)
    }
    return g
};
primitives.famdiagram.Controller.prototype._sumGrandChildren = function (a, b) {
    var c = b.parent, d, e;
    if (null != c && (a[c] || (a[c] = {}), d = b.level - 1, a[c][d] = a[c][d] ? a[c][d] + 1 : 1, e = b.id, null != a[e]))for (d in a[e])a[e].hasOwnProperty(d) && (a[c][d] = a[c][d] ? a[c][d] + a[e][d] : a[e][d])
};
primitives.famdiagram.Controller.prototype._balanceChildrenForItem = function (a, b, c) {
    var d, e, f, g, h, j, i, k, l, m, n, p = [c], q, r = [], s, t, v, w, u;
    for (c.childIndex = 0; 0 < p.length;) {
        c = 0;
        for (i = p.length; c < i; c += 1)if (q = p[c], d = {}, e = {}, this._orgItemChildren.hasOwnProperty(q.id)) {
            t = this._orgItemChildren[q.id];
            l = null;
            s = [];
            if (0 < t.length) {
                f = 0;
                for (g = t.length; f < g; f += 1) {
                    k = t[f];
                    null == l && (l = k);
                    e[k.id] = {};
                    if (a.hasOwnProperty(k.id))for (w in n = a[k.id], n)if (n.hasOwnProperty(w)) {
                        u = n[w];
                        e[k.id][w] = {};
                        h = 0;
                        for (j = u.length; h < j; h += 1)m = u[h],
                            m = m.commonParent == q.id ? m.toParent : this._orgItems[m.fromParent].childIndex < this._orgItems[m.toParent].childIndex ? "__right__" : "__left__", k.id != m && (d.hasOwnProperty(k.id) || (d[k.id] = {}), d[k.id].hasOwnProperty(m) || (d[k.id][m] = 0), d[k.id][m] += 1, null == e[k.id][w][m] && (e[k.id][w][m] = 0), e[k.id][w][m] += 1)
                    }
                    0 < f && (d.hasOwnProperty(l.id) || (d[l.id] = {}), d[l.id].hasOwnProperty(k.id) || (d[l.id][k.id] = 0), d.hasOwnProperty(k.id) || (d[k.id] = {}), d[k.id].hasOwnProperty(l.id) || (d[k.id][l.id] = 0))
                }
                if (null != l) {
                    f = 0;
                    l = l.id;
                    for (v in d)if (d.hasOwnProperty(v)) {
                        g =
                            d[v];
                        h = 0;
                        for (m in g)g.hasOwnProperty(m) && (h += g[m]);
                        h > f && (l = v, f = h)
                    }
                    d = primitives.common.getGraphGrowthSequence(d, l, function (a) {
                        return a
                    });
                    l = this._balanceItems(d, "__left__", "__right__", e, b);
                    e = 0;
                    for (d = l.length; e < d; e += 1)f = this._orgItems[l[e]], f.childIndex = e, s.push(f)
                }
                if (this._debug && !primitives.common.compareArrays(this._orgItemChildren[q.id], s, function (a) {
                        return a.id
                    }))throw"Balancing of items is broken! Incoming vs. outgoing arrays of items mismatch.";
                this._orgItemChildren[q.id] = s
            }
            r = r.concat(t)
        }
        p = r;
        r = []
    }
};
primitives.famdiagram.Controller.prototype._balanceItems = function (a, b, c, d, e) {
    var f = [], g, h, j, i, k, l, m, n, p, q, r, s, t, v, w, u, x, z, A, y;
    h = new primitives.famdiagram.Slots;
    h.add(new primitives.famdiagram.Slot(b));
    h.add(new primitives.famdiagram.Slot(null));
    h.add(new primitives.famdiagram.Slot(c));
    j = 0;
    h.loop(function (a) {
        j += 1;
        a.position = j
    });
    for (g = 0; g < a.length; g += 1)if (i = a[g], i != b && i != c)for (x in p = n = m = l = k = null, h.loop(function (a) {
        var b, c, f, g;
        if (null == a.itemId) {
            v = e[i];
            t = s = r = q = 0;
            for (b in a.crossings)a.crossings.hasOwnProperty(b) && (v &&
            null != v[b] && (q += a.crossings[b] * v[b]), t += a.crossings[b]);
            for (b in d[i])if (d[i].hasOwnProperty(b))for (c in f = d[i][b], f)f.hasOwnProperty(c) && (g = h.getSlot(c), null != g && (g.position < a.position ? (q += (a.left[b] || 0) - (g.left[b] || 0), s += Math.abs(g.balance + 1)) : (q += (a.right[b] || 0) - (g.right[b] || 0), s += Math.abs(g.balance - 1)), r += Math.abs(g.position - a.position)));
            if (null == l || l > q || l == q && (m > r || m == r && (n > s || n == s && p > t)))l = q, k = a, m = r, n = s, p = t
        }
    }), w = k.clone(), u = k.clone(), u.itemId = i, h.insertBefore(k, w), h.insertBefore(k, u), j = u.position =
        0, h.loop(function (a) {
        var b, c;
        if (a.id != u.id) {
            c = e[i];
            for (b in c)c.hasOwnProperty(b) && (a.left[b] = a.left[b] ? a.left[b] + c[b] : c[b]);
            j += 1;
            a.position = j
        }
    }, u), j = 0, h.backwardLoop(function (a) {
        var b, c;
        if (a.id != u.id) {
            c = e[i];
            for (b in e[i])e[i].hasOwnProperty(b) && (a.right[b] = a.right[b] ? a.right[b] + c[b] : c[b]);
            j -= 1;
            a.position = j
        }
    }, u), d[i])if (d[i].hasOwnProperty(x))for (A in z = d[i][x], z)z.hasOwnProperty(A) && (y = h.getSlot(A), null != y && (0 > y.position ? (y.balance += 1, u.balance -= 1, h.backwardLoop(function (a) {
        if (a.id != u.id)if (a.id !=
            y.id)a.crossings[x] = a.crossings[x] ? a.crossings[x] + z[A] : z[A]; else return !0
    }, u)) : (y.balance -= 1, u.balance += 1, h.loop(function (a) {
        if (a.id != u.id)if (a.id != y.id)a.crossings[x] = a.crossings[x] ? a.crossings[x] + z[A] : z[A]; else return !0
    }, u))));
    h.loop(function (a) {
        a = a.itemId;
        null != a && (a != b && a != c) && f.push(a)
    });
    return f
};
primitives.famdiagram.Controller.prototype._getExtraGravity = function () {
    var a, b, c = {}, d, e, f, g;
    for (a in this._orgPartners)if (this._orgPartners.hasOwnProperty(a)) {
        b = this._orgItems[a];
        f = this._orgPartners[a];
        d = 0;
        for (e = f.length; d < e; d += 1)g = this._orgItems[f[d]], this._addExtraGravitiesForConnection(c, g, b)
    }
    return c
};
primitives.famdiagram.Controller.prototype._addExtraGravitiesForConnection = function (a, b, c) {
    var d = new primitives.famdiagram.ExtraGravity(b.level), e = new primitives.famdiagram.ExtraGravity(c.level);
    this._addExtraGravityForItem(a, b.id, d);
    for (this._addExtraGravityForItem(a, c.id, e); b.parent != c.parent;) {
        if (this._debug && (null == b.parent || null == c.parent))throw"No common root found. Most likely items belong to different levels!";
        b = this._orgItems[b.parent];
        c = this._orgItems[c.parent];
        this._addExtraGravityForItem(a,
            b.id, d);
        this._addExtraGravityForItem(a, c.id, e)
    }
    d.commonParent = b.parent;
    d.fromParent = b.id;
    d.toParent = c.id;
    e.commonParent = b.parent;
    e.fromParent = c.id;
    e.toParent = b.id
};
primitives.famdiagram.Controller.prototype._addExtraGravityForItem = function (a, b, c) {
    a.hasOwnProperty(b) || (a[b] = {});
    null == a[b][c.level] && (a[b][c.level] = []);
    a[b][c.level].push(c)
};
primitives.famdiagram.Controller.prototype._getFamilyAndItsSubFamilies = function (a, b) {
    var c = [a], d = b[a], e, f, g;
    if (null != d) {
        e = 0;
        for (f = d.length; e < f; e += 1)g = d[e], c = c.concat(this._getFamilyAndItsSubFamilies(g, b))
    }
    return c
};
primitives.famdiagram.Controller.prototype._countNumberOfSubFamilies = function (a, b) {
    var c = this._families[a], d, e, f, g = {}, h;
    c.familyPriority = 1;
    f = b[a];
    if (null != f) {
        d = 0;
        for (e = f.length; d < e; d += 1)h = f[d], g[h] = this._countNumberOfSubFamilies(h, b), c.familyPriority += g[h];
        f.sort(function (a, b) {
            return g[a] - g[b]
        })
    }
    return c.familyPriority
};
primitives.famdiagram.Controller.prototype._attachFamilyToOrgChart = function (a, b) {
    var c, d = b.items[0], e = null, e = a;
    for (c = a.level + 1; c < d.level; c += 1)this.maximumFamItemId += 1, e = this._createOrgItem(this.maximumFamItemId, e.id, null, c, null), e.title = "shift", e.isVisible = !1, e.isActive = !1, e.hideParentConnection = !0, e.hideChildrenConnection = !0, b.items.push(e);
    d.parent = e.id;
    d.hideParentConnection = !0;
    this._adoptOrgItem(d)
};
primitives.famdiagram.Controller.prototype._extractOrgChart = function (a, b) {
    var c, d, e = [], f, g;
    c = this._createOrgItem(b.id, null, a.id, b.level, b.itemConfig);
    c.hideParentConnection = !0;
    c.isVisible = b.isVisible;
    c.isActive = b.isActive;
    a.items.push(c);
    delete this._famItemsNonExtracted[b.id];
    b.familyId = a.id;
    for (e = this._extractChildren(a, b); 0 < e.length;) {
        f = [];
        c = 0;
        for (d = e.length; c < d; c += 1)g = e[c], f = f.concat(this._extractChildren(a, g));
        e = f
    }
};
primitives.famdiagram.Controller.prototype._extractChildren = function (a, b) {
    var c = [], d, e, f, g = {}, h;
    d = b.logicalChildren.slice(0).sort().toString();
    e = null;
    if (null != this.itemByChildrenKey[d]) {
        e = this.itemByChildrenKey[d];
        null == this._orgPartners[e.id] && (this._orgPartners[e.id] = []);
        this._orgPartners[e.id].push(b.id);
        d = 0;
        for (e = b.logicalChildren.length; d < e; d += 1)f = b.logicalChildren[d], a.links.push(new primitives.famdiagram.FamLink(b.id, f))
    } else {
        "" != d && (this.itemByChildrenKey[d] = b);
        d = 0;
        for (e = b.logicalChildren.length; d <
        e; d += 1)f = b.logicalChildren[d], f = this._famItems[f], h = f.logicalChildren.slice(0).sort(), h = h.toString(), null != g[h] ? (h = this._createOrgItem(f.id, g[h].id, a.id, f.level, f.itemConfig), h.isVisible = f.isVisible, h.isActive = f.isActive, h.itemType = 6, a.items.push(h)) : ("" != h && (g[h] = f), h = this._createOrgItem(f.id, b.id, a.id, f.level, f.itemConfig), h.isVisible = f.isVisible, h.isActive = f.isActive, a.items.push(h), c.push(f)), delete this._famItemsNonExtracted[f.id], f.familyId = a.id
    }
    return c
};
primitives.famdiagram.Controller.prototype._createOrgItem = function (a, b, c, d, e) {
    var f = new primitives.orgdiagram.OrgItem;
    f.id = a;
    f.parent = b;
    f.context = e;
    f.familyId = c;
    f.level = d;
    a = 0;
    for (b = this.properties.length; a < b; a += 1)c = this.properties[a], f[c] = null != e && void 0 !== e[c] ? e[c] : this.defaultItemConfig[c];
    null != e && 3 == e.annotationType && (f.templateName = !primitives.common.isNullOrEmpty(e.templateName) ? e.templateName : this._defaultLabelAnnotationTemplateName, f.hasSelectorCheckbox = 2);
    this._adoptOrgItem(f);
    return f
};
primitives.famdiagram.Controller.prototype._adoptOrgItem = function (a) {
    var b;
    this._orgItems[a.id] = a;
    null != a.parent && (this._orgItemChildren.hasOwnProperty(a.parent) ? (b = this._orgItemChildren[a.parent], b.push(a)) : this._orgItemChildren[a.parent] = [a])
};
primitives.famdiagram.Controller.prototype._findLargestRoot = function () {
    var a = null, b, c, d = {}, e, f, g, h, j, i, k = {}, l, m, n;
    for (c in this._famItemsNonExtracted)this._famItemsNonExtracted.hasOwnProperty(c) && (b = this._famItemsNonExtracted[c], d.hasOwnProperty(b.level) || (d[b.level] = [], this.minimumLevel = null != this.minimumLevel ? Math.min(this.minimumLevel, b.level) : b.level, this.maximumLevel = null != this.maximumLevel ? Math.max(this.maximumLevel, b.level) : b.level), d[b.level].push(b));
    for (h = this.maximumLevel; h >= this.minimumLevel; h -=
        1)if (e = d[h], null != e) {
        f = 0;
        for (g = e.length; f < g; f += 1) {
            b = e[f];
            k.hasOwnProperty(b.id) || (k[b.id] = {});
            k[b.id][b.id] = !0;
            j = 0;
            for (i = b.logicalParents.length; j < i; j += 1)if (n = b.logicalParents[j], this._famItemsNonExtracted.hasOwnProperty(n) && (k.hasOwnProperty(n) || (k[n] = {}), k[n][b.id] = !0, k.hasOwnProperty(b.id)))for (c in l = k[b.id], l)l.hasOwnProperty(c) && (k[n][c] = !0)
        }
    }
    b = 0;
    for (c in k)if (k.hasOwnProperty(c)) {
        l = k[c];
        d = 0;
        for (m in l)l.hasOwnProperty(m) && (d += 1);
        d > b && (b = d, a = c)
    }
    return a
};
primitives.famdiagram.Controller.prototype._sortItemsBylevelsSmart = function (a) {
    var b = {}, c, d;
    for (c in a)a.hasOwnProperty(c) && (d = a[c], null == d.level && (d.level = 0, this._sortItemBylevels(d, a, b)))
};
primitives.famdiagram.Controller.prototype._sortItemBylevels = function (a, b, c) {
    for (var d, e, f, g, h, j = this._getParentEdges(a, c), i = this._getChildrenEdges(a, c); 0 < j.length || 0 < i.length;) {
        g = [];
        h = [];
        a = 0;
        for (d = i.length; a < d; a += 1)e = b[i[a].parent], f = b[i[a].child], null == f.level ? (f.level = this._getMaximumLevel(f.logicalParents, b) + 1, g = g.concat(this._getParentEdges(f, c)), h = h.concat(this._getChildrenEdges(f, c))) : f.level <= e.level && this._shiftChartItem(f, e.level - f.level + 1, b);
        a = 0;
        for (d = j.length; a < d; a += 1)e = b[j[a].parent],
            f = b[j[a].child], null == e.level ? (e.level = this._getMinimumLevel(e.logicalChildren, b) - 1, g = g.concat(this._getParentEdges(e, c)), h = h.concat(this._getChildrenEdges(e, c))) : f.level <= e.level && this._shiftChartItem(f, e.level - f.level + 1, b);
        j = g;
        i = h
    }
};
primitives.famdiagram.Controller.prototype._getParentEdges = function (a, b) {
    var c, d, e, f = [], g;
    c = 0;
    for (d = a.logicalParents.length; c < d; c += 1)e = a.logicalParents[c], g = e + "," + a.id, b.hasOwnProperty(g) || (f.push(new primitives.famdiagram.EdgeItem(e, a.id)), b[g] = !0);
    return f
};
primitives.famdiagram.Controller.prototype._getChildrenEdges = function (a, b) {
    var c, d, e, f = [], g;
    c = 0;
    for (d = a.logicalChildren.length; c < d; c += 1)e = a.logicalChildren[c], g = a.id + "," + e, b.hasOwnProperty(g) || f.push(new primitives.famdiagram.EdgeItem(a.id, e));
    return f
};
primitives.famdiagram.Controller.prototype._shiftChartItem = function (a, b, c) {
    var d, e;
    a.level += b;
    if (0 < b) {
        b = 0;
        for (d = a.logicalChildren.length; b < d; b += 1)e = c[a.logicalChildren[b]], null != e.level && e.level <= a.level && this._shiftChartItem(e, a.level - e.level + 1, c)
    } else {
        b = 0;
        for (d = a.logicalParents.length; b < d; b += 1)e = c[a.logicalParents[b]], null != e.level && e.level >= a.level && this._shiftChartItem(e, a.level - e.level - 1, c)
    }
};
primitives.famdiagram.Controller.prototype._getMaximumLevel = function (a, b) {
    var c, d, e, f;
    c = 0;
    for (d = a.length; c < d; c += 1)f = b[a[c]], null != f.level && (e = null != e ? Math.max(e, f.level) : f.level);
    return e
};
primitives.famdiagram.Controller.prototype._getMinimumLevel = function (a, b) {
    var c, d, e, f;
    c = 0;
    for (d = a.length; c < d; c += 1)f = b[a[c]], null != f.level && (e = null != e ? Math.min(e, f.level) : f.level);
    return e
};
primitives.famdiagram.Controller.prototype._sortItemsBylevelsTopo = function (a) {
    var b = {}, c, d, e, f, g, h;
    for (c in a)a.hasOwnProperty(c) && (e = a[c], b[c] = e.logicalChildren);
    b = primitives.common.topologicalSort(b);
    c = 0;
    for (d = b.length; c < d; c += 1) {
        e = b[c];
        e = a[e];
        null == e.level && (e.level = 0);
        f = 0;
        for (g = e.logicalChildren.length; f < g; f += 1)h = e.logicalChildren[f], h = a[h], h.level = null == h.level ? e.level + 1 : Math.max(h.level, e.level + 1)
    }
    for (c = b.length - 1; 0 <= c; c -= 1) {
        e = b[c];
        e = a[e];
        d = null;
        f = 0;
        for (g = e.logicalChildren.length; f < g; f += 1)h =
            e.logicalChildren[f], h = a[h], d = null == d ? h.level - 1 : Math.min(h.level - 1, d);
        e.level = !d ? e.level : d
    }
};
primitives.famdiagram.Controller.prototype._resortItemsBylevels = function (a) {
    var b = [], c = null, d = null, e = {}, f, g, h;
    for (f in a)a.hasOwnProperty(f) && (g = a[f], e[f] = g.logicalChildren, g.originalLevel = g.level, g.level = null, null != g.originalLevel && (b[g.originalLevel] || (b[g.originalLevel] = {}), b[g.originalLevel][g.id] = g, c = null != c ? Math.min(g.originalLevel, c) : g.originalLevel, d = null != d ? Math.max(g.originalLevel, d) : g.originalLevel));
    for (g = 0; c <= d; c += 1)f = b[c], g = this._setLevelsForItems(f, a, g, c + 1);
    b = primitives.common.topologicalSort(e);
    for (c = b.length - 1; 0 <= c; c -= 1)if (g = b[c], g = a[g], 2 == g.levelGravity) {
        d = null;
        e = 0;
        for (f = g.logicalChildren.length; e < f; e += 1)h = g.logicalChildren[e], h = a[h], d = null == d ? h.level - 1 : Math.min(h.level - 1, d);
        g.level = !d ? g.level : d
    }
};
primitives.famdiagram.Controller.prototype._setLevelsForItems = function (a, b, c, d) {
    for (var e = c, f, g, h, j, i, k, l; !primitives.common.isEmptyObject(a);) {
        f = {};
        for (g in a)if (a.hasOwnProperty(g)) {
            h = a[g];
            null == h.level && (h.level = c);
            j = 0;
            for (i = h.logicalChildren.length; j < i; j += 1)k = h.logicalChildren[j], l = b[k], null == l.originalLevel ? (l.level = null == l.level ? h.level + 1 : Math.max(l.level, h.level + 1), f[k] = l) : l.originalLevel == d && (e = Math.max(e, h.level + 1))
        }
        a = f
    }
    return e
};
primitives.famdiagram.Controller.prototype._fillInItems = function (a, b) {
    var c = [], d, e, f, g, h, j, i, k;
    for (d in a)if (a.hasOwnProperty(d)) {
        e = a[d];
        for (f = !0; f;) {
            f = !1;
            h = [];
            j = [];
            i = 0;
            for (k = e.logicalChildren.length; i < k; i += 1)g = a[e.logicalChildren[i]], e.level + 1 < g.level ? j.push(g.id) : h.push(g.id);
            0 < j.length && (g = b(), g.level = e.level + 1, g.logicalChildren = j, h.push(g.id), e.logicalChildren = h, f = !0, e = g, c.push(g))
        }
    }
    for (d = 0; d < c.length; d += 1)g = c[d], a[g.id] = g
};
primitives.famdiagram.Controller.prototype._setLogicalParents = function (a) {
    var b, c, d, e, f;
    for (b in this._famItems)this._famItems.hasOwnProperty(b) && (e = this._famItems[b], e.logicalParents = []);
    for (b in a)if (a.hasOwnProperty(b)) {
        e = a[b];
        c = 0;
        for (d = e.logicalChildren.length; c < d; c += 1)f = e.logicalChildren[c], a[f].logicalParents.push(b)
    }
};
primitives.famdiagram.Controller.prototype._eliminateManyToMany = function (a, b) {
    var c = [], d = {}, e, f, g, h, j, i, k;
    for (e in a)if (a.hasOwnProperty(e)) {
        i = a[e];
        f = 0;
        for (g = i.logicalChildren.length; f < g; f += 1)h = i.logicalChildren[f], d.hasOwnProperty(h) || (d[h] = []), d[h].push(e)
    }
    for (e in a)if (a.hasOwnProperty(e) && (i = a[e], 1 < i.logicalChildren.length)) {
        k = [];
        f = 0;
        for (g = i.logicalChildren.length; f < g; f += 1)h = i.logicalChildren[f], 1 < d[h].length ? (j = b(), j.logicalChildren = [h], k.push(j.id), c.push(j)) : k.push(h);
        i.logicalChildren = k
    }
    for (d =
             0; d < c.length; d += 1)j = c[d], a[j.id] = j
};
primitives.famdiagram.Controller.prototype._virtualShowCursorNeighbours = function () {
    var a, b, c, d, e, f, g;
    if (null !== this._cursorTreeItem && (0 === this._cursorTreeItem.visibility && (this._cursorTreeItem.visibility = 1), null != this._cursorTreeItem.itemConfig)) {
        e = this._famItems[this._cursorTreeItem.itemConfig.id];
        f = [];
        for (b = e.children.slice(0); 0 < b.length;) {
            f = f.concat(b);
            d = [];
            for (a = 0; a < b.length; a += 1)c = this._famItems[b[a]], g = this._orgItems[b[a]], g.isActive || (d = d.concat(c.children)), f = f.concat(c.parents);
            b = d
        }
        for (b =
                 e.parents.slice(0); 0 < b.length;) {
            f = f.concat(b);
            d = [];
            for (a = 0; a < b.length; a += 1)c = this._famItems[b[a]], g = this._orgItems[b[a]], g.isActive || (d = d.concat(c.parents)), f = f.concat(c.children);
            b = d
        }
        for (a = 0; a < f.length; a += 1)b = this._treeItemsByUserId[f[a]], 0 === b.visibility && (b.visibility = 1)
    }
};
primitives.famdiagram.EdgeItem = function (a, b) {
    this.child = this.parent = null;
    switch (arguments.length) {
        case 2:
            this.parent = a, this.child = b
    }
};
primitives.famdiagram.EdgeItem.prototype.toString = function () {
    return this.parent + "," + this.child
};
primitives.famdiagram.ExtraGravity = function (a) {
    this.toParent = this.fromParent = this.commonParent = null;
    this.level = a
};
primitives.famdiagram.Family = function (a) {
    this.familyPriority = this.id = null;
    this.items = [];
    this.links = [];
    this.backLinks = [];
    1 == arguments.length && (this.id = a)
};
primitives.famdiagram.FamilyItem = function (a) {
    var b;
    this.itemConfig = this.familyId = this.id = null;
    this.isActive = this.isVisible = !0;
    this.parents = [];
    this.children = [];
    this.logicalChildren = [];
    this.logicalParents = [];
    this.level = null;
    this.levelGravity = 0;
    switch (arguments.length) {
        case 1:
            for (b in a)a.hasOwnProperty(b) && (this[b] = a[b])
    }
};
primitives.famdiagram.FamLink = function (a, b) {
    this.fromItem = a;
    this.toItem = b
};
primitives.famdiagram.Slot = function (a) {
    this.position = this.next = this.prev = this.id = null;
    this.balance = 0;
    this.itemId = a;
    this.left = {};
    this.right = {};
    this.crossings = {}
};
primitives.famdiagram.Slot.prototype.clone = function () {
    var a = new primitives.famdiagram.Slot, b;
    a.itemId = this.itemId;
    for (b in this.left)this.left.hasOwnProperty(b) && (a.left[b] = this.left[b]);
    for (b in this.right)this.right.hasOwnProperty(b) && (a.right[b] = this.right[b]);
    for (b in this.crossings)this.crossings.hasOwnProperty(b) && (a.crossings[b] = this.crossings[b]);
    return a
};
primitives.famdiagram.Slots = function () {
    this.last = this.first = null;
    this.slots = {};
    this.items = {};
    this.counter = 0
};
primitives.famdiagram.Slots.prototype.add = function (a) {
    a.id = this.counter;
    this.counter += 1;
    this.slots[a.id] = a;
    null != a.itemId && (this.items[a.itemId] = a);
    null == this.last ? this.first = this.last = a.id : (this.slots[this.last].next = a.id, a.prev = this.last, this.last = a.id)
};
primitives.famdiagram.Slots.prototype.insertBefore = function (a, b) {
    b.id = this.counter;
    this.counter += 1;
    this.slots[b.id] = b;
    null != b.itemId && (this.items[b.itemId] = b);
    if (null == a.prev)b.next = a.id, this.first = b.id; else {
        var c = this.slots[a.prev];
        c.next = b.id;
        b.next = a.id;
        a.prev = b.id;
        b.prev = c.id
    }
};
primitives.famdiagram.Slots.prototype.loop = function (a, b) {
    for (var c = null != b ? b.id : this.first; null != c;) {
        c = this.slots[c];
        if (a(c))break;
        c = c.next
    }
};
primitives.famdiagram.Slots.prototype.backwardLoop = function (a, b) {
    for (var c = null != b ? b.id : this.last; null != c;) {
        c = this.slots[c];
        if (a(c))break;
        c = c.prev
    }
};
primitives.famdiagram.Slots.prototype.getSlot = function (a) {
    return this.items[a]
};
(function (a) {
    a.widget("ui.famDiagram", jQuery.ui.mouse2, new primitives.famdiagram.Controller)
})(jQuery);
primitives.orgdiagram.EventArgs = function () {
    this.name = this.position = this.parentItem = this.context = this.oldContext = null;
    this.cancel = !1
};
primitives.orgdiagram.TemplateConfig = function () {
    this.name = null;
    this.isActive = !0;
    this.itemSize = new primitives.common.Size(120, 100);
    this.itemBorderWidth = 1;
    this.itemTemplate = null;
    this.minimizedItemSize = new primitives.common.Size(4, 4);
    this.minimizedItemCornerRadius = null;
    this.highlightPadding = new primitives.common.Thickness(2, 2, 2, 2);
    this.highlightBorderWidth = 1;
    this.highlightTemplate = null;
    this.cursorPadding = new primitives.common.Thickness(3, 3, 3, 3);
    this.cursorBorderWidth = 2;
    this.buttons = this.cursorTemplate =
        null
};
primitives.orgdiagram.ButtonConfig = function (a, b, c) {
    this.name = a;
    this.icon = b;
    this.text = !1;
    this.label = null;
    this.tooltip = c;
    this.size = new primitives.common.Size(16, 16)
};
primitives.orgdiagram.Config = function (a) {
    this.name = void 0 !== a ? a : "OrgDiagram";
    this.classPrefix = "orgdiagram";
    this.graphicsType = 0;
    this.actualGraphicsType = null;
    this.pageFitMode = 3;
    this.minimalVisibility = 2;
    this.horizontalAlignment = this.orientationType = 0;
    this.verticalAlignment = 1;
    this.elbowType = this.connectorType = 0;
    this.emptyDiagramMessage = "Diagram is empty.";
    this.items = [];
    this.annotations = [];
    this.highligtItem = this.cursorItem = null;
    this.selectedItems = [];
    this.hasSelectorCheckbox = 0;
    this.selectCheckBoxLabel =
        "Selected";
    this.selectionPathMode = 1;
    this.templates = [];
    this.defaultTemplateName = null;
    this.hasButtons = 0;
    this.buttons = [];
    this.onCursorRender = this.onHighlightRender = this.onItemRender = this.onMouseClick = this.onButtonClick = this.onSelectionChanged = this.onSelectionChanging = this.onCursorChanged = this.onCursorChanging = this.onHighlightChanged = this.onHighlightChanging = null;
    this.dotLevelShift = this.normalLevelShift = 20;
    this.normalItemsInterval = this.lineLevelShift = 10;
    this.dotItemsInterval = 1;
    this.lineItemsInterval =
        2;
    this.cousinsIntervalMultiplier = 5;
    this.itemTitleFirstFontColor = "#ffffff";
    this.itemTitleSecondFontColor = "#000080";
    this.linesColor = "#c0c0c0";
    this.linesWidth = 1;
    this.linesType = 0;
    this.highlightLinesColor = "#ff0000";
    this.highlightLinesWidth = 1;
    this.highlightLinesType = 0;
    this.showCallout = !0;
    this.defaultCalloutTemplateName = null;
    this.calloutfillColor = "#000000";
    this.calloutBorderColor = null;
    this.calloutCornerRadius = this.calloutOffset = 4;
    this.calloutPointerWidth = "10%";
    this.calloutLineWidth = 1;
    this.calloutOpacity =
        0.2;
    this.leavesPlacementType = this.childrenPlacementType = 2;
    this.maximumColumnsInMatrix = 6;
    this.buttonsPanelSize = 28;
    this.checkBoxPanelSize = this.groupTitlePanelSize = 24;
    this.distance = 3;
    this.minimumScale = 0.5;
    this.maximumScale = 1;
    this.showLabels = 0;
    this.labelSize = new primitives.common.Size(80, 24);
    this.labelOffset = 1;
    this.labelOrientation = 0;
    this.labelPlacement = 1;
    this.labelFontSize = "10px";
    this.labelFontFamily = "Arial";
    this.labelColor = "#000000";
    this.labelFontStyle = this.labelFontWeight = "normal";
    this.enablePanning = !0;
    this.printPreviewPageSize = new primitives.common.Size(612, 792)
};
primitives.orgdiagram.ConnectorAnnotationConfig = function (a, b) {
    var c;
    this.annotationType = 0;
    this.zOrderType = 2;
    this.toItem = this.fromItem = null;
    this.connectorShapeType = 0;
    this.labelPlacementType = primitives.common.ConnectorLabelPlacementType.Between;
    this.offset = new primitives.common.Thickness(0, 0, 0, 0);
    this.lineWidth = 2;
    this.color = "#000000";
    this.lineType = 0;
    this.selectItems = !0;
    this.label = null;
    this.labelSize = new primitives.common.Size(60, 30);
    switch (arguments.length) {
        case 1:
            for (c in a)a.hasOwnProperty(c) && (this[c] =
                a[c]);
            break;
        case 2:
            this.fromItem = a, this.toItem = b
    }
};
primitives.orgdiagram.HighlightPathAnnotationConfig = function (a) {
    var b;
    this.annotationType = 2;
    this.items = [];
    this.selectItems = !1;
    switch (arguments.length) {
        case 1:
            if (null !== a)if (a instanceof Array)this.items = a; else if ("object" == typeof a)for (b in a)a.hasOwnProperty(b) && (this[b] = a[b])
    }
};
primitives.orgdiagram.ItemConfig = function (a, b, c, d, e) {
    var f;
    this.context = this.image = this.description = this.title = this.parent = this.id = null;
    this.itemTitleColor = "#4169e1";
    this.groupTitle = null;
    this.groupTitleColor = "#4169e1";
    this.isActive = this.isVisible = !0;
    this.childrenPlacementType = this.adviserPlacementType = this.itemType = this.hasButtons = this.hasSelectorCheckbox = 0;
    this.templateName = null;
    this.showCallout = 0;
    this.label = this.calloutTemplateName = null;
    this.showLabel = 0;
    this.labelSize = null;
    this.labelOrientation =
        3;
    this.labelPlacement = 0;
    switch (arguments.length) {
        case 1:
            for (f in a)a.hasOwnProperty(f) && (this[f] = a[f]);
            break;
        case 5:
            this.id = a, this.parent = b, this.title = c, this.description = d, this.image = e
    }
};
primitives.orgdiagram.ShapeAnnotationConfig = function (a) {
    var b;
    this.annotationType = 1;
    this.zOrderType = 0;
    this.items = [];
    this.shapeType = 0;
    this.offset = new primitives.common.Thickness(0, 0, 0, 0);
    this.lineWidth = 2;
    this.cornerRadius = "10%";
    this.opacity = 1;
    this.fillColor = this.borderColor = null;
    this.lineType = 0;
    this.selectItems = !1;
    this.label = null;
    this.labelSize = new primitives.common.Size(60, 30);
    this.labelPlacement = 0;
    this.labelOffset = 4;
    switch (arguments.length) {
        case 1:
            if (null !== a)if (a instanceof Array)this.items = a; else if ("object" == typeof a)for (b in a)a.hasOwnProperty(b) && (this[b] = a[b])
    }
};
primitives.orgdiagram.Controller = function () {
    this.widgetEventPrefix = "orgdiagram";
    this.parent = primitives.orgdiagram.BaseController.prototype;
    this.parent.constructor.apply(this, arguments);
    this.options = new primitives.orgdiagram.Config;
    this.options.linesPalette = [];
    this.groupByType = 1
};
primitives.orgdiagram.Controller.prototype = new primitives.orgdiagram.BaseController;
primitives.orgdiagram.Controller.prototype._virtualGetEventArgs = function (a, b, c) {
    var d = new primitives.orgdiagram.EventArgs, e;
    null != a && (a.itemConfig && null != a.itemConfig.id) && (d.oldContext = this._treeItemConfigs[a.itemConfig.id]);
    null != b && (b.itemConfig && null != b.itemConfig.id) && (d.context = this._treeItemConfigs[b.itemConfig.id], null !== b.itemConfig.parent && (d.parentItem = this._treeItemConfigs[b.itemConfig.parent]), e = this.m_placeholder.offset(), a = this.element.offset(), d.position = (new primitives.common.Rect(b.actualPosition)).translate(e.left,
        e.top).translate(-a.left, -a.top));
    null != c && (d.name = c);
    return d
};
primitives.orgdiagram.Controller.prototype._virtualCreateOrgTree = function () {
    var a, b, c, d, e, f, g, h, j, i, k;
    this._treeItemConfigs = {};
    this._orgItems = {};
    this._orgItemChildren = {};
    this._orgItemRoot = null;
    if (null != this.options.items && 0 < this.options.items.length) {
        h = "title description image itemTitleColor groupTitle groupTitleColor isVisible isActive hasSelectorCheckbox hasButtons itemType adviserPlacementType childrenPlacementType templateName showCallout calloutTemplateName label showLabel labelSize labelOrientation labelPlacement".split(" ");
        j =
            new primitives.orgdiagram.ItemConfig;
        i = 0;
        k = [];
        c = 0;
        for (d = this.options.items.length; c < d; c += 1)if (b = this.options.items[c], null != b.id) {
            this._treeItemConfigs[b.id] = b;
            a = new primitives.orgdiagram.OrgItem;
            a.id = b.id;
            a.parent = b.parent;
            e = parseInt(b.id, 10);
            i = Math.max(isNaN(e) ? 0 : e, i);
            a.context = b;
            e = 0;
            for (f = h.length; e < f; e += 1)g = h[e], a[g] = void 0 !== b[g] ? b[g] : j[g];
            this._orgItems[a.id] = a;
            this._orgItemChildren.hasOwnProperty(a.parent) ? this._orgItemChildren[a.parent].push(a) : this._orgItemChildren[a.parent] = [a];
            null == a.parent &&
            (k.push(a), a.itemType = 0)
        }
        i += 1;
        this._orgItemRoot = new primitives.orgdiagram.OrgItem;
        this._orgItemRoot.id = i;
        this._orgItemRoot.hideParentConnection = !0;
        this._orgItemRoot.hideChildrenConnection = !0;
        this._orgItemRoot.title = "internal root";
        this._orgItemRoot.isVisible = !1;
        this._orgItems[this._orgItemRoot.id] = this._orgItemRoot;
        this._orgItemChildren[this._orgItemRoot.id] = k;
        this._hideRootConnectors([this._orgItemRoot])
    }
};
primitives.orgdiagram.Controller.prototype._hideRootConnectors = function (a) {
    for (var b, c, d, e, f, g, h, j, i; 0 < a.length;) {
        b = [];
        c = 0;
        for (d = a.length; c < d; c += 1)if (g = a[c], !g.isVisible && this._orgItemChildren.hasOwnProperty(g.id)) {
            h = this._orgItemChildren[g.id];
            i = !0;
            e = 0;
            for (f = h.length; e < f; e += 1)if (j = h[e], 0 != j.itemType) {
                i = !1;
                break
            }
            if (i) {
                g.hideChildrenConnection = !0;
                e = 0;
                for (f = h.length; e < f; e += 1)j = h[e], j.hideParentConnection = !0, j.isVisible || b.push(j)
            }
        }
        a = b
    }
};
primitives.orgdiagram.Controller.prototype._defineLogicalParent = function (a, b) {
    var c = {}, d, e = {}, f = {}, g, h, j;
    if (!a.actualIsActive || 4 == a.visibility) {
        for (j = 0; j < a.logicalParents.length; j += 1)d = a.logicalParents[j], e[d] = !0;
        for (; !primitives.common.isEmptyObject(e);) {
            for (h in e)if (e.hasOwnProperty(h))if (d = this._treeItems[h], !d.actualIsActive || 4 == d.visibility) {
                g = d.logicalParents;
                for (j = 0; j < g.length; j += 1)d = g[j], f[d] = !0
            } else c[d.id] = d;
            e = f;
            f = {}
        }
    }
    primitives.common.isEmptyObject(c) && (c[a.id] = a);
    for (h in c)if (c.hasOwnProperty(h)) {
        d =
            c[h];
        if (this._debug && 0 < primitives.common.indexOf(d.logicalChildren, b, function (a, b) {
                return a.id == b.id
            }))throw"Duplicate value in logical logicalChildren array.";
        d.logicalChildren.push(b);
        if (this._debug && 0 < primitives.common.indexOf(b.logicalParents, d.id))throw"Duplicate value in logical parents array.";
        b.logicalParents.push(h)
    }
};
primitives.orgdiagram.Controller.prototype._virtualShowCursorNeighbours = function () {
    var a, b, c, d, e, f;
    if (null !== this._cursorTreeItem) {
        0 === this._cursorTreeItem.visibility && (this._cursorTreeItem.visibility = 1);
        for (a = 0; a < this._cursorTreeItem.logicalChildren.length; a += 1)e = this._cursorTreeItem.logicalChildren[a], 0 === e.visibility && (e.visibility = 1);
        d = this._getAllLogicalParents(this._cursorTreeItem);
        a = 0;
        for (b = d.length; a < b; a += 1)c = d[a], 0 === c.visibility && (c.visibility = 1);
        a = 0;
        for (b = this._cursorTreeItem.logicalParents.length; a <
        b; a += 1) {
            f = this._treeItems[this._cursorTreeItem.logicalParents[a]];
            c = 0;
            for (d = f.logicalChildren.length; c < d; c += 1)e = f.logicalChildren[c], 0 === e.visibility && (e.visibility = 1)
        }
    }
};
primitives.orgdiagram.Buffer = function (a) {
    var b, c;
    this.polylines = [];
    this.cursor = 0;
    this._highlight = new primitives.orgdiagram.Polyline(a.highlightLinesColor, a.highlightLinesWidth, a.highlightLinesType);
    this._regular = new primitives.orgdiagram.Polyline(a.linesColor, a.linesWidth, a.linesType);
    if (0 == a.linesPalette.length)this.polylines.push(new primitives.orgdiagram.Polyline(a.linesColor, a.linesWidth, a.linesType)); else {
        b = 0;
        for (c = a.linesPalette.length; b < c; b += 1)this.polylines.push(new primitives.orgdiagram.Polyline(a.linesPalette[b]))
    }
};
primitives.orgdiagram.Buffer.prototype.selectPalette = function (a) {
    this.cursor = a % this.polylines.length
};
primitives.orgdiagram.Buffer.prototype.getPolyline = function (a) {
    var b = null;
    switch (a) {
        case 2:
            b = this._highlight;
            break;
        case 1:
            b = this._regular;
            break;
        case 0:
            b = this.polylines[this.cursor]
    }
    return b
};
primitives.orgdiagram.Buffer.prototype.getPolylines = function () {
    var a = this.polylines.slice(0);
    a.push(this._highlight);
    a.push(this._regular);
    return a
};
primitives.orgdiagram.ConnectorPoint = function () {
    this.parent = primitives.common.Point.prototype;
    this.parent.constructor.apply(this, arguments);
    this.hasElbow = !1;
    this.elbowPoint2 = this.elbowPoint1 = null;
    this.isSquared = !0;
    this.highlightPath = 0;
    this.connectorStyleType = 1
};
primitives.orgdiagram.ConnectorPoint.prototype = new primitives.common.Point;
primitives.orgdiagram.LevelVisibility = function (a, b) {
    this.level = a;
    this.currentvisibility = b
};
primitives.orgdiagram.OrgItem = function () {
    this.image = this.description = this.title = this.context = this.parent = this.id = null;
    this.itemTitleColor = "#4169e1";
    this.groupTitle = null;
    this.groupTitleColor = "#4169e1";
    this.isActive = this.isVisible = !0;
    this.childrenPlacementType = this.adviserPlacementType = this.itemType = this.hasButtons = this.hasSelectorCheckbox = 0;
    this.templateName = null;
    this.showCallout = 0;
    this.label = this.calloutTemplateName = null;
    this.showLabel = 0;
    this.labelSize = null;
    this.labelOrientation = 3;
    this.labelPlacement =
        0;
    this.level = null;
    this.hideChildrenConnection = this.hideParentConnection = !1;
    this.childIndex = null
};
primitives.orgdiagram.Polyline = function (a, b, c) {
    var d;
    this.lineColor = "#c0c0c0";
    this.lineWidth = 1;
    this.lineType = 0;
    this.segments = [];
    switch (arguments.length) {
        case 1:
            for (d in a)a.hasOwnProperty(d) && (this[d] = a[d]);
            break;
        case 3:
            this.lineColor = a, this.lineWidth = b, this.lineType = c
    }
};
primitives.orgdiagram.Polyline.prototype.toString = function () {
    return this.lineColor + "." + this.lineWidth + "." + this.lineType
};
primitives.orgdiagram.Template = function (a, b) {
    var c;
    this.widgetEventPrefix = "orgdiagram";
    this.templateConfig = a;
    for (c in b)b.hasOwnProperty(c) && (this[c] = a.hasOwnProperty(c) ? a[c] : b[c]);
    this.minimizedItemCornerRadius = null === a.minimizedItemCornerRadius ? this.minimizedItemSize.width / 2 : a.minimizedItemCornerRadius;
    this.itemTemplateHashCode = this.dotHighlightTemplate = this.dotHighlightTemplateHashCode = null;
    this.itemTemplateRenderName = "onItemRender";
    this.highlightTemplateHashCode = null;
    this.highlightTemplateRenderName =
        "onHighlightRender";
    this.cursorTemplateHashCode = null;
    this.cursorTemplateRenderName = "onCursorRender";
    this.boxModel = jQuery.support.boxModel
};
primitives.orgdiagram.Template.prototype.createDefaultTemplates = function () {
    primitives.common.isNullOrEmpty(this.itemTemplate) && (this.itemTemplate = this._getDefaultItemTemplate(), this.itemTemplateRenderName = "onDefaultTemplateRender");
    this.itemTemplateHashCode = primitives.common.hashCode(this.itemTemplate);
    primitives.common.isNullOrEmpty(this.cursorTemplate) && (this.cursorTemplate = this._getDefaultCursorTemplate(), this.cursorTemplateRenderName = null);
    this.cursorTemplateHashCode = primitives.common.hashCode(this.cursorTemplate);
    primitives.common.isNullOrEmpty(this.highlightTemplate) && (this.highlightTemplate = this._getDefaultHighlightTemplate(), this.highlightTemplateRenderName = null);
    this.highlightTemplateHashCode = primitives.common.hashCode(this.highlightTemplate);
    this.dotHighlightTemplate = this._getDotHighlightTemplate();
    this.dotHighlightTemplateHashCode = primitives.common.hashCode(this._getDotHighlightTemplate)
};
primitives.orgdiagram.Template.prototype._getDefaultItemTemplate = function () {
    var a = new primitives.common.Size(this.itemSize), b, c, d;
    a.width -= this.boxModel ? 2 * this.itemBorderWidth : 0;
    a.height -= this.boxModel ? 2 * this.itemBorderWidth : 0;
    b = jQuery("<div></div>").css({"border-width": this.itemBorderWidth + "px"}).addClass("bp-item bp-corner-all bt-item-frame");
    c = jQuery('<div name="titleBackground"></div>').css({
        top: "2px",
        left: "2px",
        width: a.width - 4 + "px",
        height: "18px"
    }).addClass("bp-item bp-corner-all bp-title-frame");
    b.append(c);
    d = jQuery('<div name="title"></div>').css({
        top: "1px",
        left: "4px",
        width: a.width - 4 - 8 + "px",
        height: "16px"
    }).addClass("bp-item bp-title");
    c.append(d);
    c = jQuery("<div></div>").css({
        top: "24px",
        left: "2px",
        width: "50px",
        height: "60px"
    }).addClass("bp-item bp-photo-frame");
    b.append(c);
    d = jQuery('<img name="photo" alt=""></img>').css({width: "50px", height: "60px"});
    c.append(d);
    a = jQuery('<div name="description"></div>').css({
        top: "24px",
        left: "56px",
        width: a.width - 4 - 56 + "px",
        height: "74px"
    }).addClass("bp-item bp-description");
    b.append(a);
    return b.wrap("<div>").parent().html()
};
primitives.orgdiagram.Template.prototype._getDefaultCursorTemplate = function () {
    return jQuery("<div></div>").css({
        width: this.itemSize.width + this.cursorPadding.left + this.cursorPadding.right + "px",
        height: this.itemSize.height + this.cursorPadding.top + this.cursorPadding.bottom + "px",
        "border-width": this.cursorBorderWidth + "px"
    }).addClass("bp-item bp-corner-all bp-cursor-frame").wrap("<div>").parent().html()
};
primitives.orgdiagram.Template.prototype._getDefaultHighlightTemplate = function () {
    return jQuery("<div></div>").css({"border-width": this.highlightBorderWidth + "px"}).addClass("bp-item bp-corner-all bp-highlight-frame").wrap("<div>").parent().html()
};
primitives.orgdiagram.Template.prototype._getDotHighlightTemplate = function () {
    var a = this.minimizedItemCornerRadius + this.highlightPadding.left;
    return jQuery("<div></div>").css({
        "border-width": this.highlightBorderWidth + "px",
        "-moz-border-radius": a,
        "-webkit-border-radius": a,
        "-khtml-border-radius": a,
        "border-radius": a
    }).addClass("bp-item bp-highlight-dot-frame").wrap("<div>").parent().html()
};
primitives.orgdiagram.TreeItem = function (a) {
    this.orgItem = this.itemConfig = null;
    this.id = a;
    this.logicalParents = [];
    this.logicalChildren = [];
    this.visualParentId = null;
    this.visualChildren = [];
    this.visualAggregatorId = null;
    this.partners = [];
    this.extraPartners = [];
    this.partnerConnectorOffset = 0;
    this.visibility = 1;
    this.levelPosition = this.level = this.template = null;
    this.rightPadding = this.leftPadding = this.offset = 0;
    this.actualVisibility = 1;
    this.contentPosition = this.actualPosition = this.actualSize = null;
    this.actualHasGroupTitle =
        this.actualHasButtons = this.actualHasSelectorCheckbox = this.actualIsActive = this.isSelected = this.isCursor = !1;
    this.actualItemType = null;
    this.relationDegree = this.partnerHighlightPath = this.highlightPath = this.gravity = this.connectorPlacement = 0
};
primitives.orgdiagram.TreeItem.prototype.setActualSize = function (a, b) {
    var c = primitives.common;
    this.actualVisibility = 0 === this.visibility ? a.currentvisibility : this.visibility;
    switch (this.actualVisibility) {
        case 1:
            this.actualSize = new c.Size(this.template.itemSize);
            this.contentPosition = new c.Rect(0, 0, this.actualSize.width, this.actualSize.height);
            this.isCursor && (this.actualSize.height += this.template.cursorPadding.top + this.template.cursorPadding.bottom, this.actualSize.width += this.template.cursorPadding.left +
            this.template.cursorPadding.right, this.contentPosition.x = this.template.cursorPadding.left, this.contentPosition.y = this.template.cursorPadding.top);
            this.actualHasSelectorCheckbox && (this.actualSize.height += b.checkBoxPanelSize);
            this.actualHasButtons && (this.actualSize.width += b.buttonsPanelSize);
            if (this.actualHasGroupTitle = !c.isNullOrEmpty(this.orgItem.groupTitle))this.actualSize.width += b.groupTitlePanelSize, this.contentPosition.x += b.groupTitlePanelSize;
            break;
        case 2:
            this.actualSize = new c.Size(this.template.minimizedItemSize);
            break;
        case 3:
        case 4:
            this.actualSize = new c.Size
    }
    switch (b.orientationType) {
        case 2:
        case 3:
            this.actualSize.invert()
    }
};
primitives.orgdiagram.TreeItem.prototype.setActualPosition = function (a, b) {
    var c = 0;
    switch (b.verticalAlignment) {
        case 0:
            c = 0;
            break;
        case 1:
            c = (a.depth - this.actualSize.height) / 2;
            break;
        case 2:
            c = a.depth - this.actualSize.height
    }
    this.actualPosition = new primitives.common.Rect(this.offset, a.shift + c, this.actualSize.width, this.actualSize.height);
    switch (b.orientationType) {
        case 2:
        case 3:
            this.actualSize.invert()
    }
};
primitives.orgdiagram.TreeItem.prototype.toString = function () {
    return this.id
};
primitives.orgdiagram.TreeLevel = function (a) {
    this.level = a;
    this.actualVisibility = this.currentvisibility = 1;
    this.partnerConnectorOffset = this.levelSpace = this.connectorShift = this.topConnectorShift = this.currentOffset = this.nextLevelShift = this.depth = this.shift = 0;
    this.treeItems = [];
    this.activeTreeItems = [];
    this.labels = [];
    this.labelsRect = null;
    this.showLabels = !0;
    this.hasFixedLabels = !1
};
primitives.orgdiagram.TreeLevel.prototype.shiftDown = function (a) {
    this.topConnectorShift += a;
    this.connectorShift += a;
    this.nextLevelShift += a;
    this.shift += a
};
primitives.orgdiagram.TreeLevel.prototype.toString = function () {
    return this.level + "." + this.currentvisibility
};
(function (a) {
    a.widget("ui.orgDiagram", jQuery.ui.mouse2, new primitives.orgdiagram.Controller)
})(jQuery);
primitives.shape.Config = function () {
    this.classPrefix = "bpconnector";
    this.graphicsType = 1;
    this.actualGraphicsType = null;
    this.shapeType = this.orientationType = 0;
    this.position = null;
    this.offset = new primitives.common.Thickness(0, 0, 0, 0);
    this.lineWidth = 2;
    this.cornerRadius = "10%";
    this.opacity = 1;
    this.fillColor = this.borderColor = null;
    this.lineType = 0;
    this.label = null;
    this.labelSize = new primitives.common.Size(60, 30);
    this.labelPlacement = 0;
    this.labelOffset = 4
};
primitives.shape.Controller = function () {
    this.widgetEventPrefix = "bpshape";
    this.options = new primitives.shape.Config;
    this._labelTemplateHashCode = this._labelTemplate = this.m_shape = this.m_graphics = this.m_panelSize = this.m_placeholder = null
};
primitives.shape.Controller.prototype._create = function () {
    var a = this;
    this.element.addClass("ui-widget");
    this._createLabelTemplate();
    this._createLayout();
    this.options.onAnnotationLabelTemplateRender = function (b, c) {
        a._onAnnotationLabelTemplateRender(b, c)
    };
    this._redraw()
};
primitives.shape.Controller.prototype.destroy = function () {
    this._cleanLayout();
    this.options.onLabelTemplateRender = null
};
primitives.shape.Controller.prototype._createLayout = function () {
    this.m_panelSize = new primitives.common.Rect(0, 0, this.element.outerWidth(), this.element.outerHeight());
    this.m_placeholder = jQuery("<div></div>");
    this.m_placeholder.css({
        position: "relative",
        overflow: "hidden",
        top: "0px",
        left: "0px",
        padding: "0px",
        margin: "0px"
    });
    this.m_placeholder.css(this.m_panelSize.getCSS());
    this.m_placeholder.addClass("placeholder");
    this.m_placeholder.addClass(this.widgetEventPrefix);
    this.element.append(this.m_placeholder);
    this.m_graphics = primitives.common.createGraphics(this.options.graphicsType, this);
    this.options.actualGraphicsType = this.m_graphics.graphicsType
};
primitives.shape.Controller.prototype._cleanLayout = function () {
    null !== this.m_graphics && this.m_graphics.clean();
    this.m_graphics = null;
    this.element.find("." + this.widgetEventPrefix).remove()
};
primitives.shape.Controller.prototype._updateLayout = function () {
    this.m_panelSize = new primitives.common.Rect(0, 0, this.element.innerWidth(), this.element.innerHeight());
    this.m_placeholder.css(this.m_panelSize.getCSS())
};
primitives.shape.Controller.prototype.update = function (a) {
    a ? (this._cleanLayout(), this._createLayout(), this._redraw()) : (this._updateLayout(), this.m_graphics.resize("placeholder", this.m_panelSize.width, this.m_panelSize.height), this.m_graphics.begin(), this._redraw(), this.m_graphics.end())
};
primitives.shape.Controller.prototype._createLabelTemplate = function () {
    var a = jQuery("<div></div>");
    a.addClass("bp-item bp-corner-all bp-connector-label");
    this._labelTemplate = a.wrap("<div>").parent().html();
    this._labelTemplateHashCode = primitives.common.hashCode(this._labelTemplate)
};
primitives.shape.Controller.prototype._onAnnotationLabelTemplateRender = function (a, b) {
    b.element.html(this.options.label)
};
primitives.shape.Controller.prototype._redraw = function () {
    var a = "orientationType shapeType offset lineWidth borderColor lineType labelSize labelOffset labelPlacement cornerRadius opacity fillColor".split(" "), b, c;
    this.m_graphics.activate("placeholder");
    this.m_shape = new primitives.common.Shape(this.m_graphics);
    for (b = 0; b < a.length; b += 1)c = a[b], this.m_shape[c] = this.options[c];
    this.m_shape.hasLabel = !primitives.common.isNullOrEmpty(this.options.label);
    this.m_shape.labelTemplate = this._labelTemplate;
    this.m_shape.labelTemplateHashCode =
        this._labelTemplateHashCode;
    this.m_shape.panelSize = new primitives.common.Size(this.m_panelSize.width, this.m_panelSize.height);
    this.m_shape.draw(this.options.position)
};
primitives.shape.Controller.prototype._setOption = function (a, b) {
    jQuery.Widget.prototype._setOption.apply(this, arguments);
    switch (a) {
        case "disabled":
            var c = jQuery([]);
            b ? (c.filter(".ui-state-focus").blur(), c.removeClass("ui-state-hover"), c.propAttr("disabled", !0), this.element.addClass("ui-disabled")) : (c.propAttr("disabled", !1), this.element.removeClass("ui-disabled"))
    }
};
(function (a) {
    a.widget("ui.bpShape", new primitives.shape.Controller)
})(jQuery);
